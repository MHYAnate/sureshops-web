"use client";

import { useQuery } from "@tanstack/react-query";
import { Card, Badge, Button } from "@/components/ui";
import { AdminStats } from "@/components/admin/admin-stats";
import { LoadingState } from "@/components/common";
import { adminService } from "@/services/admin.service";
import { formatDistanceToNow } from "date-fns";
import Link from "next/link";
import { AlertCircle, CheckCircle, Clock, ArrowRight } from "lucide-react";

export default function AdminDashboardPage() {
  const { data: stats, isLoading: statsLoading } = useQuery({
    queryKey: ["admin-stats"],
    queryFn: () => adminService.getDashboardStats(),
  });

  const { data: activity, isLoading: activityLoading } = useQuery({
    queryKey: ["admin-activity"],
    queryFn: () => adminService.getRecentActivity(10),
  });

  const { data: pendingVendors } = useQuery({
    queryKey: ["pending-vendors"],
    queryFn: () => adminService.getPendingVendors(),
  });

  const { data: pendingProducts } = useQuery({
    queryKey: ["pending-products"],
    queryFn: () => adminService.getPendingProducts(),
  });

  if (statsLoading) {
    return <LoadingState />;
  }

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-2xl font-bold">Admin Dashboard</h1>
        <p className="text-muted-foreground">
          Overview of your platform metrics and pending actions
        </p>
      </div>

      {/* Stats */}
      {stats && <AdminStats stats={stats} />}

      {/* Quick Actions */}
      <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
        {/* Pending Vendors */}
        <Card className="p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-semibold flex items-center gap-2">
              <Clock className="h-5 w-5 text-amber-600" />
              Pending Vendors
              {pendingVendors && pendingVendors.length > 0 && (
                <Badge variant="warning">{pendingVendors.length}</Badge>
              )}
            </h3>
            <Button variant="ghost" size="sm" asChild>
              <Link href="/admin/vendors?filter=pending">
                View All
                <ArrowRight className="ml-1 h-4 w-4" />
              </Link>
            </Button>
          </div>

          {pendingVendors && pendingVendors.length > 0 ? (
            <div className="space-y-3">
              {pendingVendors.slice(0, 5).map((vendor: any) => (
                <div
                  key={vendor._id}
                  className="flex items-center justify-between p-3 rounded-lg bg-muted/50"
                >
                  <div>
                    <p className="font-medium">{vendor.businessName}</p>
                    <p className="text-xs text-muted-foreground">
                      {vendor.userId?.email}
                    </p>
                  </div>
                  <Button size="sm" asChild>
                    <Link href={`/admin/vendors?id=${vendor._id}`}>Review</Link>
                  </Button>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-6 text-muted-foreground">
              <CheckCircle className="h-8 w-8 mx-auto mb-2 text-green-600" />
              <p>No pending vendors</p>
            </div>
          )}
        </Card>

        {/* Pending Products */}
        <Card className="p-6">
          <div className="flex items-center justify-between mb-4">
            <h3 className="font-semibold flex items-center gap-2">
              <AlertCircle className="h-5 w-5 text-amber-600" />
              Pending Products
              {pendingProducts && pendingProducts.length > 0 && (
                <Badge variant="warning">{pendingProducts.length}</Badge>
              )}
            </h3>
            <Button variant="ghost" size="sm" asChild>
              <Link href="/admin/products?filter=pending">
                View All
                <ArrowRight className="ml-1 h-4 w-4" />
              </Link>
            </Button>
          </div>

          {pendingProducts && pendingProducts.length > 0 ? (
            <div className="space-y-3">
              {pendingProducts.slice(0, 5).map((product: any) => (
                <div
                  key={product._id}
                  className="flex items-center justify-between p-3 rounded-lg bg-muted/50"
                >
                  <div>
                    <p className="font-medium truncate max-w-[200px]">
                      {product.name}
                    </p>
                    <p className="text-xs text-muted-foreground">
                      {product.vendorId?.businessName}
                    </p>
                  </div>
                  <Button size="sm" asChild>
                    <Link href={`/admin/products?id=${product._id}`}>Review</Link>
                  </Button>
                </div>
              ))}
            </div>
          ) : (
            <div className="text-center py-6 text-muted-foreground">
              <CheckCircle className="h-8 w-8 mx-auto mb-2 text-green-600" />
              <p>No pending products</p>
            </div>
          )}
        </Card>
      </div>

      {/* Recent Activity */}
      <Card className="p-6">
        <h3 className="font-semibold mb-4">Recent Activity</h3>
        {activityLoading ? (
          <LoadingState />
        ) : activity && activity.length > 0 ? (
          <div className="space-y-3">
            {activity.map((item, index) => (
              <div
                key={index}
                className="flex items-center justify-between py-2 border-b border-border last:border-0"
              >
                <div className="flex items-center gap-3">
                  <div
                    className={cn(
                      "w-2 h-2 rounded-full",
                      item.type === "user_registered" && "bg-blue-500",
                      item.type === "vendor_created" && "bg-amber-500",
                      item.type === "vendor_verified" && "bg-green-500",
                      item.type === "product_added" && "bg-purple-500"
                    )}
                  />
                  <span className="text-sm">{item.message}</span>
                </div>
                <span className="text-xs text-muted-foreground">
                  {formatDistanceToNow(new Date(item.timestamp), {
                    addSuffix: true,
                  })}
                </span>
              </div>
            ))}
          </div>
        ) : (
          <p className="text-muted-foreground text-center py-6">
            No recent activity
          </p>
        )}
      </Card>
    </div>
  );
}

function cn(...classes: (string | boolean | undefined)[]) {
  return classes.filter(Boolean).join(" ");
}"use client";

import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import Link from "next/link";
import Image from "next/image";
import {
  Card,
  Button,
  Input,
  Badge,
  Select,
  Modal,
} from "@/components/ui";
import { LoadingState, Pagination } from "@/components/common";
import { adminService } from "@/services/admin.service";
import { Product } from "@/types";
import { formatPrice } from "@/lib/utils";
import {
  Search,
  CheckCircle,
  XCircle,
  Eye,
  MoreHorizontal,
} from "lucide-react";
import toast from "react-hot-toast";

const STATUS_OPTIONS = [
  { value: "", label: "All Status" },
  { value: "pending", label: "Pending" },
  { value: "approved", label: "Approved" },
  { value: "rejected", label: "Rejected" },
];

export default function AdminProductsPage() {
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState("");
  const [statusFilter, setStatusFilter] = useState("");
  const [selectedProducts, setSelectedProducts] = useState<string[]>([]);
  const [selectedProduct, setSelectedProduct] = useState<Product | null>(null);
  const [showActionModal, setShowActionModal] = useState(false);

  const { data, isLoading } = useQuery({
    queryKey: ["admin-products", page, search, statusFilter],
    queryFn: () =>
      adminService.getProducts({
        page,
        limit: 20,
        search: search || undefined,
        status: statusFilter || undefined,
      }),
  });

  const actionMutation = useMutation({
    mutationFn: ({
      id,
      action,
      reason,
    }: {
      id: string;
      action: string;
      reason?: string;
    }) => adminService.productAction(id, action, reason),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["admin-products"] });
      setShowActionModal(false);
      setSelectedProduct(null);
      toast.success("Action completed successfully");
    },
    onError: () => toast.error("Action failed"),
  });

  const bulkApproveMutation = useMutation({
    mutationFn: (ids: string[]) => adminService.bulkApproveProducts(ids),
    onSuccess: (count) => {
      queryClient.invalidateQueries({ queryKey: ["admin-products"] });
      setSelectedProducts([]);
      toast.success(`${count} products approved`);
    },
    onError: () => toast.error("Bulk action failed"),
  });

  const handleAction = (action: string) => {
    if (!selectedProduct) return;
    actionMutation.mutate({ id: selectedProduct.id, action });
  };

  const handleSelectAll = () => {
    if (!data?.items) return;
    if (selectedProducts.length === data.items.length) {
      setSelectedProducts([]);
    } else {
      setSelectedProducts(data.items.map((p: any) => p._id));
    }
  };

  const handleSelectProduct = (id: string) => {
    setSelectedProducts((prev) =>
      prev.includes(id) ? prev.filter((p) => p !== id) : [...prev, id]
    );
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Products</h1>
          <p className="text-muted-foreground">Manage product listings</p>
        </div>
        {selectedProducts.length > 0 && (
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">
              {selectedProducts.length} selected
            </span>
            <Button
              size="sm"
              onClick={() => bulkApproveMutation.mutate(selectedProducts)}
              disabled={bulkApproveMutation.isPending}
            >
              Approve Selected
            </Button>
          </div>
        )}
      </div>

      {/* Filters */}
      <Card className="p-4">
        <div className="flex gap-4 flex-wrap">
          <div className="flex-1 min-w-[200px] relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search products..."
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
              className="pl-10"
            />
          </div>
          <Select
            value={statusFilter}
            onChange={(value) => {
              setStatusFilter(value);
              setPage(1);
            }}
            options={STATUS_OPTIONS}
            className="w-40"
          />
        </div>
      </Card>

      {/* Products Table */}
      <Card>
        {isLoading ? (
          <LoadingState />
        ) : data?.items && data.items.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-border">
                  <th className="text-left p-4">
                    <input
                      type="checkbox"
                      checked={selectedProducts.length === data.items.length}
                      onChange={handleSelectAll}
                      className="rounded border-input"
                    />
                  </th>
                  <th className="text-left p-4 font-medium">Product</th>
                  <th className="text-left p-4 font-medium">Vendor</th>
                  <th className="text-left p-4 font-medium">Price</th>
                  <th className="text-left p-4 font-medium">Status</th>
                  <th className="text-left p-4 font-medium">Views</th>
                  <th className="text-right p-4 font-medium">Actions</th>
                </tr>
              </thead>
              <tbody>
                {data.items.map((product: any) => (
                  <tr
                    key={product._id}
                    className="border-b border-border last:border-0"
                  >
                    <td className="p-4">
                      <input
                        type="checkbox"
                        checked={selectedProducts.includes(product._id)}
                        onChange={() => handleSelectProduct(product._id)}
                        className="rounded border-input"
                      />
                    </td>
                    <td className="p-4">
                      <div className="flex items-center gap-3">
                        <div className="relative h-12 w-12 rounded-lg bg-muted overflow-hidden">
                          {product.images?.[0] ? (
                            <Image
                              src={product.images[0]}
                              alt={product.name}
                              fill
                              className="object-cover"
                            />
                          ) : (
                            <div className="flex h-full items-center justify-center text-xl">
                              ðŸ“¦
                            </div>
                          )}
                        </div>
                        <div>
                          <p className="font-medium line-clamp-1 max-w-[200px]">
                            {product.name}
                          </p>
                          <p className="text-xs text-muted-foreground">
                            {product.category}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td className="p-4 text-sm">
                      {product.vendorId?.businessName || "N/A"}
                    </td>
                    <td className="p-4 font-medium">
                      {formatPrice(product.price)}
                    </td>
                    <td className="p-4">
                      <Badge
                        variant={
                          product.status === "approved"
                            ? "success"
                            : product.status === "pending"
                            ? "warning"
                            : "destructive"
                        }
                      >
                        {product.status}
                      </Badge>
                    </td>
                    <td className="p-4 text-sm text-muted-foreground">
                      {product.views}
                    </td>
                    <td className="p-4 text-right">
                      <div className="flex items-center justify-end gap-2">
                        <Button variant="ghost" size="icon" asChild>
                          <Link href={`/products/${product._id}`} target="_blank">
                            <Eye className="h-4 w-4" />
                          </Link>
                        </Button>
                        <Button
                          variant="ghost"
                          size="icon"
                          onClick={() => {
                            setSelectedProduct({
                              ...product,
                              id: product._id,
                            });
                            setShowActionModal(true);
                          }}
                        >
                          <MoreHorizontal className="h-4 w-4" />
                        </Button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : (
          <div className="p-8 text-center text-muted-foreground">
            No products found
          </div>
        )}
      </Card>

      {/* Pagination */}
      {data && data.totalPages > 1 && (
        <Pagination
          currentPage={page}
          totalPages={data.totalPages}
          onPageChange={setPage}
        />
      )}

      {/* Action Modal */}
      <Modal
        isOpen={showActionModal}
        onClose={() => setShowActionModal(false)}
        title="Product Actions"
      >
        {selectedProduct && (
          <div className="space-y-4">
            <p>
              Actions for <strong>{selectedProduct.name}</strong>
            </p>
            <div className="grid grid-cols-2 gap-2">
              {selectedProduct.status !== "approved" && (
                <Button
                  onClick={() => handleAction("approve")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <CheckCircle className="h-4 w-4" />
                  Approve
                </Button>
              )}
              {selectedProduct.status !== "rejected" && (
                <Button
                  variant="destructive"
                  onClick={() => handleAction("reject")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <XCircle className="h-4 w-4" />
                  Reject
                </Button>
              )}
              <Button
                variant="outline"
                onClick={() => handleAction("delete")}
                className="gap-2 col-span-2"
                disabled={actionMutation.isPending}
              >
                Delete Product
              </Button>
            </div>
          </div>
        )}
      </Modal>
    </div>
  );
}"use client";

import { useState } from "react";
import { Card, Button, Input } from "@/components/ui";
import { adminService } from "@/services/admin.service";
import toast from "react-hot-toast";
import { Database, RefreshCw } from "lucide-react";

export default function AdminSettingsPage() {
  const [seeding, setSeeding] = useState(false);

  const handleSeedAdmins = async () => {
    setSeeding(true);
    try {
      await adminService.seedAdmins();
      toast.success("Admin users seeded successfully");
    } catch (error) {
      toast.error("Failed to seed admin users");
    } finally {
      setSeeding(false);
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Admin Settings</h1>
        <p className="text-muted-foreground">
          System configuration and maintenance
        </p>
      </div>

      {/* Database Seeding */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4 flex items-center gap-2">
          <Database className="h-5 w-5" />
          Database Seeding
        </h2>
        <p className="text-sm text-muted-foreground mb-4">
          Initialize the database with default data. Use with caution.
        </p>
        <div className="flex flex-wrap gap-4">
          <Button
            variant="outline"
            onClick={handleSeedAdmins}
            disabled={seeding}
          >
            {seeding ? (
              <RefreshCw className="mr-2 h-4 w-4 animate-spin" />
            ) : (
              <Database className="mr-2 h-4 w-4" />
            )}
            Seed Admin Users
          </Button>
        </div>

        <div className="mt-6 p-4 bg-muted/50 rounded-lg">
          <h3 className="font-medium text-sm mb-2">Default Credentials</h3>
          <div className="text-xs text-muted-foreground space-y-1 font-mono">
            <p>Super Admin: superadmin@sureshops.com / SuperAdmin@123!</p>
            <p>Admin: admin@sureshops.com / Admin@123!</p>
            <p>Vendor: vendor@sureshops.com / Vendor@123!</p>
            <p>User: user@sureshops.com / User@123!</p>
          </div>
        </div>
      </Card>

      {/* App Info */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Application Info</h2>
        <div className="grid grid-cols-2 gap-4 text-sm">
          <div>
            <span className="text-muted-foreground">Version</span>
            <p className="font-medium">1.0.0</p>
          </div>
          <div>
            <span className="text-muted-foreground">Environment</span>
            <p className="font-medium">
              {process.env.NODE_ENV || "development"}
            </p>
          </div>
          <div>
            <span className="text-muted-foreground">API URL</span>
            <p className="font-medium font-mono text-xs">
              {process.env.NEXT_PUBLIC_API_URL}
            </p>
          </div>
        </div>
      </Card>
    </div>
  );
}"use client";

import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import {
  Card,
  Button,
  Input,
  Badge,
  Select,
  Modal,
  Avatar,
} from "@/components/ui";
import { LoadingState, Pagination } from "@/components/common";
import { adminService } from "@/services/admin.service";
import { User } from "@/types";
import { Search, MoreHorizontal, Edit, Trash2, Shield } from "lucide-react";
import toast from "react-hot-toast";

const ROLES = [
  { value: "", label: "All Roles" },
  { value: "user", label: "User" },
  { value: "vendor", label: "Vendor" },
  { value: "admin", label: "Admin" },
  { value: "super_admin", label: "Super Admin" },
];

export default function AdminUsersPage() {
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState("");
  const [roleFilter, setRoleFilter] = useState("");
  const [selectedUser, setSelectedUser] = useState<User | null>(null);
  const [showRoleModal, setShowRoleModal] = useState(false);

  const { data, isLoading } = useQuery({
    queryKey: ["admin-users", page, search, roleFilter],
    queryFn: () =>
      adminService.getUsers({
        page,
        limit: 20,
        search: search || undefined,
        role: roleFilter || undefined,
      }),
  });

  const deleteUserMutation = useMutation({
    mutationFn: (id: string) => adminService.deleteUser(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["admin-users"] });
      toast.success("User deleted");
    },
    onError: () => toast.error("Failed to delete user"),
  });

  const changeRoleMutation = useMutation({
    mutationFn: ({ id, role }: { id: string; role: string }) =>
      adminService.changeUserRole(id, role),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["admin-users"] });
      setShowRoleModal(false);
      toast.success("Role updated");
    },
    onError: () => toast.error("Failed to update role"),
  });

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    setPage(1);
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Users</h1>
          <p className="text-muted-foreground">Manage platform users</p>
        </div>
      </div>

      {/* Filters */}
      <Card className="p-4">
        <form onSubmit={handleSearch} className="flex gap-4">
          <div className="flex-1 relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search users..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-10"
            />
          </div>
          <Select
            value={roleFilter}
            onChange={(value) => {
              setRoleFilter(value);
              setPage(1);
            }}
            options={ROLES}
            className="w-40"
          />
        </form>
      </Card>

      {/* Users Table */}
      <Card>
        {isLoading ? (
          <LoadingState />
        ) : data?.items && data.items.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-border">
                  <th className="text-left p-4 font-medium">User</th>
                  <th className="text-left p-4 font-medium">Email</th>
                  <th className="text-left p-4 font-medium">Role</th>
                  <th className="text-left p-4 font-medium">Status</th>
                  <th className="text-left p-4 font-medium">Joined</th>
                  <th className="text-right p-4 font-medium">Actions</th>
                </tr>
              </thead>
              <tbody>
                {data.items.map((user: User) => (
                  <tr key={user.id} className="border-b border-border last:border-0">
                    <td className="p-4">
                      <div className="flex items-center gap-3">
                        <Avatar
                          src={user.avatar}
                          name={`${user.firstName} ${user.lastName}`}
                          size="sm"
                        />
                        <span className="font-medium">
                          {user.firstName} {user.lastName}
                        </span>
                      </div>
                    </td>
                    <td className="p-4 text-muted-foreground">{user.email}</td>
                    <td className="p-4">
                      <Badge
                        variant={
                          user.role === "super_admin"
                            ? "default"
                            : user.role === "admin"
                            ? "secondary"
                            : "outline"
                        }
                      >
                        {user.role}
                      </Badge>
                    </td>
                    <td className="p-4">
                      <Badge variant={user.isActive ? "success" : "destructive"}>
                        {user.isActive ? "Active" : "Inactive"}
                      </Badge>
                    </td>
                    <td className="p-4 text-muted-foreground">
                      {new Date(user.createdAt).toLocaleDateString()}
                    </td>
                    <td className="p-4 text-right">
                      <div className="flex items-center justify-end gap-2">
                        <Button
                          variant="ghost"
                          size="icon"
                          onClick={() => {
                            setSelectedUser(user);
                            setShowRoleModal(true);
                          }}
                        >
                          <Shield className="h-4 w-4" />
                        </Button>
                        <Button
                          variant="ghost"
                          size="icon"
                          onClick={() => {
                            if (confirm("Delete this user?")) {
                              deleteUserMutation.mutate(user.id);
                            }
                          }}
                        >
                          <Trash2 className="h-4 w-4 text-destructive" />
                        </Button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : (
          <div className="p-8 text-center text-muted-foreground">
            No users found
          </div>
        )}
      </Card>

      {/* Pagination */}
      {data && data.totalPages > 1 && (
        <Pagination
          currentPage={page}
          totalPages={data.totalPages}
          onPageChange={setPage}
        />
      )}

      {/* Change Role Modal */}
      <Modal
        isOpen={showRoleModal}
        onClose={() => setShowRoleModal(false)}
        title="Change User Role"
      >
        {selectedUser && (
          <div className="space-y-4">
            <p>
              Change role for{" "}
              <strong>
                {selectedUser.firstName} {selectedUser.lastName}
              </strong>
            </p>
            <Select
              value={selectedUser.role}
              onChange={(role) => {
                changeRoleMutation.mutate({ id: selectedUser.id, role });
              }}
              options={ROLES.filter((r) => r.value)}
            />
          </div>
        )}
      </Modal>
    </div>
  );
}"use client";

import { useState } from "react";
import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import Link from "next/link";
import {
  Card,
  Button,
  Input,
  Badge,
  Select,
  Modal,
  Avatar,
} from "@/components/ui";
import { LoadingState, Pagination } from "@/components/common";
import { adminService } from "@/services/admin.service";
import { Vendor } from "@/types";
import {
  Search,
  CheckCircle,
  XCircle,
  Star,
  Eye,
  MoreHorizontal,
} from "lucide-react";
import toast from "react-hot-toast";

export default function AdminVendorsPage() {
  const queryClient = useQueryClient();
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState("");
  const [verifiedFilter, setVerifiedFilter] = useState<string>("");
  const [selectedVendor, setSelectedVendor] = useState<Vendor | null>(null);
  const [showActionModal, setShowActionModal] = useState(false);

  const { data, isLoading } = useQuery({
    queryKey: ["admin-vendors", page, search, verifiedFilter],
    queryFn: () =>
      adminService.getVendors({
        page,
        limit: 20,
        search: search || undefined,
        isVerified: verifiedFilter === "" ? undefined : verifiedFilter === "true",
      }),
  });

  const actionMutation = useMutation({
    mutationFn: ({
      id,
      action,
      reason,
    }: {
      id: string;
      action: string;
      reason?: string;
    }) => adminService.vendorAction(id, action, reason),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["admin-vendors"] });
      setShowActionModal(false);
      setSelectedVendor(null);
      toast.success("Action completed successfully");
    },
    onError: () => toast.error("Action failed"),
  });

  const handleAction = (action: string) => {
    if (!selectedVendor) return;
    actionMutation.mutate({ id: selectedVendor.id, action });
  };

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">Vendors</h1>
          <p className="text-muted-foreground">Manage vendor accounts</p>
        </div>
      </div>

      {/* Filters */}
      <Card className="p-4">
        <div className="flex gap-4 flex-wrap">
          <div className="flex-1 min-w-[200px] relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search vendors..."
              value={search}
              onChange={(e) => {
                setSearch(e.target.value);
                setPage(1);
              }}
              className="pl-10"
            />
          </div>
          <Select
            value={verifiedFilter}
            onChange={(value) => {
              setVerifiedFilter(value);
              setPage(1);
            }}
            options={[
              { value: "", label: "All Status" },
              { value: "true", label: "Verified" },
              { value: "false", label: "Pending" },
            ]}
            className="w-40"
          />
        </div>
      </Card>

      {/* Vendors Table */}
      <Card>
        {isLoading ? (
          <LoadingState />
        ) : data?.items && data.items.length > 0 ? (
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-border">
                  <th className="text-left p-4 font-medium">Shop</th>
                  <th className="text-left p-4 font-medium">Owner</th>
                  <th className="text-left p-4 font-medium">Location</th>
                  <th className="text-left p-4 font-medium">Status</th>
                  <th className="text-left p-4 font-medium">Products</th>
                  <th className="text-right p-4 font-medium">Actions</th>
                </tr>
              </thead>
              <tbody>
                {data.items.map((vendor: any) => (
                  <tr
                    key={vendor._id}
                    className="border-b border-border last:border-0"
                  >
                    <td className="p-4">
                      <div className="flex items-center gap-3">
                        <Avatar
                          src={vendor.shopImages?.logo}
                          name={vendor.businessName}
                          size="md"
                        />
                        <div>
                          <p className="font-medium">{vendor.businessName}</p>
                          <p className="text-xs text-muted-foreground">
                            {vendor.vendorType}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td className="p-4">
                      <p className="text-sm">
                        {vendor.userId?.firstName} {vendor.userId?.lastName}
                      </p>
                      <p className="text-xs text-muted-foreground">
                        {vendor.userId?.email}
                      </p>
                    </td>
                    <td className="p-4 text-sm text-muted-foreground">
                      {vendor.areaId?.name}, {vendor.stateId?.name}
                    </td>
                    <td className="p-4">
                      <div className="flex items-center gap-2">
                        <Badge
                          variant={vendor.isVerified ? "success" : "warning"}
                        >
                          {vendor.isVerified ? "Verified" : "Pending"}
                        </Badge>
                        {vendor.isFeatured && (
                          <Badge variant="default">Featured</Badge>
                        )}
                      </div>
                    </td>
                    <td className="p-4 text-sm">{vendor.totalProducts}</td>
                    <td className="p-4 text-right">
                      <div className="flex items-center justify-end gap-2">
                        <Button variant="ghost" size="icon" asChild>
                          <Link href={`/shops/${vendor._id}`} target="_blank">
                            <Eye className="h-4 w-4" />
                          </Link>
                        </Button>
                        <Button
                          variant="ghost"
                          size="icon"
                          onClick={() => {
                            setSelectedVendor(vendor);
                            setShowActionModal(true);
                          }}
                        >
                          <MoreHorizontal className="h-4 w-4" />
                        </Button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        ) : (
          <div className="p-8 text-center text-muted-foreground">
            No vendors found
          </div>
        )}
      </Card>

      {/* Pagination */}
      {data && data.totalPages > 1 && (
        <Pagination
          currentPage={page}
          totalPages={data.totalPages}
          onPageChange={setPage}
        />
      )}

      {/* Action Modal */}
      <Modal
        isOpen={showActionModal}
        onClose={() => setShowActionModal(false)}
        title="Vendor Actions"
      >
        {selectedVendor && (
          <div className="space-y-4">
            <p>
              Actions for <strong>{selectedVendor.businessName}</strong>
            </p>
            <div className="grid grid-cols-2 gap-2">
              {!selectedVendor.isVerified && (
                <Button
                  onClick={() => handleAction("approve")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <CheckCircle className="h-4 w-4" />
                  Approve
                </Button>
              )}
              {selectedVendor.isVerified && (
                <Button
                  variant="destructive"
                  onClick={() => handleAction("suspend")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <XCircle className="h-4 w-4" />
                  Suspend
                </Button>
              )}
              {!selectedVendor.isFeatured && (
                <Button
                  variant="outline"
                  onClick={() => handleAction("feature")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <Star className="h-4 w-4" />
                  Feature
                </Button>
              )}
              {selectedVendor.isFeatured && (
                <Button
                  variant="outline"
                  onClick={() => handleAction("unfeature")}
                  className="gap-2"
                  disabled={actionMutation.isPending}
                >
                  <Star className="h-4 w-4" />
                  Unfeature
                </Button>
              )}
            </div>
          </div>
        )}
      </Modal>
    </div>
  );
}"use client";

import { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useAuth } from "@/hooks";
import { AdminSidebar } from "@/components/admin/admin-sidebar";
import { LoadingState } from "@/components/common";

export default function AdminLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const router = useRouter();
  const { isLoading, isAuthenticated, isAdmin } = useAuth(true);

  useEffect(() => {
    if (!isLoading && (!isAuthenticated || !isAdmin)) {
      router.push("/login");
    }
  }, [isLoading, isAuthenticated, isAdmin, router]);

  if (isLoading) {
    return (
      <div className="min-h-screen flex items-center justify-center">
        <LoadingState text="Loading admin panel..." />
      </div>
    );
  }

  if (!isAuthenticated || !isAdmin) {
    return null;
  }

  return (
    <div className="min-h-screen bg-muted/30">
      <AdminSidebar />
      <main className="lg:pl-64">
        <div className="container-premium py-8">{children}</div>
      </main>
    </div>
  );
}"use client";

import { useState } from "react";
import Link from "next/link";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { Mail, ArrowLeft, CheckCircle } from "lucide-react";
import { Button, Input, Card } from "@/components/ui";
import toast from "react-hot-toast";

const forgotPasswordSchema = z.object({
  email: z.string().email("Invalid email address"),
});

type ForgotPasswordInput = z.infer<typeof forgotPasswordSchema>;

export default function ForgotPasswordPage() {
  const [isLoading, setIsLoading] = useState(false);
  const [isSubmitted, setIsSubmitted] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<ForgotPasswordInput>({
    resolver: zodResolver(forgotPasswordSchema),
  });

  const onSubmit = async (data: ForgotPasswordInput) => {
    setIsLoading(true);
    try {
      // TODO: Implement password reset API call
      await new Promise((resolve) => setTimeout(resolve, 1000));
      setIsSubmitted(true);
    } catch (error) {
      toast.error("Failed to send reset email");
    } finally {
      setIsLoading(false);
    }
  };

  if (isSubmitted) {
    return (
      <div className="text-center">
        <div className="w-16 h-16 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mx-auto mb-4">
          <CheckCircle className="h-8 w-8 text-green-600" />
        </div>
        <h2 className="text-2xl font-bold mb-2">Check your email</h2>
        <p className="text-muted-foreground mb-6">
          We've sent a password reset link to your email address.
        </p>
        <Button variant="outline" asChild>
          <Link href="/login">
            <ArrowLeft className="mr-2 h-4 w-4" />
            Back to Login
          </Link>
        </Button>
      </div>
    );
  }

  return (
    <div>
      <div className="mb-8">
        <h2 className="text-2xl font-bold">Forgot password?</h2>
        <p className="text-muted-foreground mt-1">
          Enter your email and we'll send you a reset link
        </p>
      </div>

      <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
        <div>
          <label className="block text-sm font-medium mb-2">Email</label>
          <Input
            type="email"
            placeholder="Enter your email"
            {...register("email")}
            error={errors.email?.message}
            leftIcon={<Mail className="h-5 w-5" />}
          />
        </div>

        <Button type="submit" className="w-full" size="lg" isLoading={isLoading}>
          Send Reset Link
        </Button>

        <p className="text-center text-sm text-muted-foreground">
          Remember your password?{" "}
          <Link href="/login" className="text-primary hover:underline font-medium">
            Sign in
          </Link>
        </p>
      </form>
    </div>
  );
}import { Metadata } from "next";
import { LoginForm } from "@/components/forms";

export const metadata: Metadata = {
  title: "Login",
};

export default function LoginPage() {
  return (
    <div>
      <div className="mb-8">
        <h2 className="text-2xl font-bold">Welcome back</h2>
        <p className="text-muted-foreground mt-1">
          Sign in to your account to continue
        </p>
      </div>
      <LoginForm />
    </div>
  );
}import { Metadata } from "next";
import { RegisterForm } from "@/components/forms";

export const metadata: Metadata = {
  title: "Create Account",
};

export default function RegisterPage() {
  return (
    <div>
      <div className="mb-8">
        <h2 className="text-2xl font-bold">Create an account</h2>
        <p className="text-muted-foreground mt-1">
          Join SureShops to discover amazing deals
        </p>
      </div>
      <RegisterForm />
    </div>
  );
}import { Logo } from "@/components/common";

export default function AuthLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <div className="min-h-screen flex">
      {/* Left Side - Branding */}
      <div className="hidden lg:flex lg:w-1/2 bg-foreground text-background flex-col justify-between p-12">
        <Logo className="text-background [&_div]:bg-background [&_span]:text-background" />
        
        <div className="space-y-6">
          <h1 className="text-4xl font-bold leading-tight">
            Discover the best products from local shops across Nigeria
          </h1>
          <p className="text-lg text-background/80">
            Compare prices, find deals, and support local businesses in your community.
          </p>
        </div>

        <p className="text-sm text-background/60">
          Â© {new Date().getFullYear()} SureShops. All rights reserved.
        </p>
      </div>

      {/* Right Side - Form */}
      <div className="flex-1 flex items-center justify-center p-8">
        <div className="w-full max-w-md">
          <div className="lg:hidden mb-8">
            <Logo />
          </div>
          {children}
        </div>
      </div>
    </div>
  );
}"use client";

import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { BackButton, Pagination, LoadingState } from "@/components/common";
import { ProductGrid } from "@/components/products";
import { SearchFilters } from "@/components/search";
import { searchService } from "@/services";
import { CATEGORIES } from "@/lib/constants";

interface CategoryPageProps {
  params: { category: string };
}

export default function CategoryPage({ params }: CategoryPageProps) {
  const [page, setPage] = useState(1);
  const [filters, setFilters] = useState<any>({});

  const category = CATEGORIES.find((c) => c.slug === params.category);
  const categoryName = category?.name || params.category;

  const { data, isLoading } = useQuery({
    queryKey: ["category-products", params.category, page, filters],
    queryFn: () =>
      searchService.searchProducts({
        query: "",
        category: categoryName,
        page,
        limit: 20,
        ...filters,
      }),
  });

  const handleFilterChange = (key: string, value: any) => {
    setFilters((prev: any) => ({ ...prev, [key]: value }));
    setPage(1);
  };

  return (
    <div className="container-premium py-6">
      <BackButton className="mb-6" />

      <div className="mb-6">
        <div className="flex items-center gap-3 mb-2">
          {category && <span className="text-4xl">{category.icon}</span>}
          <h1 className="text-3xl font-bold">{categoryName}</h1>
        </div>
        {data?.total !== undefined && (
          <p className="text-muted-foreground">
            {data.total} products found
          </p>
        )}
      </div>

      <SearchFilters
        filters={filters}
        onFilterChange={handleFilterChange}
        onClearFilters={() => {
          setFilters({});
          setPage(1);
        }}
        className="mb-6"
      />

      {isLoading ? (
        <LoadingState />
      ) : (
        <>
          <ProductGrid products={data?.items || []} />
          {data && data.totalPages > 1 && (
            <Pagination
              currentPage={page}
              totalPages={data.totalPages}
              onPageChange={setPage}
              className="mt-8"
            />
          )}
        </>
      )}
    </div>
  );
}import { Metadata } from "next";
import Link from "next/link";
import { Card } from "@/components/ui";
import { CATEGORIES } from "@/lib/constants";

export const metadata: Metadata = {
  title: "Categories",
};

export default function CategoriesPage() {
  return (
    <div className="container-premium py-8">
      <div className="mb-8">
        <h1 className="text-3xl font-bold">All Categories</h1>
        <p className="text-muted-foreground mt-1">
          Browse products by category
        </p>
      </div>

      <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-4">
        {CATEGORIES.map((category) => (
          <Link key={category.slug} href={`/categories/${category.slug}`}>
            <Card className="p-6 text-center hover:shadow-lg transition-all cursor-pointer group">
              <span className="text-4xl mb-4 block">{category.icon}</span>
              <h3 className="font-medium group-hover:text-primary transition-colors">
                {category.name}
              </h3>
            </Card>
          </Link>
        ))}
      </div>
    </div>
  );
}"use client";

import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { Search } from "lucide-react";
import { Input, Button, Card } from "@/components/ui";
import { BackButton, LoadingState, EmptyState } from "@/components/common";
import { PriceComparison } from "@/components/products";
import { searchService } from "@/services";
import { Package } from "lucide-react";

export default function ComparePage() {
  const [searchQuery, setSearchQuery] = useState("");
  const [submittedQuery, setSubmittedQuery] = useState("");

  const { data, isLoading } = useQuery({
    queryKey: ["product-compare", submittedQuery],
    queryFn: () => searchService.getProductVendors(submittedQuery),
    enabled: !!submittedQuery,
  });

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (searchQuery.trim()) {
      setSubmittedQuery(searchQuery.trim());
    }
  };

  return (
    <div className="container-premium py-6">
      <BackButton className="mb-6" />

      <div className="max-w-3xl mx-auto">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold mb-2">Compare Prices</h1>
          <p className="text-muted-foreground">
            Search for a product to compare prices across different vendors
          </p>
        </div>

        {/* Search Form */}
        <Card className="p-6 mb-8">
          <form onSubmit={handleSearch} className="flex gap-4">
            <div className="flex-1 relative">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 h-5 w-5 text-muted-foreground" />
              <Input
                type="text"
                placeholder="Enter product name (e.g., iPhone 15 Pro Max)"
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="pl-12 h-12"
              />
            </div>
            <Button type="submit" size="lg" disabled={!searchQuery.trim()}>
              Compare
            </Button>
          </form>
        </Card>

        {/* Results */}
        {isLoading ? (
          <LoadingState text="Finding prices..." />
        ) : data ? (
          <div className="space-y-6">
            <div className="text-center">
              <h2 className="text-xl font-semibold">{data.name}</h2>
              {data.brand && (
                <p className="text-muted-foreground">{data.brand}</p>
              )}
              <div className="mt-2 flex justify-center gap-4 text-sm">
                <span>
                  <strong className="text-green-600">
                    â‚¦{data.priceRange.lowest.toLocaleString()}
                  </strong>{" "}
                  lowest
                </span>
                <span>
                  <strong>â‚¦{data.priceRange.average.toLocaleString()}</strong>{" "}
                  average
                </span>
                <span>
                  <strong className="text-red-600">
                    â‚¦{data.priceRange.highest.toLocaleString()}
                  </strong>{" "}
                  highest
                </span>
              </div>
            </div>

            <PriceComparison vendors={data.vendors} />
          </div>
        ) : submittedQuery ? (
          <EmptyState
            icon={<Package className="h-10 w-10" />}
            title="No results found"
            description={`No vendors found selling "${submittedQuery}"`}
          />
        ) : (
          <div className="text-center py-12">
            <Package className="h-16 w-16 mx-auto text-muted-foreground mb-4" />
            <p className="text-muted-foreground">
              Enter a product name to see price comparisons
            </p>
          </div>
        )}
      </div>
    </div>
  );
}"use client";

import { useState } from "react";
import Image from "next/image";
import Link from "next/link";
import {
  ChevronLeft,
  ChevronRight,
  Share2,
  Heart,
  Store,
  MapPin,
  Phone,
  MessageCircle,
} from "lucide-react";
import { Button, Card, Badge } from "@/components/ui";
import {
  BackButton,
  PriceTag,
  Rating,
  VerifiedBadge,
  LoadingState,
} from "@/components/common";
import { PriceComparison } from "@/components/products";
import { useProduct } from "@/hooks";
import { searchService } from "@/services";
import { useQuery } from "@tanstack/react-query";

interface ProductPageProps {
  params: { id: string };
}

export default function ProductPage({ params }: ProductPageProps) {
  const { data: product, isLoading } = useProduct(params.id);
  const [currentImageIndex, setCurrentImageIndex] = useState(0);
  const [showAllVendors, setShowAllVendors] = useState(false);

  // Fetch vendors selling this product
  const { data: productVendors } = useQuery({
    queryKey: ["product-vendors", product?.name],
    queryFn: () => searchService.getProductVendors(product!.name),
    enabled: !!product?.name,
  });

  // Fetch similar products
  const { data: similarProducts } = useQuery({
    queryKey: ["similar-products", params.id],
    queryFn: () => searchService.getSimilarProducts(params.id),
    enabled: !!params.id,
  });

  if (isLoading) {
    return (
      <div className="container-premium py-6">
        <LoadingState />
      </div>
    );
  }

  if (!product) {
    return (
      <div className="container-premium py-6">
        <p>Product not found</p>
      </div>
    );
  }

  const images = product.images?.length > 0 ? product.images : ["/placeholder.jpg"];
  const vendor = product.vendorId as any;

  return (
    <div className="container-premium py-6">
      <BackButton className="mb-6" />

      <div className="grid grid-cols-1 lg:grid-cols-2 gap-8">
        {/* Image Gallery */}
        <div className="space-y-4">
          <div className="relative aspect-square rounded-2xl overflow-hidden bg-muted">
            <Image
              src={images[currentImageIndex]}
              alt={product.name}
              fill
              className="object-cover"
              priority
            />

            {/* Navigation Arrows */}
            {images.length > 1 && (
              <>
                <button
                  onClick={() =>
                    setCurrentImageIndex((prev) =>
                      prev === 0 ? images.length - 1 : prev - 1
                    )
                  }
                  className="absolute left-4 top-1/2 -translate-y-1/2 p-2 rounded-full bg-background/80 hover:bg-background transition-colors"
                >
                  <ChevronLeft className="h-5 w-5" />
                </button>
                <button
                  onClick={() =>
                    setCurrentImageIndex((prev) =>
                      prev === images.length - 1 ? 0 : prev + 1
                    )
                  }
                  className="absolute right-4 top-1/2 -translate-y-1/2 p-2 rounded-full bg-background/80 hover:bg-background transition-colors"
                >
                  <ChevronRight className="h-5 w-5" />
                </button>
              </>
            )}

            {/* Stock Badge */}
            {!product.inStock && (
              <Badge variant="destructive" className="absolute top-4 left-4">
                Out of Stock
              </Badge>
            )}
          </div>

          {/* Thumbnails */}
          {images.length > 1 && (
            <div className="flex gap-2 overflow-x-auto no-scrollbar">
              {images.map((image, index) => (
                <button
                  key={index}
                  onClick={() => setCurrentImageIndex(index)}
                  className={`relative w-20 h-20 rounded-lg overflow-hidden flex-shrink-0 border-2 transition-colors ${
                    index === currentImageIndex
                      ? "border-primary"
                      : "border-transparent"
                  }`}
                >
                  <Image
                    src={image}
                    alt={`${product.name} ${index + 1}`}
                    fill
                    className="object-cover"
                  />
                </button>
              ))}
            </div>
          )}
        </div>

        {/* Product Info */}
        <div className="space-y-6">
          {/* Header */}
          <div>
            {product.brand && (
              <p className="text-sm text-muted-foreground mb-1">{product.brand}</p>
            )}
            <h1 className="text-2xl md:text-3xl font-bold">{product.name}</h1>

            {/* Category */}
            <div className="flex items-center gap-2 mt-2">
              <Badge variant="secondary">{product.category}</Badge>
              {product.subcategory && (
                <Badge variant="outline">{product.subcategory}</Badge>
              )}
            </div>
          </div>

          {/* Price */}
          <div className="pb-6 border-b border-border">
            <PriceTag
              price={product.price}
              originalPrice={product.originalPrice}
              size="lg"
            />
            {productVendors && productVendors.totalVendors > 1 && (
              <p className="text-sm text-muted-foreground mt-2">
                Available from {productVendors.totalVendors} vendors â€¢
                Prices from {productVendors.priceRange.lowest.toLocaleString()} to{" "}
                {productVendors.priceRange.highest.toLocaleString()} NGN
              </p>
            )}
          </div>

          {/* Vendor Card */}
          {vendor && (
            <Card className="p-4">
              <div className="flex items-start gap-4">
                <div className="w-16 h-16 rounded-lg bg-muted overflow-hidden flex-shrink-0">
                  {vendor.shopImages?.logo ? (
                    <Image
                      src={vendor.shopImages.logo}
                      alt={vendor.businessName}
                      width={64}
                      height={64}
                      className="object-cover w-full h-full"
                    />
                  ) : (
                    <div className="w-full h-full flex items-center justify-center text-2xl">
                      ðŸª
                    </div>
                  )}
                </div>
                <div className="flex-1 min-w-0">
                  <div className="flex items-center gap-2">
                    <Link
                      href={`/shops/${vendor._id}`}
                      className="font-semibold hover:text-primary transition-colors"
                    >
                      {vendor.businessName}
                    </Link>
                    {vendor.isVerified && <VerifiedBadge size="sm" />}
                  </div>
                  <Rating value={vendor.rating || 0} size="sm" className="mt-1" />
                  <div className="flex items-center gap-1 text-sm text-muted-foreground mt-1">
                    <MapPin className="h-4 w-4" />
                    <span className="truncate">
                      {vendor.shopNumber && `${vendor.shopNumber}, `}
                      {vendor.marketId?.name || vendor.areaId?.name}
                    </span>
                  </div>
                </div>
              </div>

              {/* Contact Actions */}
              <div className="flex gap-2 mt-4">
                <Button
                  className="flex-1"
                  onClick={() => window.open(`tel:${vendor.contactDetails.phone}`)}
                >
                  <Phone className="mr-2 h-4 w-4" />
                  Call
                </Button>
                {vendor.contactDetails.whatsapp && (
                  <Button
                    variant="outline"
                    className="flex-1"
                    onClick={() =>
                      window.open(
                        `https://wa.me/${vendor.contactDetails.whatsapp?.replace(
                          /\D/g,
                          ""
                        )}`
                      )
                    }
                  >
                    <MessageCircle className="mr-2 h-4 w-4" />
                    WhatsApp
                  </Button>
                )}
                <Button
                  variant="ghost"
                  size="icon"
                  onClick={() => {
                    navigator.share?.({
                      title: product.name,
                      url: window.location.href,
                    });
                  }}
                >
                  <Share2 className="h-4 w-4" />
                </Button>
                <Button variant="ghost" size="icon">
                  <Heart className="h-4 w-4" />
                </Button>
              </div>
            </Card>
          )}

          {/* Description */}
          {product.description && (
            <div>
              <h3 className="font-semibold mb-2">Description</h3>
              <p className="text-muted-foreground">{product.description}</p>
            </div>
          )}

          {/* Specifications */}
          {product.specifications && Object.keys(product.specifications).length > 0 && (
            <div>
              <h3 className="font-semibold mb-2">Specifications</h3>
              <div className="grid grid-cols-2 gap-2 text-sm">
                {Object.entries(product.specifications).map(([key, value]) => (
                  <div key={key} className="flex justify-between p-2 bg-muted/50 rounded-lg">
                    <span className="text-muted-foreground">{key}</span>
                    <span className="font-medium">{String(value)}</span>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </div>

      {/* Price Comparison */}
      {productVendors && productVendors.vendors.length > 1 && (
        <div className="mt-12">
          <PriceComparison
            vendors={showAllVendors ? productVendors.vendors : productVendors.vendors.slice(0, 5)}
          />
          {productVendors.vendors.length > 5 && !showAllVendors && (
            <div className="text-center mt-4">
              <Button variant="outline" onClick={() => setShowAllVendors(true)}>
                Show All {productVendors.vendors.length} Vendors
              </Button>
            </div>
          )}
        </div>
      )}
    </div>
  );
}"use client";

import { useState } from "react";
import { Heart, Store, Package } from "lucide-react";
import { Button, Card } from "@/components/ui";
import { LoadingState, EmptyState } from "@/components/common";
import { ProductGrid } from "@/components/products";
import { ShopGrid } from "@/components/shops";
import { useFavoriteProducts, useFavoriteVendors } from "@/hooks/use-favorites";
import { cn } from "@/lib/utils";

type Tab = "products" | "shops";

export default function FavoritesPage() {
  const [activeTab, setActiveTab] = useState<Tab>("products");

  const { data: products, isLoading: productsLoading } = useFavoriteProducts();
  const { data: vendors, isLoading: vendorsLoading } = useFavoriteVendors();

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">My Favorites</h1>

      {/* Tabs */}
      <div className="flex gap-2">
        <Button
          variant={activeTab === "products" ? "default" : "outline"}
          onClick={() => setActiveTab("products")}
        >
          <Package className="mr-2 h-4 w-4" />
          Products ({products?.length || 0})
        </Button>
        <Button
          variant={activeTab === "shops" ? "default" : "outline"}
          onClick={() => setActiveTab("shops")}
        >
          <Store className="mr-2 h-4 w-4" />
          Shops ({vendors?.length || 0})
        </Button>
      </div>

      {/* Content */}
      {activeTab === "products" ? (
        productsLoading ? (
          <LoadingState />
        ) : products && products.length > 0 ? (
          <ProductGrid
            products={products.map((f) => ({
              id: f.productId?.id || "",
              name: f.productId?.name || "",
              price: f.productId?.price || 0,
              images: f.productId?.images || [],
              category: f.productId?.category || "",
              inStock: true,
              currency: "NGN",
              vendor: {
                id: "",
                businessName: "",
                rating: 0,
                isVerified: false,
                contactDetails: { phone: "" },
              },
              location: {
                state: { id: "", name: "" },
                area: { id: "", name: "" },
              },
            }))}
          />
        ) : (
          <EmptyState
            icon={<Heart className="h-10 w-10" />}
            title="No favorite products"
            description="Products you favorite will appear here"
          />
        )
      ) : vendorsLoading ? (
        <LoadingState />
      ) : vendors && vendors.length > 0 ? (
        <ShopGrid
          shops={vendors.map((f) => ({
            id: f.vendorId?.id || "",
            businessName: f.vendorId?.businessName || "",
            businessDescription: f.vendorId?.businessDescription,
            vendorType: "market_shop",
            rating: f.vendorId?.rating || 0,
            reviewCount: 0,
            totalProducts: f.vendorId?.totalProducts || 0,
            isVerified: false,
            isFeatured: false,
            categories: [],
            priceRange: { min: 0, max: 0 },
            contactDetails: {},
            location: {
              state: { id: "", name: "" },
              area: { id: "", name: "" },
            },
          }))}
        />
      ) : (
        <EmptyState
          icon={<Store className="h-10 w-10" />}
          title="No favorite shops"
          description="Shops you favorite will appear here"
        />
      )}
    </div>
  );
}"use client";

import { useState } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { useAuth } from "@/hooks";
import { Card, Button, Input, Avatar } from "@/components/ui";
import { authService, uploadService } from "@/services";
import { useAuthStore } from "@/store";
import { Camera, Save } from "lucide-react";
import toast from "react-hot-toast";

const profileSchema = z.object({
  firstName: z.string().min(2, "First name is required"),
  lastName: z.string().min(2, "Last name is required"),
  phone: z.string().min(10, "Valid phone number required"),
});

type ProfileInput = z.infer<typeof profileSchema>;

export default function SettingsPage() {
  const { user } = useAuth();
  const { setUser } = useAuthStore();
  const [isLoading, setIsLoading] = useState(false);
  const [uploadingAvatar, setUploadingAvatar] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<ProfileInput>({
    resolver: zodResolver(profileSchema),
    defaultValues: {
      firstName: user?.firstName || "",
      lastName: user?.lastName || "",
      phone: user?.phone || "",
    },
  });

  const onSubmit = async (data: ProfileInput) => {
    setIsLoading(true);
    try {
      const updated = await authService.updateProfile(data);
      setUser(updated);
      toast.success("Profile updated successfully");
    } catch (error: any) {
      toast.error(error.response?.data?.message || "Failed to update profile");
    } finally {
      setIsLoading(false);
    }
  };

  const handleAvatarUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setUploadingAvatar(true);
    try {
      const result = await uploadService.uploadProductImage(file);
      const updated = await authService.updateProfile({ avatar: result.url } as any);
      setUser(updated);
      toast.success("Avatar updated successfully");
    } catch (error) {
      toast.error("Failed to upload avatar");
    } finally {
      setUploadingAvatar(false);
    }
  };

  if (!user) return null;

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">Settings</h1>

      {/* Avatar */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Profile Picture</h2>
        <div className="flex items-center gap-4">
          <div className="relative">
            <Avatar
              src={user.avatar}
              name={`${user.firstName} ${user.lastName}`}
              size="xl"
            />
            <label className="absolute bottom-0 right-0 p-2 bg-primary text-primary-foreground rounded-full cursor-pointer hover:bg-primary/90 transition-colors">
              <Camera className="h-4 w-4" />
              <input
                type="file"
                accept="image/*"
                onChange={handleAvatarUpload}
                disabled={uploadingAvatar}
                className="hidden"
              />
            </label>
          </div>
          <div>
            <p className="font-medium">{user.firstName} {user.lastName}</p>
            <p className="text-sm text-muted-foreground">
              {uploadingAvatar ? "Uploading..." : "Click the camera to change"}
            </p>
          </div>
        </div>
      </Card>

      {/* Profile Form */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Personal Information</h2>
        <form onSubmit={handleSubmit(onSubmit)} className="space-y-4">
          <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label className="block text-sm font-medium mb-2">
                First Name
              </label>
              <Input {...register("firstName")} error={errors.firstName?.message} />
            </div>
            <div>
              <label className="block text-sm font-medium mb-2">
                Last Name
              </label>
              <Input {...register("lastName")} error={errors.lastName?.message} />
            </div>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Email</label>
            <Input value={user.email} disabled />
            <p className="text-xs text-muted-foreground mt-1">
              Email cannot be changed
            </p>
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Phone</label>
            <Input {...register("phone")} error={errors.phone?.message} />
          </div>

          <Button type="submit" isLoading={isLoading}>
            <Save className="mr-2 h-4 w-4" />
            Save Changes
          </Button>
        </form>
      </Card>
    </div>
  );
}"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { User, Heart, Settings, Package } from "lucide-react";
import { cn } from "@/lib/utils";
import { useAuth } from "@/hooks";
import { LoadingState } from "@/components/common";

const profileNav = [
  { href: "/profile", icon: User, label: "Profile" },
  { href: "/profile/favorites", icon: Heart, label: "Favorites" },
  { href: "/profile/settings", icon: Settings, label: "Settings" },
];

export default function ProfileLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const pathname = usePathname();
  const { isLoading, isAuthenticated } = useAuth(true);

  if (isLoading) {
    return <LoadingState />;
  }

  if (!isAuthenticated) {
    return null;
  }

  return (
    <div className="container-premium py-6">
      <div className="flex flex-col md:flex-row gap-6">
        {/* Sidebar */}
        <aside className="w-full md:w-64 flex-shrink-0">
          <nav className="flex md:flex-col gap-2 overflow-x-auto md:overflow-visible no-scrollbar">
            {profileNav.map((item) => {
              const Icon = item.icon;
              const isActive = pathname === item.href;
              return (
                <Link
                  key={item.href}
                  href={item.href}
                  className={cn(
                    "flex items-center gap-3 px-4 py-3 rounded-lg text-sm font-medium transition-colors whitespace-nowrap",
                    isActive
                      ? "bg-primary text-primary-foreground"
                      : "hover:bg-muted"
                  )}
                >
                  <Icon className="h-5 w-5" />
                  {item.label}
                </Link>
              );
            })}
          </nav>
        </aside>

        {/* Content */}
        <main className="flex-1 min-w-0">{children}</main>
      </div>
    </div>
  );
}"use client";

import { useAuth } from "@/hooks";
import { Card, Avatar, Button, Badge } from "@/components/ui";
import { Mail, Phone, Calendar, Edit } from "lucide-react";
import Link from "next/link";

export default function ProfilePage() {
  const { user } = useAuth();

  if (!user) return null;

  return (
    <div className="space-y-6">
      <h1 className="text-2xl font-bold">My Profile</h1>

      <Card className="p-6">
        <div className="flex items-start gap-6">
          <Avatar
            src={user.avatar}
            name={`${user.firstName} ${user.lastName}`}
            size="xl"
          />
          <div className="flex-1">
            <div className="flex items-center gap-2">
              <h2 className="text-xl font-semibold">
                {user.firstName} {user.lastName}
              </h2>
              <Badge variant={user.role === "vendor" ? "default" : "secondary"}>
                {user.role}
              </Badge>
            </div>

            <div className="mt-4 space-y-2 text-sm text-muted-foreground">
              <div className="flex items-center gap-2">
                <Mail className="h-4 w-4" />
                <span>{user.email}</span>
                {user.isEmailVerified && (
                  <Badge variant="success" className="text-xs">
                    Verified
                  </Badge>
                )}
              </div>
              <div className="flex items-center gap-2">
                <Phone className="h-4 w-4" />
                <span>{user.phone}</span>
              </div>
              <div className="flex items-center gap-2">
                <Calendar className="h-4 w-4" />
                <span>Joined {new Date(user.createdAt).toLocaleDateString()}</span>
              </div>
            </div>

            <div className="mt-6">
              <Button asChild>
                <Link href="/profile/settings">
                  <Edit className="mr-2 h-4 w-4" />
                  Edit Profile
                </Link>
              </Button>
            </div>
          </div>
        </div>
      </Card>

      {/* Vendor CTA */}
      {user.role === "user" && (
        <Card className="p-6 bg-muted/50">
          <h3 className="font-semibold mb-2">Become a Vendor</h3>
          <p className="text-sm text-muted-foreground mb-4">
            Start selling your products on SureShops and reach thousands of customers.
          </p>
          <Button asChild>
            <Link href="/vendor">Start Selling</Link>
          </Button>
        </Card>
      )}

      {user.role === "vendor" && (
        <Card className="p-6 bg-muted/50">
          <h3 className="font-semibold mb-2">Vendor Dashboard</h3>
          <p className="text-sm text-muted-foreground mb-4">
            Manage your shop, products, and view analytics.
          </p>
          <Button asChild>
            <Link href="/vendor/dashboard">Go to Dashboard</Link>
          </Button>
        </Card>
      )}
    </div>
  );
}"use client";

import { useSearchParams, useRouter } from "next/navigation";
import { useEffect, useState } from "react";
import { SearchBar, SearchFilters, SearchResults } from "@/components/search";
import { BackButton } from "@/components/common";
import { useSearch } from "@/hooks";
import { SearchType } from "@/types";

export default function SearchPage() {
  const searchParams = useSearchParams();
  const router = useRouter();
  const initialQuery = searchParams.get("query") || "";
  
  const {
    query,
    filters,
    results,
    isLoading,
    setQuery,
    updateFilter,
    clearFilters,
  } = useSearch();

  const [searchType, setSearchType] = useState<SearchType>("all");

  useEffect(() => {
    if (initialQuery && !query) {
      setQuery(initialQuery);
    }
  }, [initialQuery]);

  const handlePageChange = (page: number) => {
    updateFilter("page", page);
    window.scrollTo({ top: 0, behavior: "smooth" });
  };

  const handleSearchTypeChange = (type: SearchType) => {
    setSearchType(type);
    updateFilter("searchType", type);
  };

  return (
    <div className="container-premium py-6">
      {/* Header */}
      <div className="mb-6">
        <BackButton />
      </div>

      {/* Search Bar */}
      <div className="mb-6">
        <SearchBar
          placeholder="Search products, shops, brands..."
          autoFocus
        />
      </div>

      {/* Filters */}
      <SearchFilters
        filters={filters}
        availableFilters={results?.availableFilters}
        onFilterChange={updateFilter}
        onClearFilters={clearFilters}
        className="mb-6"
      />

      {/* Results */}
      <SearchResults
        results={results}
        isLoading={isLoading}
        searchType={searchType}
        onSearchTypeChange={handleSearchTypeChange}
        onPageChange={handlePageChange}
        currentPage={filters.page || 1}
      />
    </div>
  );
}"use client";

import { useState } from "react";
import { useQuery } from "@tanstack/react-query";
import { BackButton, Pagination, LoadingState } from "@/components/common";
import { ShopGrid } from "@/components/shops";
import { LocationFilter } from "@/components/search";
import { Select, Input, Button, Card } from "@/components/ui";
import { vendorService } from "@/services";
import { Search, SlidersHorizontal } from "lucide-react";
import { VENDOR_TYPES } from "@/lib/constants";
import { vendorToDisplayData } from "@/types/shop-display";

export default function ShopsPage() {
  const [page, setPage] = useState(1);
  const [search, setSearch] = useState("");
  const [filters, setFilters] = useState<any>({});
  const [showFilters, setShowFilters] = useState(false);

  const { data, isLoading } = useQuery({
    queryKey: ["shops", page, search, filters],
    queryFn: () =>
      vendorService.getAll({
        page,
        limit: 12,
        search: search || undefined,
        ...filters,
      }),
  });

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    setPage(1);
  };

  return (
    <div className="container-premium py-6">
      <div className="mb-8">
        <h1 className="text-3xl font-bold">All Shops</h1>
        <p className="text-muted-foreground mt-1">
          Discover local shops and vendors
        </p>
      </div>

      {/* Search & Filters */}
      <Card className="p-4 mb-6">
        <form onSubmit={handleSearch} className="flex gap-4 flex-wrap">
          <div className="flex-1 min-w-[200px] relative">
            <Search className="absolute left-3 top-1/2 -translate-y-1/2 h-4 w-4 text-muted-foreground" />
            <Input
              placeholder="Search shops..."
              value={search}
              onChange={(e) => setSearch(e.target.value)}
              className="pl-10"
            />
          </div>

          <LocationFilter
            stateId={filters.stateId}
            areaId={filters.areaId}
            marketId={filters.marketId}
            onStateChange={(id) => setFilters((f: any) => ({ ...f, stateId: id, areaId: undefined, marketId: undefined }))}
            onAreaChange={(id) => setFilters((f: any) => ({ ...f, areaId: id, marketId: undefined }))}
            onMarketChange={(id) => setFilters((f: any) => ({ ...f, marketId: id }))}
          />

          <Select
            value={filters.vendorType || ""}
            onChange={(value) => setFilters((f: any) => ({ ...f, vendorType: value || undefined }))}
            options={[{ value: "", label: "All Types" }, ...VENDOR_TYPES]}
            className="w-40"
          />

          <Button
            type="button"
            variant="outline"
            onClick={() => setShowFilters(!showFilters)}
          >
            <SlidersHorizontal className="h-4 w-4 mr-2" />
            Filters
          </Button>
        </form>

        {showFilters && (
          <div className="mt-4 pt-4 border-t border-border flex flex-wrap gap-4">
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={filters.isVerified === true}
                onChange={(e) =>
                  setFilters((f: any) => ({
                    ...f,
                    isVerified: e.target.checked || undefined,
                  }))
                }
                className="rounded border-input"
              />
              <span className="text-sm">Verified Only</span>
            </label>
            <label className="flex items-center gap-2 cursor-pointer">
              <input
                type="checkbox"
                checked={filters.isFeatured === true}
                onChange={(e) =>
                  setFilters((f: any) => ({
                    ...f,
                    isFeatured: e.target.checked || undefined,
                  }))
                }
                className="rounded border-input"
              />
              <span className="text-sm">Featured Only</span>
            </label>
            <Button
              variant="ghost"
              size="sm"
              onClick={() => {
                setFilters({});
                setSearch("");
                setPage(1);
              }}
            >
              Clear All
            </Button>
          </div>
        )}
      </Card>

      {/* Results */}
      {isLoading ? (
        <LoadingState />
      ) : (
        <>
          <div className="mb-4 text-sm text-muted-foreground">
            {data?.total || 0} shops found
          </div>
          <ShopGrid  shops={(data?.vendors || []).map(vendorToDisplayData)} />
          {data && data.totalPages > 1 && (
            <Pagination
              currentPage={page}
              totalPages={data.totalPages}
              onPageChange={setPage}
              className="mt-8"
            />
          )}
        </>
      )}
    </div>
  );
}"use client";

import { Package, Eye, Star, TrendingUp } from "lucide-react";
import { Card } from "@/components/ui";
import { useMyShop, useMyProducts } from "@/hooks";
import { LoadingState } from "@/components/common";
import { formatNumber } from "@/lib/utils";

export default function VendorDashboardPage() {
  const { data: shop, isLoading: shopLoading } = useMyShop();
  const { data: products, isLoading: productsLoading } = useMyProducts();

  if (shopLoading || productsLoading) {
    return <LoadingState />;
  }

  const stats = [
    {
      label: "Total Products",
      value: products?.length || 0,
      icon: Package,
      trend: "+12%",
    },
    {
      label: "Total Views",
      value: shop?.totalViews || 0,
      icon: Eye,
      trend: "+8%",
    },
    {
      label: "Rating",
      value: shop?.rating?.toFixed(1) || "0.0",
      icon: Star,
      trend: "+0.2",
    },
    // {
    //   label: "Search Appearances",
    //   value: shop?.searchAppearances || 0,
    //   icon: TrendingUp,
    //   trend: "+15%",
    // },
  ];

  return (
    <div className="space-y-8">
      <div>
        <h1 className="text-2xl font-bold">Dashboard</h1>
        <p className="text-muted-foreground">
          Welcome back, {shop?.businessName || "Vendor"}
        </p>
      </div>

      {/* Stats Grid */}
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-4">
        {stats.map((stat) => {
          const Icon = stat.icon;
          return (
            <Card key={stat.label} className="p-6">
              <div className="flex items-center justify-between">
                <div>
                  <p className="text-sm text-muted-foreground">{stat.label}</p>
                  <p className="text-2xl font-bold mt-1">
                    {typeof stat.value === "number"
                      ? formatNumber(stat.value)
                      : stat.value}
                  </p>
                </div>
                <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center">
                  <Icon className="h-6 w-6" />
                </div>
              </div>
              <p className="text-sm text-green-600 mt-2">{stat.trend} this month</p>
            </Card>
          );
        })}
      </div>

      {/* Quick Actions */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Quick Actions</h2>
        <div className="grid grid-cols-2 md:grid-cols-4 gap-4">
          <a
            href="/vendor/products/new"
            className="p-4 rounded-lg border border-border hover:bg-muted transition-colors text-center"
          >
            <Package className="h-6 w-6 mx-auto mb-2" />
            <span className="text-sm">Add Product</span>
          </a>
          <a
            href="/vendor/products"
            className="p-4 rounded-lg border border-border hover:bg-muted transition-colors text-center"
          >
            <Eye className="h-6 w-6 mx-auto mb-2" />
            <span className="text-sm">View Products</span>
          </a>
          <a
            href="/vendor/settings"
            className="p-4 rounded-lg border border-border hover:bg-muted transition-colors text-center"
          >
            <Star className="h-6 w-6 mx-auto mb-2" />
            <span className="text-sm">Shop Settings</span>
          </a>
          <a
            href={`/shops/${shop?.id}`}
            className="p-4 rounded-lg border border-border hover:bg-muted transition-colors text-center"
          >
            <TrendingUp className="h-6 w-6 mx-auto mb-2" />
            <span className="text-sm">View Shop</span>
          </a>
        </div>
      </Card>
    </div>
  );
}"use client";

import { useRouter } from "next/navigation";
import { Card } from "@/components/ui";
import { BackButton } from "@/components/common";
import { ProductForm } from "@/components/forms/product-form";
import { useCreateProduct } from "@/hooks";

export default function NewProductPage() {
  const router = useRouter();
  const createProduct = useCreateProduct();

  const handleSubmit = async (data: any) => {
    try {
      await createProduct.mutateAsync(data);
      router.push("/vendor/products");
    } catch (error) {
      // Error handled by mutation
    }
  };

  return (
    <div className="space-y-6">
      <BackButton label="Back to Products" href="/vendor/products" />

      <div>
        <h1 className="text-2xl font-bold">Add New Product</h1>
        <p className="text-muted-foreground">
          Add a new product to your inventory
        </p>
      </div>

      <Card className="p-6">
        <ProductForm
          onSubmit={handleSubmit}
          isLoading={createProduct.isPending}
        />
      </Card>
    </div>
  );
}"use client";

import { useState } from "react";
import Link from "next/link";
import Image from "next/image";
import { Plus, Edit, Trash2, MoreHorizontal, Eye } from "lucide-react";
import { Card, Button, Badge, Input } from "@/components/ui";
import { LoadingState, EmptyState, Pagination } from "@/components/common";
import { useMyProducts, useDeleteProduct } from "@/hooks";
import { formatPrice } from "@/lib/utils";

export default function VendorProductsPage() {
  const [search, setSearch] = useState("");
  const { data: products, isLoading } = useMyProducts();
  const deleteProduct = useDeleteProduct();

  const filteredProducts = products?.filter((p) =>
    p.name.toLowerCase().includes(search.toLowerCase())
  );

  if (isLoading) {
    return <LoadingState />;
  }

  return (
    <div className="space-y-6">
      <div className="flex items-center justify-between">
        <div>
          <h1 className="text-2xl font-bold">My Products</h1>
          <p className="text-muted-foreground">
            Manage your product listings
          </p>
        </div>
        <Button asChild>
          <Link href="/vendor/products/new">
            <Plus className="mr-2 h-4 w-4" />
            Add Product
          </Link>
        </Button>
      </div>

      {/* Search */}
      <Input
        placeholder="Search products..."
        value={search}
        onChange={(e) => setSearch(e.target.value)}
        className="max-w-sm"
      />

      {/* Products Table */}
      {filteredProducts && filteredProducts.length > 0 ? (
        <Card>
          <div className="overflow-x-auto">
            <table className="w-full">
              <thead>
                <tr className="border-b border-border">
                  <th className="text-left p-4 font-medium">Product</th>
                  <th className="text-left p-4 font-medium">Price</th>
                  <th className="text-left p-4 font-medium">Status</th>
                  <th className="text-left p-4 font-medium">Stock</th>
                  <th className="text-left p-4 font-medium">Views</th>
                  <th className="text-right p-4 font-medium">Actions</th>
                </tr>
              </thead>
              <tbody>
                {filteredProducts.map((product) => (
                  <tr key={product.id} className="border-b border-border last:border-0">
                    <td className="p-4">
                      <div className="flex items-center gap-3">
                        <div className="relative h-12 w-12 rounded-lg bg-muted overflow-hidden">
                          {product.images?.[0] ? (
                            <Image
                              src={product.images[0]}
                              alt={product.name}
                              fill
                              className="object-cover"
                            />
                          ) : (
                            <div className="flex h-full items-center justify-center text-xl">
                              ðŸ“¦
                            </div>
                          )}
                        </div>
                        <div>
                          <p className="font-medium line-clamp-1">{product.name}</p>
                          <p className="text-xs text-muted-foreground">
                            {product.category}
                          </p>
                        </div>
                      </div>
                    </td>
                    <td className="p-4">
                      <span className="font-medium">
                        {formatPrice(product.price)}
                      </span>
                    </td>
                    <td className="p-4">
                      <Badge
                        variant={
                          product.status === "approved"
                            ? "success"
                            : product.status === "pending"
                            ? "warning"
                            : "destructive"
                        }
                      >
                        {product.status}
                      </Badge>
                    </td>
                    <td className="p-4">
                      <Badge variant={product.inStock ? "success" : "destructive"}>
                        {product.inStock ? `${product.quantity} in stock` : "Out of stock"}
                      </Badge>
                    </td>
                    <td className="p-4 text-muted-foreground">
                      <div className="flex items-center gap-1">
                        <Eye className="h-4 w-4" />
                        {product.views}
                      </div>
                    </td>
                    <td className="p-4 text-right">
                      <div className="flex items-center justify-end gap-2">
                        <Button variant="ghost" size="icon" asChild>
                          <Link href={`/vendor/products/${product.id}`}>
                            <Edit className="h-4 w-4" />
                          </Link>
                        </Button>
                        <Button
                          variant="ghost"
                          size="icon"
                          onClick={() => {
                            if (confirm("Delete this product?")) {
                              deleteProduct.mutate(product.id);
                            }
                          }}
                        >
                          <Trash2 className="h-4 w-4 text-destructive" />
                        </Button>
                      </div>
                    </td>
                  </tr>
                ))}
              </tbody>
            </table>
          </div>
        </Card>
      ) : (
        <EmptyState
          icon={<Plus className="h-10 w-10" />}
          title="No products yet"
          description="Add your first product to start selling"
          action={{
            label: "Add Product",
            onClick: () => window.location.href = "/vendor/products/new",
          }}
        />
      )}
    </div>
  );
}"use client";

import { useState } from "react";
import { Card, Button } from "@/components/ui";
import { LoadingState } from "@/components/common";
import { VendorForm } from "@/components/forms/vendor-form";
// import { ImageUpload } from "@/components/common/image-upload";
import { useMyShop, useUpdateVendor } from "@/hooks";
import { uploadService } from "@/services";
import toast from "react-hot-toast";

export default function VendorSettingsPage() {
  const { data: shop, isLoading, refetch } = useMyShop();
  const updateVendor = useUpdateVendor();
  const [uploadingLogo, setUploadingLogo] = useState(false);
  const [uploadingEntrance, setUploadingEntrance] = useState(false);

  if (isLoading) {
    return <LoadingState />;
  }

  if (!shop) {
    return <div>Shop not found</div>;
  }

  const handleSubmit = async (data: any) => {
    await updateVendor.mutateAsync({ id: shop.id, data });
  };

  const handleLogoUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setUploadingLogo(true);
    try {
      const result = await uploadService.uploadShopLogo(file);
      await updateVendor.mutateAsync({
        id: shop.id,
        data: { shopImages: { ...shop.shopImages, logo: result.url } },
      });
      refetch();
      toast.success("Logo updated successfully");
    } catch (error) {
      toast.error("Failed to upload logo");
    } finally {
      setUploadingLogo(false);
    }
  };

  const handleEntranceUpload = async (e: React.ChangeEvent<HTMLInputElement>) => {
    const file = e.target.files?.[0];
    if (!file) return;

    setUploadingEntrance(true);
    try {
      const result = await uploadService.uploadShopEntrance(file);
      await updateVendor.mutateAsync({
        id: shop.id,
        data: { shopImages: { ...shop.shopImages, entrancePhoto: result.url } },
      });
      refetch();
      toast.success("Entrance photo updated successfully");
    } catch (error) {
      toast.error("Failed to upload photo");
    } finally {
      setUploadingEntrance(false);
    }
  };

  return (
    <div className="space-y-6">
      <div>
        <h1 className="text-2xl font-bold">Shop Settings</h1>
        <p className="text-muted-foreground">
          Manage your shop information and appearance
        </p>
      </div>

      {/* Shop Images */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Shop Images</h2>
        <div className="grid grid-cols-1 md:grid-cols-2 gap-6">
          {/* Logo */}
          <div>
            <label className="block text-sm font-medium mb-2">Shop Logo</label>
            <div className="relative aspect-square max-w-[200px] rounded-lg overflow-hidden bg-muted">
              {shop.shopImages?.logo ? (
                <img
                  src={shop.shopImages.logo}
                  alt="Shop logo"
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center text-4xl">
                  ðŸª
                </div>
              )}
            </div>
            <label className="mt-2 inline-block">
              <Button
                type="button"
                variant="outline"
                size="sm"
                disabled={uploadingLogo}
                asChild
              >
                <span>
                  {uploadingLogo ? "Uploading..." : "Change Logo"}
                  <input
                    type="file"
                    accept="image/*"
                    onChange={handleLogoUpload}
                    className="hidden"
                  />
                </span>
              </Button>
            </label>
          </div>

          {/* Entrance Photo */}
          <div>
            <label className="block text-sm font-medium mb-2">
              Shop Entrance Photo
            </label>
            <div className="relative aspect-video max-w-[300px] rounded-lg overflow-hidden bg-muted">
              {shop.shopImages?.entrancePhoto ? (
                <img
                  src={shop.shopImages.entrancePhoto}
                  alt="Shop entrance"
                  className="w-full h-full object-cover"
                />
              ) : (
                <div className="w-full h-full flex items-center justify-center text-4xl">
                  ðŸ“·
                </div>
              )}
            </div>
            <label className="mt-2 inline-block">
              <Button
                type="button"
                variant="outline"
                size="sm"
                disabled={uploadingEntrance}
                asChild
              >
                <span>
                  {uploadingEntrance ? "Uploading..." : "Change Photo"}
                  <input
                    type="file"
                    accept="image/*"
                    onChange={handleEntranceUpload}
                    className="hidden"
                  />
                </span>
              </Button>
            </label>
          </div>
        </div>
      </Card>

      {/* Shop Details Form */}
      <Card className="p-6">
        <h2 className="font-semibold mb-4">Shop Details</h2>
        <VendorForm
          initialData={{
            businessName: shop.businessName,
            businessDescription: shop.businessDescription,
            vendorType: shop.vendorType,
            stateId: shop.stateId,
            areaId: shop.areaId,
            marketId: shop.marketId,
            shopNumber: shop.shopNumber,
            shopAddress: shop.shopAddress,
            contactDetails: shop.contactDetails,
            bankDetails: shop.bankDetails,
            categories: shop.categories,
          }}
          onSubmit={handleSubmit}
          isLoading={updateVendor.isPending}
        />
      </Card>
    </div>
  );
}"use client";

import { useAuth } from "@/hooks";
import { VendorSidebar } from "@/components/layout";
import { LoadingState } from "@/components/common";
import { redirect } from "next/navigation";

export default function VendorLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  const { isLoading, isAuthenticated, isVendor } = useAuth(true);

  if (isLoading) {
    return <LoadingState />;
  }

  if (!isAuthenticated) {
    redirect("/login");
  }

  return (
    <div className="min-h-screen">
      <VendorSidebar />
      <main className="lg:pl-64">
        <div className="container-premium py-8">{children}</div>
      </main>
    </div>
  );
}"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import { useAuth } from "@/hooks";
import { Card, Button } from "@/components/ui";
import { VendorForm } from "@/components/forms/vendor-form";
import { useCreateVendor } from "@/hooks/use-shops";
import { Store, CheckCircle, ArrowRight } from "lucide-react";
import Link from "next/link";

export default function VendorOnboardingPage() {
  const router = useRouter();
  const { user, isAuthenticated, isVendor } = useAuth();
  const createVendor = useCreateVendor();
  const [step, setStep] = useState(1);

  // Already a vendor
  if (isVendor) {
    return (
      <div className="container-premium py-12">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <div className="w-16 h-16 rounded-full bg-green-100 dark:bg-green-900 flex items-center justify-center mx-auto mb-4">
            <CheckCircle className="h-8 w-8 text-green-600" />
          </div>
          <h2 className="text-2xl font-bold mb-2">You're already a vendor!</h2>
          <p className="text-muted-foreground mb-6">
            Go to your dashboard to manage your shop and products.
          </p>
          <Button asChild>
            <Link href="/vendor/dashboard">
              Go to Dashboard
              <ArrowRight className="ml-2 h-4 w-4" />
            </Link>
          </Button>
        </Card>
      </div>
    );
  }

  // Not logged in
  if (!isAuthenticated) {
    return (
      <div className="container-premium py-12">
        <Card className="max-w-lg mx-auto p-8 text-center">
          <Store className="h-16 w-16 mx-auto mb-4 text-muted-foreground" />
          <h2 className="text-2xl font-bold mb-2">Become a Vendor</h2>
          <p className="text-muted-foreground mb-6">
            Create an account or sign in to start selling on SureShops.
          </p>
          <div className="flex gap-4 justify-center">
            <Button variant="outline" asChild>
              <Link href="/login">Sign In</Link>
            </Button>
            <Button asChild>
              <Link href="/register">Create Account</Link>
            </Button>
          </div>
        </Card>
      </div>
    );
  }

  const handleSubmit = async (data: any) => {
    try {
      await createVendor.mutateAsync(data);
      router.push("/vendor/dashboard");
    } catch (error) {
      // Error handled by mutation
    }
  };

  return (
    <div className="container-premium py-12">
      <div className="max-w-2xl mx-auto">
        <div className="text-center mb-8">
          <h1 className="text-3xl font-bold mb-2">Become a Vendor</h1>
          <p className="text-muted-foreground">
            Set up your shop and start selling to thousands of customers
          </p>
        </div>

        <Card className="p-6">
          <VendorForm
            onSubmit={handleSubmit}
            isLoading={createVendor.isPending}
          />
        </Card>
      </div>
    </div>
  );
}import { Metadata } from "next";
import Link from "next/link";
import { ArrowRight, MapPin, Store, TrendingUp, Shield } from "lucide-react";
import { Button, Card } from "@/components/ui";
import { SearchBar } from "@/components/search";
import { CATEGORIES } from "@/lib/constants";

export const metadata: Metadata = {
  title: "SureShops - Find Products, Compare Prices",
};

export default function HomePage() {
  return (
    <div>
      {/* Hero Section */}
      <section className="relative bg-gradient-to-b from-muted/50 to-background pt-12 pb-20">
        <div className="container-premium">
          <div className="max-w-3xl mx-auto text-center">
            <h1 className="text-4xl md:text-5xl lg:text-6xl font-bold tracking-tight">
              Find Products.{" "}
              <span className="text-muted-foreground">Compare Prices.</span>
            </h1>
            <p className="mt-6 text-lg text-muted-foreground max-w-2xl mx-auto">
              Discover products from thousands of local shops across Nigeria.
              Compare prices, find the best deals, and support local businesses.
            </p>

            {/* Search Bar */}
            <div className="mt-10 max-w-2xl mx-auto">
              <SearchBar variant="hero" />
            </div>

            {/* Quick Links */}
            <div className="mt-8 flex flex-wrap justify-center gap-3">
              {["iPhone", "Laptop", "Shoes", "Electronics", "Fashion"].map(
                (term) => (
                  <Link
                    key={term}
                    href={`/search?query=${term}`}
                    className="px-4 py-2 rounded-full bg-muted text-sm hover:bg-muted/80 transition-colors"
                  >
                    {term}
                  </Link>
                )
              )}
            </div>
          </div>
        </div>
      </section>

      {/* Features Section */}
      <section className="py-16">
        <div className="container-premium">
          <div className="grid grid-cols-1 md:grid-cols-3 gap-8">
            <Card className="p-6 text-center">
              <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
                <TrendingUp className="h-6 w-6" />
              </div>
              <h3 className="font-semibold text-lg">Compare Prices</h3>
              <p className="text-muted-foreground mt-2 text-sm">
                See prices from multiple vendors and find the best deal instantly
              </p>
            </Card>

            <Card className="p-6 text-center">
              <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
                <MapPin className="h-6 w-6" />
              </div>
              <h3 className="font-semibold text-lg">Find Nearby Shops</h3>
              <p className="text-muted-foreground mt-2 text-sm">
                Discover shops in your area with exact locations and directions
              </p>
            </Card>

            <Card className="p-6 text-center">
              <div className="w-12 h-12 rounded-full bg-primary/10 flex items-center justify-center mx-auto mb-4">
                <Shield className="h-6 w-6" />
              </div>
              <h3 className="font-semibold text-lg">Verified Vendors</h3>
              <p className="text-muted-foreground mt-2 text-sm">
                Shop with confidence from verified and trusted local businesses
              </p>
            </Card>
          </div>
        </div>
      </section>

      {/* Categories Section */}
      <section className="py-16 bg-muted/30">
        <div className="container-premium">
          <div className="flex items-center justify-between mb-8">
            <div>
              <h2 className="text-2xl font-bold">Browse Categories</h2>
              <p className="text-muted-foreground mt-1">
                Explore products by category
              </p>
            </div>
            <Button variant="ghost" asChild>
              <Link href="/categories">
                View All
                <ArrowRight className="ml-2 h-4 w-4" />
              </Link>
            </Button>
          </div>

          <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-5 gap-4">
            {CATEGORIES.slice(0, 10).map((category) => (
              <Link
                key={category.slug}
                href={`/categories/${category.slug}`}
                className="group"
              >
                <Card className="p-6 text-center hover:shadow-lg transition-all">
                  <span className="text-3xl mb-3 block">{category.icon}</span>
                  <h3 className="font-medium group-hover:text-primary transition-colors">
                    {category.name}
                  </h3>
                </Card>
              </Link>
            ))}
          </div>
        </div>
      </section>

      {/* CTA Section */}
      <section className="py-20">
        <div className="container-premium">
          <Card className="bg-foreground text-background p-12 text-center">
            <Store className="h-12 w-12 mx-auto mb-6" />
            <h2 className="text-3xl font-bold">Are you a vendor?</h2>
            <p className="mt-4 text-background/80 max-w-xl mx-auto">
              Join thousands of vendors on SureShops. List your products, reach
              more customers, and grow your business.
            </p>
            <Button
              size="lg"
              className="mt-8 bg-background text-foreground hover:bg-background/90"
              asChild
            >
              <Link href="/vendor">
                Start Selling
                <ArrowRight className="ml-2 h-5 w-5" />
              </Link>
            </Button>
          </Card>
        </div>
      </section>
    </div>
  );
}import type { Metadata } from "next";
import { Inter } from "next/font/google";
import "./globals.css";
import { Providers } from "./providers";
import { Header, Footer, MobileNav } from "@/components/layout";


const inter = Inter({
  subsets: ["latin"],
  variable: "--font-inter",
});

export const metadata: Metadata = {
  title: {
    default: "SureShops - Find Products, Compare Prices",
    template: "%s | SureShops",
  },
  description: "Discover products from local shops across Nigeria. Compare prices, find deals, and support local businesses.",
  keywords: ["marketplace", "shopping", "Nigeria", "local shops", "price comparison"],
};

export default function RootLayout({
  children,
}: {
  children: React.ReactNode;
}) {
  return (
    <html lang="en" suppressHydrationWarning>
       <Header />
      <body className={`${inter.variable} font-sans`}>
        <Providers>{children}</Providers>
      </body>
      <Footer />
      <MobileNav />
    </html>
  );
}import { Spinner } from "@/components/ui";

export default function Loading() {
  return (
    <div className="flex min-h-screen items-center justify-center">
      <Spinner size="lg" />
    </div>
  );
}import Image from "next/image";
import HomePage from "./(main)/page";

export default function Home() {
  return (
   <HomePage/>
    
  );
}
"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutDashboard,
  Users,
  Store,
  Package,
  Settings,
  ArrowLeft,
  Shield,
} from "lucide-react";
import { cn } from "@/lib/utils";
import { Logo } from "@/components/common";

const menuItems = [
  { href: "/admin/dashboard", icon: LayoutDashboard, label: "Dashboard" },
  { href: "/admin/users", icon: Users, label: "Users" },
  { href: "/admin/vendors", icon: Store, label: "Vendors" },
  { href: "/admin/products", icon: Package, label: "Products" },
  { href: "/admin/settings", icon: Settings, label: "Settings" },
];

export function AdminSidebar() {
  const pathname = usePathname();

  return (
    <aside className="fixed left-0 top-0 z-30 hidden h-screen w-64 border-r border-border bg-card lg:block">
      <div className="flex h-full flex-col">
        {/* Header */}
        <div className="flex h-16 items-center gap-2 border-b border-border px-6">
          <Shield className="h-5 w-5 text-primary" />
          <span className="font-bold">Admin Panel</span>
        </div>

        {/* Navigation */}
        <nav className="flex-1 space-y-1 p-4">
          {menuItems.map((item) => {
            const isActive = pathname === item.href;
            const Icon = item.icon;

            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  "flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors",
                  isActive
                    ? "bg-primary text-primary-foreground"
                    : "text-muted-foreground hover:bg-accent hover:text-foreground"
                )}
              >
                <Icon className="h-5 w-5" />
                {item.label}
              </Link>
            );
          })}
        </nav>

        {/* Footer */}
        <div className="border-t border-border p-4">
          <Link
            href="/"
            className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-muted-foreground hover:bg-accent hover:text-foreground transition-colors"
          >
            <ArrowLeft className="h-4 w-4" />
            Back to Site
          </Link>
        </div>
      </div>
    </aside>
  );
}"use client";

import { Users, Store, Package, MapPin, Eye, Search } from "lucide-react";
import { Card } from "@/components/ui";
import { DashboardStats } from "@/types/admin";
import { formatNumber } from "@/lib/utils";

interface AdminStatsProps {
  stats: DashboardStats;
}

export function AdminStats({ stats }: AdminStatsProps) {
  const statCards = [
    {
      label: "Total Users",
      value: stats.users.total,
      subValue: `${stats.users.active} active`,
      icon: Users,
      trend: `+${stats.users.newThisMonth} this month`,
    },
    {
      label: "Total Vendors",
      value: stats.vendors.total,
      subValue: `${stats.vendors.verified} verified`,
      icon: Store,
      trend: `${stats.vendors.pending} pending`,
      alert: stats.vendors.pending > 0,
    },
    {
      label: "Total Products",
      value: stats.products.total,
      subValue: `${stats.products.approved} approved`,
      icon: Package,
      trend: `${stats.products.pending} pending`,
      alert: stats.products.pending > 0,
    },
    {
      label: "Locations",
      value: stats.locations.states,
      subValue: `${stats.locations.areas} areas, ${stats.locations.markets} markets`,
      icon: MapPin,
    },
    {
      label: "Total Views",
      value: stats.activity.totalViews,
      icon: Eye,
    },
    {
      label: "Search Appearances",
      value: stats.activity.totalSearches,
      icon: Search,
    },
  ];

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-4">
      {statCards.map((stat) => {
        const Icon = stat.icon;
        return (
          <Card key={stat.label} className="p-6">
            <div className="flex items-center justify-between">
              <div>
                <p className="text-sm text-muted-foreground">{stat.label}</p>
                <p className="text-2xl font-bold mt-1">
                  {formatNumber(stat.value)}
                </p>
                {stat.subValue && (
                  <p className="text-xs text-muted-foreground mt-1">
                    {stat.subValue}
                  </p>
                )}
              </div>
              <div
                className={cn(
                  "w-12 h-12 rounded-full flex items-center justify-center",
                  stat.alert ? "bg-amber-500/10" : "bg-primary/10"
                )}
              >
                <Icon
                  className={cn(
                    "h-6 w-6",
                    stat.alert ? "text-amber-600" : "text-primary"
                  )}
                />
              </div>
            </div>
            {stat.trend && (
              <p
                className={cn(
                  "text-sm mt-2",
                  stat.alert ? "text-amber-600" : "text-green-600"
                )}
              >
                {stat.trend}
              </p>
            )}
          </Card>
        );
      })}
    </div>
  );
}

function cn(...classes: (string | boolean | undefined)[]) {
  return classes.filter(Boolean).join(" ");
}export * from './admin-sidebar';
export * from './admin-stats';"use client";

import { useRouter } from "next/navigation";
import { ArrowLeft } from "lucide-react";
import { Button } from "@/components/ui";

interface BackButtonProps {
  href?: string;
  label?: string;
  className?: string;
}

export function BackButton({ href, label = "Back" }: BackButtonProps) {
  const router = useRouter();

  const handleClick = () => {
    if (href) {
      router.push(href);
    } else {
      router.back();
    }
  };

  return (
    <Button variant="ghost" size="sm" onClick={handleClick}>
      <ArrowLeft className="mr-2 h-4 w-4" />
      {label}
    </Button>
  );
}import { cn } from "@/lib/utils";
import { Button } from "@/components/ui";

interface EmptyStateProps {
  icon?: React.ReactNode;
  title: string;
  description?: string;
  action?: {
    label: string;
    onClick: () => void;
  };
  className?: string;
}

export function EmptyState({
  icon,
  title,
  description,
  action,
  className,
}: EmptyStateProps) {
  return (
    <div
      className={cn(
        "flex flex-col items-center justify-center py-12 text-center",
        className
      )}
    >
      {icon && (
        <div className="mb-4 rounded-full bg-muted p-4 text-muted-foreground">
          {icon}
        </div>
      )}
      <h3 className="text-lg font-semibold">{title}</h3>
      {description && (
        <p className="mt-1 max-w-sm text-sm text-muted-foreground">
          {description}
        </p>
      )}
      {action && (
        <Button onClick={action.onClick} className="mt-4">
          {action.label}
        </Button>
      )}
    </div>
  );
}"use client";

import { useRef, useState } from "react";
import { Upload, X, Loader2, ImageIcon } from "lucide-react";
import { useUpload } from "@/hooks/use-upload";
import { cn } from "@/lib/utils";

interface ImageUploadProps {
  images: string[];
  onChange: (images: string[]) => void;
  maxImages?: number;
  className?: string;
}

export function ImageUpload({
  images,
  onChange,
  maxImages = 5,
  className,
}: ImageUploadProps) {
  const fileInputRef = useRef<HTMLInputElement>(null);
  const [dragActive, setDragActive] = useState(false);

  const { uploading, progress, uploadProductImage } = useUpload({
    maxFiles: maxImages,
    maxSizeMB: 10,
  });

  const handleFiles = async (files: FileList | null) => {
    if (!files || files.length === 0) return;

    const remainingSlots = maxImages - images.length;
    if (remainingSlots <= 0) {
      return;
    }

    const filesToUpload = Array.from(files).slice(0, remainingSlots);

    for (const file of filesToUpload) {
      const response = await uploadProductImage(file);
      if (response) {
        onChange([...images, response.url]);
      }
    }
  };

  const handleRemove = (index: number) => {
    const newImages = images.filter((_, i) => i !== index);
    onChange(newImages);
  };

  const handleDrag = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    if (e.type === "dragenter" || e.type === "dragover") {
      setDragActive(true);
    } else if (e.type === "dragleave") {
      setDragActive(false);
    }
  };

  const handleDrop = (e: React.DragEvent) => {
    e.preventDefault();
    e.stopPropagation();
    setDragActive(false);
    handleFiles(e.dataTransfer.files);
  };

  const canAddMore = images.length < maxImages;

  return (
    <div className={cn("space-y-4", className)}>
      {/* Upload area */}
      {canAddMore && (
        <div
          onDragEnter={handleDrag}
          onDragLeave={handleDrag}
          onDragOver={handleDrag}
          onDrop={handleDrop}
          onClick={() => !uploading && fileInputRef.current?.click()}
          className={cn(
            "border-2 border-dashed rounded-lg p-6 text-center cursor-pointer transition-colors",
            dragActive
              ? "border-primary bg-primary/5"
              : "border-border hover:border-primary/50 hover:bg-muted/50",
            uploading && "pointer-events-none opacity-60"
          )}
        >
          <input
            ref={fileInputRef}
            type="file"
            accept="image/jpeg,image/jpg,image/png,image/gif,image/webp"
            multiple
            onChange={(e) => handleFiles(e.target.files)}
            className="hidden"
            disabled={uploading}
          />

          {uploading ? (
            <div className="space-y-3">
              <Loader2 className="h-8 w-8 mx-auto animate-spin text-primary" />
              <p className="text-sm text-muted-foreground">
                Uploading... {progress}%
              </p>
              <div className="w-full max-w-xs mx-auto bg-muted rounded-full h-2">
                <div
                  className="bg-primary h-2 rounded-full transition-all duration-300"
                  style={{ width: `${progress}%` }}
                />
              </div>
            </div>
          ) : (
            <div className="space-y-2">
              <Upload className="h-8 w-8 mx-auto text-muted-foreground" />
              <p className="text-sm font-medium">
                Click to upload or drag and drop
              </p>
              <p className="text-xs text-muted-foreground">
                JPG, PNG, GIF, WebP up to 10MB ({images.length}/{maxImages})
              </p>
            </div>
          )}
        </div>
      )}

      {/* Image previews */}
      {images.length > 0 && (
        <div className="grid grid-cols-2 sm:grid-cols-3 md:grid-cols-4 lg:grid-cols-5 gap-3">
          {images.map((url, index) => (
            <div
              key={`${url}-${index}`}
              className="relative group aspect-square rounded-lg overflow-hidden border border-border"
            >
              <img
                src={url}
                alt={`Product image ${index + 1}`}
                className="w-full h-full object-cover"
                onError={(e) => {
                  (e.target as HTMLImageElement).src =
                    "data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='100' height='100'%3E%3Crect width='100' height='100' fill='%23f0f0f0'/%3E%3Ctext x='50' y='55' text-anchor='middle' fill='%23999' font-size='12'%3EError%3C/text%3E%3C/svg%3E";
                }}
              />

              {/* Remove button */}
              <button
                type="button"
                onClick={(e) => {
                  e.stopPropagation();
                  handleRemove(index);
                }}
                className="absolute top-1 right-1 w-6 h-6 bg-destructive text-white rounded-full flex items-center justify-center opacity-0 group-hover:opacity-100 transition-opacity shadow-sm"
              >
                <X className="h-3 w-3" />
              </button>

              {/* Index badge */}
              {index === 0 && (
                <span className="absolute bottom-1 left-1 px-1.5 py-0.5 bg-primary text-primary-foreground text-xs rounded font-medium">
                  Main
                </span>
              )}
            </div>
          ))}
        </div>
      )}

      {/* Empty state */}
      {images.length === 0 && !canAddMore && (
        <div className="text-center py-4">
          <ImageIcon className="h-8 w-8 mx-auto text-muted-foreground mb-2" />
          <p className="text-sm text-muted-foreground">No images uploaded</p>
        </div>
      )}
    </div>
  );
}export * from './logo';
export * from './price-tag';
export * from './rating';
export * from './verified-badge';
export * from './location-badge';
export * from './empty-state';
export * from './loading-state';
export * from './back-button';
export * from './pagination';
export * from './image-upload';import { Spinner } from "@/components/ui";
import { cn } from "@/lib/utils";

interface LoadingStateProps {
  text?: string;
  className?: string;
}

export function LoadingState({ text = "Loading...", className }: LoadingStateProps) {
  return (
    <div
      className={cn(
        "flex flex-col items-center justify-center py-12",
        className
      )}
    >
      <Spinner size="lg" />
      <p className="mt-4 text-sm text-muted-foreground">{text}</p>
    </div>
  );
}import { MapPin } from "lucide-react";
import { cn } from "@/lib/utils";
import { LocationInfo } from "@/types";

interface LocationBadgeProps {
  location: LocationInfo;
  showFull?: boolean;
  size?: "sm" | "md";
  className?: string;
}

export function LocationBadge({
  location,
  showFull = false,
  size = "md",
  className,
}: LocationBadgeProps) {
  const getLocationText = () => {
    if (showFull) {
      const parts = [];
      if (location.shopNumber) parts.push(location.shopNumber);
      if (location.market?.name) parts.push(location.market.name);
      if (location.area?.name) parts.push(location.area.name);
      if (location.state?.name) parts.push(location.state.name);
      return parts.join(", ");
    }
    return location.area?.name || location.state?.name || "Nigeria";
  };

  return (
    <div
      className={cn(
        "flex items-center gap-1 text-muted-foreground",
        size === "sm" ? "text-xs" : "text-sm",
        className
      )}
    >
      <MapPin className={size === "sm" ? "h-3 w-3" : "h-4 w-4"} />
      <span className="truncate">{getLocationText()}</span>
      {location.distance !== undefined && (
        <span className="whitespace-nowrap">
          â€¢ {location.distance.toFixed(1)}km
        </span>
      )}
    </div>
  );
}import Link from "next/link";

interface LogoProps {
  className?: string;
}

export function Logo({ className }: LogoProps) {
  return (
    <Link href="/" className={className}>
      <div className="flex items-center gap-2">
        <div className="flex h-8 w-8 items-center justify-center rounded-lg bg-foreground">
          <span className="text-lg font-bold text-background">S</span>
        </div>
        <span className="text-xl font-bold tracking-tight">SureShops</span>
      </div>
    </Link>
  );
}"use client";

import { ChevronLeft, ChevronRight } from "lucide-react";
import { Button } from "@/components/ui";
import { cn } from "@/lib/utils";

interface PaginationProps {
  currentPage: number;
  totalPages: number;
  onPageChange: (page: number) => void;
  className?: string;
}

export function Pagination({
  currentPage,
  totalPages,
  onPageChange,
  className,
}: PaginationProps) {
  if (totalPages <= 1) return null;

  const pages = [];
  const showEllipsis = totalPages > 7;

  if (showEllipsis) {
    if (currentPage <= 3) {
      for (let i = 1; i <= 5; i++) pages.push(i);
      pages.push("...");
      pages.push(totalPages);
    } else if (currentPage >= totalPages - 2) {
      pages.push(1);
      pages.push("...");
      for (let i = totalPages - 4; i <= totalPages; i++) pages.push(i);
    } else {
      pages.push(1);
      pages.push("...");
      for (let i = currentPage - 1; i <= currentPage + 1; i++) pages.push(i);
      pages.push("...");
      pages.push(totalPages);
    }
  } else {
    for (let i = 1; i <= totalPages; i++) pages.push(i);
  }

  return (
    <div className={cn("flex items-center justify-center gap-1", className)}>
      <Button
        variant="outline"
        size="icon"
        onClick={() => onPageChange(currentPage - 1)}
        disabled={currentPage === 1}
      >
        <ChevronLeft className="h-4 w-4" />
      </Button>

      {pages.map((page, index) =>
        page === "..." ? (
          <span key={`ellipsis-${index}`} className="px-2 text-muted-foreground">
            ...
          </span>
        ) : (
          <Button
            key={page}
            variant={currentPage === page ? "default" : "outline"}
            size="icon"
            onClick={() => onPageChange(page as number)}
          >
            {page}
          </Button>
        )
      )}

      <Button
        variant="outline"
        size="icon"
        onClick={() => onPageChange(currentPage + 1)}
        disabled={currentPage === totalPages}
      >
        <ChevronRight className="h-4 w-4" />
      </Button>
    </div>
  );
}import { cn, formatPrice, getDiscountPercentage } from "@/lib/utils";
import { Badge } from "@/components/ui";

interface PriceTagProps {
  price: number;
  originalPrice?: number;
  currency?: string;
  size?: "sm" | "md" | "lg";
  showDiscount?: boolean;
  className?: string;
}

export function PriceTag({
  price,
  originalPrice,
  currency = "NGN",
  size = "md",
  showDiscount = true,
  className,
}: PriceTagProps) {
  const discount = originalPrice ? getDiscountPercentage(originalPrice, price) : 0;

  const sizeClasses = {
    sm: "text-sm",
    md: "text-lg",
    lg: "text-2xl",
  };

  return (
    <div className={cn("flex items-center gap-2 flex-wrap", className)}>
      <span className={cn("font-bold", sizeClasses[size])}>
        {formatPrice(price, currency)}
      </span>
      
      {originalPrice && originalPrice > price && (
        <>
          <span className="text-sm text-muted-foreground line-through">
            {formatPrice(originalPrice, currency)}
          </span>
          {showDiscount && discount > 0 && (
            <Badge variant="success" className="text-xs">
              -{discount}%
            </Badge>
          )}
        </>
      )}
    </div>
  );
}import { Star } from "lucide-react";
import { cn } from "@/lib/utils";

interface RatingProps {
  value: number;
  max?: number;
  size?: "sm" | "md" | "lg";
  showValue?: boolean;
  count?: number;
  className?: string;
}

export function Rating({
  value,
  max = 5,
  size = "md",
  showValue = true,
  count,
  className,
}: RatingProps) {
  const sizeClasses = {
    sm: "h-3 w-3",
    md: "h-4 w-4",
    lg: "h-5 w-5",
  };

  return (
    <div className={cn("flex items-center gap-1", className)}>
      <div className="flex">
        {Array.from({ length: max }).map((_, i) => (
          <Star
            key={i}
            className={cn(
              sizeClasses[size],
              i < Math.floor(value)
                ? "fill-amber-400 text-amber-400"
                : "fill-muted text-muted"
            )}
          />
        ))}
      </div>
      {showValue && (
        <span className="text-sm font-medium">{value.toFixed(1)}</span>
      )}
      {count !== undefined && (
        <span className="text-sm text-muted-foreground">({count})</span>
      )}
    </div>
  );
}import { BadgeCheck } from "lucide-react";
import { cn } from "@/lib/utils";

interface VerifiedBadgeProps {
  size?: "sm" | "md" | "lg";
  showText?: boolean;
  className?: string;
}

export function VerifiedBadge({
  size = "md",
  showText = false,
  className,
}: VerifiedBadgeProps) {
  const sizeClasses = {
    sm: "h-4 w-4",
    md: "h-5 w-5",
    lg: "h-6 w-6",
  };

  return (
    <div className={cn("flex items-center gap-1 text-primary", className)}>
      <BadgeCheck className={sizeClasses[size]} />
      {showText && <span className="text-sm font-medium">Verified</span>}
    </div>
  );
}export * from './login-form';
export * from './register-form';
export * from './product-form';
export * from './vendor-form';
// export * from './profile-form';"use client";

import { Select } from "@/components/ui";
import { useLocationSelect } from "@/hooks/use-location-select";

interface LocationSelectProps {
  initialStateId?: string;
  initialAreaId?: string;
  initialMarketId?: string;
  includeMarkets?: boolean;
  showMarket?: boolean;
  onStateChange?: (stateId: string) => void;
  onAreaChange?: (areaId: string) => void;
  onMarketChange?: (marketId: string) => void;
  stateError?: string;
  areaError?: string;
  marketError?: string;
  disabled?: boolean;
}

export function LocationSelect({
  initialStateId,
  initialAreaId,
  initialMarketId,
  includeMarkets = true,
  showMarket = true,
  onStateChange,
  onAreaChange,
  onMarketChange,
  stateError,
  areaError,
  marketError,
  disabled = false,
}: LocationSelectProps) {
  const {
    states,
    areas,
    markets,
    selectedStateId,
    selectedAreaId,
    selectedMarketId,
    loadingStates,
    loadingAreas,
    loadingMarkets,
    handleStateChange: internalStateChange,
    handleAreaChange: internalAreaChange,
    handleMarketChange: internalMarketChange,
  } = useLocationSelect({
    initialStateId,
    initialAreaId,
    initialMarketId,
    includeMarkets: includeMarkets && showMarket,
  });

  const handleStateSelect = (stateId: string) => {
    internalStateChange(stateId);
    // Notify parent form
    onStateChange?.(stateId);
    onAreaChange?.("");
    onMarketChange?.("");
  };

  const handleAreaSelect = (areaId: string) => {
    internalAreaChange(areaId);
    // Notify parent form
    onAreaChange?.(areaId);
    onMarketChange?.("");
  };

  const handleMarketSelect = (marketId: string) => {
    internalMarketChange(marketId);
    // Notify parent form
    onMarketChange?.(marketId);
  };

  return (
    <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
      {/* State Select */}
      <div>
        <label className="block text-sm font-medium mb-2">
          State <span className="text-destructive">*</span>
        </label>
        <Select
          value={selectedStateId}
          onChange={handleStateSelect}
          options={states.map((s) => ({ value: s.id, label: s.name }))}
          placeholder={loadingStates ? "Loading states..." : "Select state"}
          disabled={disabled || loadingStates}
          error={stateError}
        />
      </div>

      {/* Area Select */}
      <div>
        <label className="block text-sm font-medium mb-2">
          Area <span className="text-destructive">*</span>
        </label>
        <Select
          value={selectedAreaId}
          onChange={handleAreaSelect}
          options={areas.map((a) => ({ value: a.id, label: a.name }))}
          placeholder={
            loadingAreas
              ? "Loading areas..."
              : !selectedStateId
                ? "Select state first"
                : areas.length === 0
                  ? "No areas found"
                  : "Select area"
          }
          disabled={disabled || !selectedStateId || loadingAreas || areas.length === 0}
          error={areaError}
        />
        {/* Debug info â€” remove after confirming it works */}
        {selectedStateId && !loadingAreas && (
          <p className="text-xs text-muted-foreground mt-1">
            {areas.length} area{areas.length !== 1 ? "s" : ""} found
          </p>
        )}
      </div>

      {/* Market Select (optional) */}
      {showMarket && (
        <div>
          <label className="block text-sm font-medium mb-2">
            Market / Mall
          </label>
          <Select
            value={selectedMarketId}
            onChange={handleMarketSelect}
            options={[
              { value: "", label: "None (Home-based / Street)" },
              ...markets.map((m) => ({
                value: m.id,
                label: `${m.name}${m.type ? ` (${m.type.replace(/_/g, " ")})` : ""}`,
              })),
            ]}
            placeholder={
              loadingMarkets
                ? "Loading markets..."
                : !selectedAreaId
                  ? "Select area first"
                  : markets.length === 0
                    ? "No markets in this area"
                    : "Select market (optional)"
            }
            disabled={disabled || !selectedAreaId || loadingMarkets}
            error={marketError}
          />
        </div>
      )}
    </div>
  );
}"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { Eye, EyeOff, Mail, Lock } from "lucide-react";
import { Button, Input } from "@/components/ui";
import { loginSchema, LoginInput } from "@/lib/validations";
import { authService } from "@/services";
import { useAuthStore } from "@/store";
import toast from "react-hot-toast";

export function LoginForm() {
  const router = useRouter();
  const { setUser } = useAuthStore();
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<LoginInput>({
    resolver: zodResolver(loginSchema),
  });

  const onSubmit = async (data: LoginInput) => {
    setIsLoading(true);
    try {
      const response = await authService.login(data);
      setUser(response.user);
      toast.success("Welcome back!");
      router.push("/");
    } catch (error: any) {
      toast.error(error.response?.data?.message || "Login failed");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-4">
        <div>
          <label className="block text-sm font-medium mb-2">Email</label>
          <Input
            type="email"
            placeholder="Enter your email"
            {...register("email")}
            error={errors.email?.message}
            leftIcon={<Mail className="h-5 w-5" />}
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Password</label>
          <Input
            type={showPassword ? "text" : "password"}
            placeholder="Enter your password"
            {...register("password")}
            error={errors.password?.message}
            leftIcon={<Lock className="h-5 w-5" />}
            rightIcon={
              <button
                type="button"
                onClick={() => setShowPassword(!showPassword)}
                className="hover:text-foreground"
              >
                {showPassword ? (
                  <EyeOff className="h-5 w-5" />
                ) : (
                  <Eye className="h-5 w-5" />
                )}
              </button>
            }
          />
        </div>
      </div>

      <div className="flex items-center justify-between">
        <label className="flex items-center gap-2 cursor-pointer">
          <input type="checkbox" className="rounded border-input" />
          <span className="text-sm">Remember me</span>
        </label>
        <Link
          href="/forgot-password"
          className="text-sm text-primary hover:underline"
        >
          Forgot password?
        </Link>
      </div>

      <Button type="submit" className="w-full" size="lg" isLoading={isLoading}>
        Sign In
      </Button>

      <p className="text-center text-sm text-muted-foreground">
        Don't have an account?{" "}
        <Link href="/register" className="text-primary hover:underline font-medium">
          Sign up
        </Link>
      </p>
    </form>
  );
}"use client";

import { useState, useEffect } from "react";
import { useForm, Controller } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { z } from "zod";
import { Button, Input, Select } from "@/components/ui";
import { ImageUpload } from "@/components/common/image-upload";
import { X } from "lucide-react";

const productSchema = z.object({
  name: z.string().min(2, "Product name is required"),
  description: z.string().optional(),
  type: z.enum(["sale", "lease", "rent", "service"]),
  price: z.number().min(0, "Price must be positive"),
  originalPrice: z.number().optional(),
  category: z.string().min(1, "Category is required"),
  subcategory: z.string().optional(),
  brand: z.string().optional(),
  sku: z.string().optional(),
  barcode: z.string().optional(),
  quantity: z.number().min(0, "Quantity must be 0 or more"),
  unit: z.string().optional(),
  inStock: z.boolean(),
  images: z.array(z.string()),
  tags: z.array(z.string()),
  specifications: z.record(z.string(), z.any()).optional(),
});

type ProductInput = z.infer<typeof productSchema>;

interface ProductFormProps {
  initialData?: Partial<ProductInput> & { id?: string };
  onSubmit: (data: ProductInput) => Promise<void>;
  isLoading?: boolean;
}

const PRODUCT_TYPE_OPTIONS = [
  { value: "sale", label: "For Sale" },
  { value: "lease", label: "For Lease" },
  { value: "rent", label: "For Rent" },
  { value: "service", label: "Service" },
];

const CATEGORY_OPTIONS = [
  "Electronics",
  "Fashion",
  "Phones & Tablets",
  "Computers & Accessories",
  "Home & Garden",
  "Health & Beauty",
  "Sports & Fitness",
  "Food & Groceries",
  "Baby & Kids",
  "Automotive",
  "Books & Media",
  "Office Supplies",
  "Building Materials",
  "Agriculture",
  "Services",
  "Other",
];

export function ProductForm({
  initialData,
  onSubmit,
  isLoading,
}: ProductFormProps) {
  const [tagInput, setTagInput] = useState("");

  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
    control,
    reset,
  } = useForm<ProductInput>({
    resolver: zodResolver(productSchema),
    defaultValues: {
      name: initialData?.name || "",
      description: initialData?.description || "",
      type: initialData?.type || "sale",
      price: initialData?.price ?? 0,
      originalPrice: initialData?.originalPrice,
      category: initialData?.category || "",
      subcategory: initialData?.subcategory || "",
      brand: initialData?.brand || "",
      sku: initialData?.sku || "",
      barcode: initialData?.barcode || "",
      quantity: initialData?.quantity ?? 0,
      unit: initialData?.unit || "",
      inStock: initialData?.inStock ?? true,
      images: initialData?.images || [],
      tags: initialData?.tags || [],
      specifications: initialData?.specifications || {},
    },
  });

  const watchedTags = watch("tags") || [];
  const watchedImages = watch("images") || [];
  const watchedInStock = watch("inStock");

  // Reset form when initialData changes (edit mode)
  useEffect(() => {
    if (initialData) {
      reset({
        name: initialData.name || "",
        description: initialData.description || "",
        type: initialData.type || "sale",
        price: initialData.price ?? 0,
        originalPrice: initialData.originalPrice,
        category: initialData.category || "",
        subcategory: initialData.subcategory || "",
        brand: initialData.brand || "",
        sku: initialData.sku || "",
        barcode: initialData.barcode || "",
        quantity: initialData.quantity ?? 0,
        unit: initialData.unit || "",
        inStock: initialData.inStock ?? true,
        images: initialData.images || [],
        tags: initialData.tags || [],
        specifications: initialData.specifications || {},
      });
    }
  }, [initialData, reset]);

  // --- Image handlers ---
  const handleImagesChange = (newImages: string[]) => {
    setValue("images", newImages, { shouldValidate: true });
  };

  // --- Tag handlers ---
  const handleAddTag = () => {
    const tag = tagInput.trim();
    if (tag && !watchedTags.includes(tag)) {
      setValue("tags", [...watchedTags, tag]);
      setTagInput("");
    }
  };

  const handleRemoveTag = (tagToRemove: string) => {
    setValue(
      "tags",
      watchedTags.filter((t) => t !== tagToRemove)
    );
  };

  const handleTagKeyDown = (e: React.KeyboardEvent) => {
    if (e.key === "Enter") {
      e.preventDefault();
      handleAddTag();
    }
    if (e.key === "Backspace" && tagInput === "" && watchedTags.length > 0) {
      handleRemoveTag(watchedTags[watchedTags.length - 1]);
    }
  };

  // --- Submit handler ---
  const handleFormSubmit = async (data: ProductInput) => {
    const cleanData = { ...data };
    if (!cleanData.description) delete cleanData.description;
    if (!cleanData.subcategory) delete cleanData.subcategory;
    if (!cleanData.brand) delete cleanData.brand;
    if (!cleanData.sku) delete cleanData.sku;
    if (!cleanData.barcode) delete cleanData.barcode;
    if (!cleanData.unit) delete cleanData.unit;
    if (
      cleanData.originalPrice === undefined ||
      cleanData.originalPrice === null ||
      isNaN(cleanData.originalPrice)
    ) {
      delete cleanData.originalPrice;
    }

    await onSubmit(cleanData);
  };

  return (
    <form onSubmit={handleSubmit(handleFormSubmit)} className="space-y-8">
      {/* ===== Product Images ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Product Images
        </h3>
        <ImageUpload
          images={watchedImages}
          onChange={handleImagesChange}
          maxImages={5}
        />
      </div>

      {/* ===== Basic Information ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Basic Information
        </h3>

        <div>
          <label className="block text-sm font-medium mb-2">
            Product Name <span className="text-destructive">*</span>
          </label>
          <Input
            {...register("name")}
            placeholder="e.g., iPhone 15 Pro Max 256GB"
            error={errors.name?.message}
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Description</label>
          <textarea
            {...register("description")}
            className="w-full rounded-lg border border-input bg-background px-4 py-3 text-sm min-h-[120px] focus:outline-none focus:ring-2 focus:ring-ring resize-y"
            placeholder="Describe your product â€” condition, features, what's included..."
          />
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Listing Type <span className="text-destructive">*</span>
            </label>
            <Controller
              name="type"
              control={control}
              render={({ field }) => (
                <Select
                  value={field.value}
                  onChange={field.onChange}
                  options={PRODUCT_TYPE_OPTIONS}
                  error={errors.type?.message}
                />
              )}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Brand</label>
            <Input
              {...register("brand")}
              placeholder="e.g., Apple, Samsung, Nike"
            />
          </div>
        </div>
      </div>

      {/* ===== Category ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Category
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Category <span className="text-destructive">*</span>
            </label>
            <Controller
              name="category"
              control={control}
              render={({ field }) => (
                <Select
                  value={field.value}
                  onChange={field.onChange}
                  options={CATEGORY_OPTIONS.map((c) => ({
                    value: c,
                    label: c,
                  }))}
                  placeholder="Select category"
                  error={errors.category?.message}
                />
              )}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Subcategory
            </label>
            <Input
              {...register("subcategory")}
              placeholder="e.g., Smartphones, Running Shoes"
            />
          </div>
        </div>
      </div>

      {/* ===== Pricing & Stock ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Pricing & Stock
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Price (â‚¦) <span className="text-destructive">*</span>
            </label>
            <Input
              type="number"
              step="0.01"
              min="0"
              {...register("price", { valueAsNumber: true })}
              placeholder="0.00"
              error={errors.price?.message}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Original Price (â‚¦)
              <span className="text-xs text-muted-foreground ml-1">
                (for discounts)
              </span>
            </label>
            <Input
              type="number"
              step="0.01"
              min="0"
              {...register("originalPrice", { valueAsNumber: true })}
              placeholder="0.00"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Quantity</label>
            <Input
              type="number"
              min="0"
              {...register("quantity", { valueAsNumber: true })}
              placeholder="0"
              error={errors.quantity?.message}
            />
          </div>
        </div>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">Unit</label>
            <Input
              {...register("unit")}
              placeholder="e.g., piece, kg, pack, dozen"
            />
          </div>

          <div className="flex items-center gap-3 pt-6">
            <label className="relative inline-flex items-center cursor-pointer">
              <input
                type="checkbox"
                {...register("inStock")}
                className="sr-only peer"
              />
              <div className="w-11 h-6 bg-muted peer-focus:outline-none peer-focus:ring-2 peer-focus:ring-ring rounded-full peer peer-checked:after:translate-x-full peer-checked:after:border-white after:content-[''] after:absolute after:top-[2px] after:left-[2px] after:bg-white after:border-gray-300 after:border after:rounded-full after:h-5 after:w-5 after:transition-all peer-checked:bg-primary" />
              <span className="ml-3 text-sm font-medium">
                {watchedInStock ? "In Stock" : "Out of Stock"}
              </span>
            </label>
          </div>
        </div>
      </div>

      {/* ===== Product Identification ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Product Identification
          <span className="text-sm font-normal text-muted-foreground ml-2">
            (Optional â€” helps match for price comparison)
          </span>
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">SKU</label>
            <Input {...register("sku")} placeholder="Stock Keeping Unit" />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Barcode</label>
            <Input {...register("barcode")} placeholder="UPC / EAN barcode" />
          </div>
        </div>
      </div>

      {/* ===== Tags ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Tags
          <span className="text-sm font-normal text-muted-foreground ml-2">
            (Help customers find your product)
          </span>
        </h3>

        <div>
          <div className="flex gap-2">
            <Input
              value={tagInput}
              onChange={(e) => setTagInput(e.target.value)}
              onKeyDown={handleTagKeyDown}
              placeholder="Type a tag and press Enter"
              className="flex-1"
            />
            <Button
              type="button"
              variant="outline"
              onClick={handleAddTag}
              disabled={!tagInput.trim()}
            >
              Add
            </Button>
          </div>

          {watchedTags.length > 0 && (
            <div className="flex flex-wrap gap-2 mt-3">
              {watchedTags.map((tag) => (
                <span
                  key={tag}
                  className="inline-flex items-center gap-1 px-3 py-1 rounded-full bg-primary/10 text-primary text-sm"
                >
                  {tag}
                  <button
                    type="button"
                    onClick={() => handleRemoveTag(tag)}
                    className="ml-1 text-primary/60 hover:text-primary"
                  >
                    <X className="h-3 w-3" />
                  </button>
                </span>
              ))}
            </div>
          )}
        </div>
      </div>

      {/* ===== Submit ===== */}
      <div className="pt-4 border-t border-border">
        <Button
          type="submit"
          size="lg"
          isLoading={isLoading}
          className="w-full"
        >
          {initialData?.id ? "Update Product" : "Add Product"}
        </Button>
      </div>
    </form>
  );
}"use client";

import { useState } from "react";
import { useRouter } from "next/navigation";
import Link from "next/link";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { Eye, EyeOff, Mail, Lock, User, Phone } from "lucide-react";
import { Button, Input } from "@/components/ui";
import { registerSchema, RegisterInput } from "@/lib/validations";
import { authService } from "@/services";
import { useAuthStore } from "@/store";
import toast from "react-hot-toast";

export function RegisterForm() {
  const router = useRouter();
  const { setUser } = useAuthStore();
  const [showPassword, setShowPassword] = useState(false);
  const [isLoading, setIsLoading] = useState(false);

  const {
    register,
    handleSubmit,
    formState: { errors },
  } = useForm<RegisterInput>({
    resolver: zodResolver(registerSchema),
  });

  const onSubmit = async (data: RegisterInput) => {
    setIsLoading(true);
    try {
      const response = await authService.register(data);
      setUser(response.user);
      toast.success("Account created successfully!");
      router.push("/");
    } catch (error: any) {
      toast.error(error.response?.data?.message || "Registration failed");
    } finally {
      setIsLoading(false);
    }
  };

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-6">
      <div className="space-y-4">
        <div className="grid grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">First Name</label>
            <Input
              type="text"
              placeholder="John"
              {...register("firstName")}
              error={errors.firstName?.message}
              leftIcon={<User className="h-5 w-5" />}
            />
          </div>
          <div>
            <label className="block text-sm font-medium mb-2">Last Name</label>
            <Input
              type="text"
              placeholder="Doe"
              {...register("lastName")}
              error={errors.lastName?.message}
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Email</label>
          <Input
            type="email"
            placeholder="john@example.com"
            {...register("email")}
            error={errors.email?.message}
            leftIcon={<Mail className="h-5 w-5" />}
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Phone Number</label>
          <Input
            type="tel"
            placeholder="08012345678"
            {...register("phone")}
            error={errors.phone?.message}
            leftIcon={<Phone className="h-5 w-5" />}
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Password</label>
          <Input
            type={showPassword ? "text" : "password"}
            placeholder="Create a password"
            {...register("password")}
            error={errors.password?.message}
            leftIcon={<Lock className="h-5 w-5" />}
            rightIcon={
              <button
                type="button"
                onClick={() => setShowPassword(!showPassword)}
                className="hover:text-foreground"
              >
                {showPassword ? (
                  <EyeOff className="h-5 w-5" />
                ) : (
                  <Eye className="h-5 w-5" />
                )}
              </button>
            }
          />
        </div>
      </div>

      <div className="flex items-start gap-2">
        <input
          type="checkbox"
          required
          className="mt-1 rounded border-input"
        />
        <span className="text-sm text-muted-foreground">
          I agree to the{" "}
          <Link href="/terms" className="text-primary hover:underline">
            Terms of Service
          </Link>{" "}
          and{" "}
          <Link href="/privacy" className="text-primary hover:underline">
            Privacy Policy
          </Link>
        </span>
      </div>

      <Button type="submit" className="w-full" size="lg" isLoading={isLoading}>
        Create Account
      </Button>

      <p className="text-center text-sm text-muted-foreground">
        Already have an account?{" "}
        <Link href="/login" className="text-primary hover:underline font-medium">
          Sign in
        </Link>
      </p>
    </form>
  );
}"use client";

import { useEffect, useCallback } from "react";
import { useForm } from "react-hook-form";
import { zodResolver } from "@hookform/resolvers/zod";
import { Button, Input, Select } from "@/components/ui";
import { LocationSelect } from "@/components/forms/location-select";
import { vendorSchema, VendorInput } from "@/lib/validations";
import { VENDOR_TYPES, NIGERIAN_BANKS } from "@/lib/constants";

interface VendorFormProps {
  initialData?: Partial<VendorInput>;
  onSubmit: (data: VendorInput) => Promise<void>;
  isLoading?: boolean;
}

export function VendorForm({ initialData, onSubmit, isLoading }: VendorFormProps) {
  const {
    register,
    handleSubmit,
    formState: { errors },
    setValue,
    watch,
    reset,
  } = useForm<VendorInput>({
    resolver: zodResolver(vendorSchema),
    defaultValues: {
      businessName: "",
      businessDescription: "",
      vendorType: "market_shop",
      stateId: "",
      areaId: "",
      marketId: "",
      shopNumber: "",
      shopFloor: "",
      shopBlock: "",
      shopAddress: "",
      landmark: "",
      contactDetails: {
        phone: "",
        alternatePhone: "",
        whatsapp: "",
        email: "",
        instagram: "",
        facebook: "",
        twitter: "",
        website: "",
      },
      bankDetails: {
        bankName: "",
        accountName: "",
        accountNumber: "",
        bankCode: "",
      },
      operatingHours: {
        openingTime: "",
        closingTime: "",
        operatingDays: [],
      },
      categories: [],
      tags: [],
      ...initialData,
    },
  });

  const vendorType = watch("vendorType");

  // Reset form when initialData changes (edit mode)
  useEffect(() => {
    if (initialData) {
      reset({
        businessName: "",
        businessDescription: "",
        vendorType: "market_shop",
        stateId: "",
        areaId: "",
        marketId: "",
        shopNumber: "",
        shopFloor: "",
        shopBlock: "",
        shopAddress: "",
        landmark: "",
        contactDetails: {
          phone: "",
          alternatePhone: "",
          whatsapp: "",
          email: "",
          instagram: "",
          facebook: "",
          twitter: "",
          website: "",
        },
        bankDetails: {
          bankName: "",
          accountName: "",
          accountNumber: "",
          bankCode: "",
        },
        operatingHours: {
          openingTime: "",
          closingTime: "",
          operatingDays: [],
        },
        categories: [],
        tags: [],
        ...initialData,
      });
    }
  }, [initialData, reset]);

  // âœ… Stable callbacks â€” won't cause LocationSelect re-renders
  const handleLocationStateChange = useCallback(
    (stateId: string) => {
      setValue("stateId", stateId, { shouldValidate: true });
    },
    [setValue]
  );

  const handleLocationAreaChange = useCallback(
    (areaId: string) => {
      setValue("areaId", areaId, { shouldValidate: true });
    },
    [setValue]
  );

  const handleLocationMarketChange = useCallback(
    (marketId: string) => {
      setValue("marketId", marketId || undefined, { shouldValidate: true });
    },
    [setValue]
  );

  return (
    <form onSubmit={handleSubmit(onSubmit)} className="space-y-8">
      {/* ===== Business Info ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Business Information
        </h3>

        <div>
          <label className="block text-sm font-medium mb-2">
            Business Name <span className="text-destructive">*</span>
          </label>
          <Input
            {...register("businessName")}
            error={errors.businessName?.message}
            placeholder="Your shop or business name"
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Description</label>
          <textarea
            {...register("businessDescription")}
            className="w-full rounded-lg border border-input bg-background px-4 py-3 text-sm min-h-[100px] focus:outline-none focus:ring-2 focus:ring-ring"
            placeholder="Tell customers about your business, what you sell, specialties..."
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">
            Vendor Type <span className="text-destructive">*</span>
          </label>
          <Select
            value={vendorType}
            onChange={(value) =>
              setValue("vendorType", value as any, { shouldValidate: true })
            }
            options={VENDOR_TYPES}
          />
          <p className="text-xs text-muted-foreground mt-1">
            Choose the type that best describes your business location
          </p>
        </div>
      </div>

      {/* ===== Location ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Location
        </h3>

        <LocationSelect
          initialStateId={initialData?.stateId}
          initialAreaId={initialData?.areaId}
          initialMarketId={initialData?.marketId}
          onStateChange={handleLocationStateChange}
          onAreaChange={handleLocationAreaChange}
          onMarketChange={handleLocationMarketChange}
          stateError={errors.stateId?.message}
          areaError={errors.areaId?.message}
        />

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Shop Number
            </label>
            <Input
              {...register("shopNumber")}
              placeholder="e.g., Shop 45, Stall 12"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Floor</label>
            <Input
              {...register("shopFloor")}
              placeholder="e.g., Ground Floor, 2nd Floor"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Block</label>
            <Input
              {...register("shopBlock")}
              placeholder="e.g., Block A, Plaza B"
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Shop Address</label>
          <Input
            {...register("shopAddress")}
            placeholder="Full address for customers to find you"
          />
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">Landmark</label>
          <Input
            {...register("landmark")}
            placeholder="Nearby landmark for easy location"
          />
        </div>
      </div>

      {/* ===== Contact Details ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Contact Information
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Phone Number <span className="text-destructive">*</span>
            </label>
            <Input
              {...register("contactDetails.phone")}
              placeholder="08012345678"
              error={errors.contactDetails?.phone?.message}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              WhatsApp Number
            </label>
            <Input
              {...register("contactDetails.whatsapp")}
              placeholder="WhatsApp number (if different)"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Email</label>
            <Input
              type="email"
              {...register("contactDetails.email")}
              placeholder="business@example.com"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Website</label>
            <Input
              {...register("contactDetails.website")}
              placeholder="https://yourwebsite.com"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Instagram</label>
            <Input
              {...register("contactDetails.instagram")}
              placeholder="@yourusername"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">Facebook</label>
            <Input
              {...register("contactDetails.facebook")}
              placeholder="facebook.com/yourpage"
            />
          </div>
        </div>
      </div>

      {/* ===== Bank Details ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Bank Details
          <span className="text-sm font-normal text-muted-foreground ml-2">
            (For customers to make direct payments)
          </span>
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-3 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">Bank Name</label>
            <Select
              value={watch("bankDetails.bankName") || ""}
              onChange={(value) =>
                setValue("bankDetails.bankName", value, {
                  shouldValidate: true,
                })
              }
              options={[
                { value: "", label: "Select bank" },
                ...NIGERIAN_BANKS.map((bank) => ({
                  value: bank,
                  label: bank,
                })),
              ]}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Account Name
            </label>
            <Input
              {...register("bankDetails.accountName")}
              placeholder="Account holder name"
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Account Number
            </label>
            <Input
              {...register("bankDetails.accountNumber")}
              placeholder="10-digit account number"
              maxLength={10}
            />
          </div>
        </div>
      </div>

      {/* ===== Operating Hours ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Operating Hours
        </h3>

        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label className="block text-sm font-medium mb-2">
              Opening Time
            </label>
            <Input
              type="time"
              {...register("operatingHours.openingTime")}
            />
          </div>

          <div>
            <label className="block text-sm font-medium mb-2">
              Closing Time
            </label>
            <Input
              type="time"
              {...register("operatingHours.closingTime")}
            />
          </div>
        </div>

        <div>
          <label className="block text-sm font-medium mb-2">
            Operating Days
          </label>
          <div className="flex flex-wrap gap-2">
            {[
              "Monday",
              "Tuesday",
              "Wednesday",
              "Thursday",
              "Friday",
              "Saturday",
              "Sunday",
            ].map((day) => (
              <label
                key={day}
                className="flex items-center gap-2 px-3 py-2 rounded-lg border border-input hover:bg-muted cursor-pointer"
              >
                <input
                  type="checkbox"
                  value={day}
                  {...register("operatingHours.operatingDays")}
                  className="rounded border-input"
                />
                <span className="text-sm">{day.slice(0, 3)}</span>
              </label>
            ))}
          </div>
        </div>
      </div>

      {/* ===== Categories ===== */}
      <div className="space-y-4">
        <h3 className="text-lg font-semibold border-b border-border pb-2">
          Product Categories
        </h3>
        <p className="text-sm text-muted-foreground">
          Select the categories of products you sell
        </p>

        <div className="flex flex-wrap gap-2">
          {[
            "Electronics",
            "Fashion",
            "Phones",
            "Computers",
            "Accessories",
            "Home & Garden",
            "Health & Beauty",
            "Sports",
            "Food & Groceries",
            "Baby & Kids",
            "Automotive",
            "Books",
          ].map((category) => (
            <label
              key={category}
              className="flex items-center gap-2 px-3 py-2 rounded-lg border border-input hover:bg-muted cursor-pointer"
            >
              <input
                type="checkbox"
                value={category}
                {...register("categories")}
                className="rounded border-input"
              />
              <span className="text-sm">{category}</span>
            </label>
          ))}
        </div>
      </div>

      {/* ===== Submit ===== */}
      <div className="pt-4 border-t border-border">
        <Button
          type="submit"
          size="lg"
          isLoading={isLoading}
          className="w-full"
        >
          {initialData ? "Update Shop" : "Create Shop"}
        </Button>
      </div>
    </form>
  );
}import Link from "next/link";
import { Logo } from "@/components/common";

const footerLinks = {
  shop: [
    { label: "All Categories", href: "/categories" },
    { label: "Popular Products", href: "/products?sortBy=popularity" },
    { label: "New Arrivals", href: "/products?sortBy=newest" },
    { label: "Compare Prices", href: "/compare" },
  ],
  vendor: [
    { label: "Become a Vendor", href: "/vendor" },
    { label: "Vendor Dashboard", href: "/vendor/dashboard" },
    { label: "Seller Guide", href: "/seller-guide" },
    { label: "Pricing", href: "/pricing" },
  ],
  company: [
    { label: "About Us", href: "/about" },
    { label: "Contact", href: "/contact" },
    { label: "Careers", href: "/careers" },
    { label: "Press", href: "/press" },
  ],
  legal: [
    { label: "Terms of Service", href: "/terms" },
    { label: "Privacy Policy", href: "/privacy" },
    { label: "Cookie Policy", href: "/cookies" },
  ],
};

export function Footer() {
  return (
    <footer className="border-t border-border bg-muted/30">
      <div className="container-premium py-12 md:py-16">
        <div className="grid grid-cols-2 md:grid-cols-5 gap-8">
          {/* Brand */}
          <div className="col-span-2 md:col-span-1">
            <Logo />
            <p className="mt-4 text-sm text-muted-foreground">
              Discover the best products from local shops across Nigeria.
              Compare prices, find deals, and support local businesses.
            </p>
          </div>

          {/* Shop */}
          <div>
            <h3 className="font-semibold mb-4">Shop</h3>
            <ul className="space-y-2">
              {footerLinks.shop.map((link) => (
                <li key={link.href}>
                  <Link
                    href={link.href}
                    className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    {link.label}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Vendor */}
          <div>
            <h3 className="font-semibold mb-4">For Vendors</h3>
            <ul className="space-y-2">
              {footerLinks.vendor.map((link) => (
                <li key={link.href}>
                  <Link
                    href={link.href}
                    className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    {link.label}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Company */}
          <div>
            <h3 className="font-semibold mb-4">Company</h3>
            <ul className="space-y-2">
              {footerLinks.company.map((link) => (
                <li key={link.href}>
                  <Link
                    href={link.href}
                    className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    {link.label}
                  </Link>
                </li>
              ))}
            </ul>
          </div>

          {/* Legal */}
          <div>
            <h3 className="font-semibold mb-4">Legal</h3>
            <ul className="space-y-2">
              {footerLinks.legal.map((link) => (
                <li key={link.href}>
                  <Link
                    href={link.href}
                    className="text-sm text-muted-foreground hover:text-foreground transition-colors"
                  >
                    {link.label}
                  </Link>
                </li>
              ))}
            </ul>
          </div>
        </div>

        {/* Bottom */}
        <div className="mt-12 pt-8 border-t border-border flex flex-col md:flex-row justify-between items-center gap-4">
          <p className="text-sm text-muted-foreground">
            Â© {new Date().getFullYear()} SureShops. All rights reserved.
          </p>
          <div className="flex items-center gap-4">
            <span className="text-sm text-muted-foreground">Made in ðŸ‡³ðŸ‡¬ Nigeria</span>
          </div>
        </div>
      </div>
    </footer>
  );
}"use client";

import { useState } from "react";
import Link from "next/link";
import { useRouter } from "next/navigation";
import {
  Search,
  Menu,
  X,
  User,
  ShoppingBag,
  MapPin,
  ChevronDown,
  LogOut,
  Store,
  Settings,
  Heart,
} from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { Button, Avatar } from "@/components/ui";
import { Logo } from "@/components/common";
import { useAuth } from "@/hooks";
import { cn } from "@/lib/utils";

export function Header() {
  const router = useRouter();
  const { user, isAuthenticated, isVendor, logout } = useAuth();
  const [isMenuOpen, setIsMenuOpen] = useState(false);
  const [isProfileOpen, setIsProfileOpen] = useState(false);
  const [searchQuery, setSearchQuery] = useState("");

  const handleSearch = (e: React.FormEvent) => {
    e.preventDefault();
    if (searchQuery.trim()) {
      router.push(`/search?query=${encodeURIComponent(searchQuery)}`);
    }
  };

  return (
    <header className="sticky top-0 z-40 w-full border-b border-border bg-background/95 backdrop-blur supports-[backdrop-filter]:bg-background/60">
      <div className="container-premium">
        <div className="flex h-16 items-center justify-between gap-4">
          {/* Logo */}
          <Link href="/" className="flex-shrink-0">
            <Logo />
          </Link>

          {/* Search Bar - Desktop */}
          <form
            onSubmit={handleSearch}
            className="hidden flex-1 max-w-xl md:flex"
          >
            <div className="relative w-full">
              <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
              <input
                type="text"
                placeholder="Search products, shops..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="h-10 w-full rounded-full border border-input bg-muted/50 pl-10 pr-4 text-sm outline-none transition-all focus:bg-background focus:ring-2 focus:ring-ring"
              />
            </div>
          </form>

          {/* Actions */}
          <div className="flex items-center gap-2">
            {/* Location */}
            <Button variant="ghost" size="sm" className="hidden lg:flex">
              <MapPin className="mr-2 h-4 w-4" />
              <span className="max-w-[100px] truncate">Lagos</span>
              <ChevronDown className="ml-1 h-3 w-3" />
            </Button>

            {isAuthenticated ? (
              <>
                {/* Favorites */}
                <Button variant="ghost" size="icon" asChild>
                  <Link href="/profile/favorites">
                    <Heart className="h-5 w-5" />
                  </Link>
                </Button>

                {/* Profile Dropdown */}
                <div className="relative">
                  <button
                    onClick={() => setIsProfileOpen(!isProfileOpen)}
                    className="flex items-center gap-2 rounded-full p-1 hover:bg-accent transition-colors"
                  >
                    <Avatar
                      src={user?.avatar}
                      name={`${user?.firstName} ${user?.lastName}`}
                      size="sm"
                    />
                    <ChevronDown className="h-4 w-4 text-muted-foreground hidden sm:block" />
                  </button>

                  <AnimatePresence>
                    {isProfileOpen && (
                      <>
                        <div
                          className="fixed inset-0 z-40"
                          onClick={() => setIsProfileOpen(false)}
                        />
                        <motion.div
                          initial={{ opacity: 0, y: 10 }}
                          animate={{ opacity: 1, y: 0 }}
                          exit={{ opacity: 0, y: 10 }}
                          className="absolute right-0 mt-2 w-56 rounded-xl border border-border bg-background p-2 shadow-lg z-50"
                        >
                          <div className="px-3 py-2 border-b border-border mb-2">
                            <p className="font-medium">
                              {user?.firstName} {user?.lastName}
                            </p>
                            <p className="text-xs text-muted-foreground">
                              {user?.email}
                            </p>
                          </div>

                          <Link
                            href="/profile"
                            onClick={() => setIsProfileOpen(false)}
                            className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm hover:bg-accent transition-colors"
                          >
                            <User className="h-4 w-4" />
                            Profile
                          </Link>

                          {isVendor && (
                            <Link
                              href="/vendor/dashboard"
                              onClick={() => setIsProfileOpen(false)}
                              className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm hover:bg-accent transition-colors"
                            >
                              <Store className="h-4 w-4" />
                              Vendor Dashboard
                            </Link>
                          )}

                          <Link
                            href="/profile/settings"
                            onClick={() => setIsProfileOpen(false)}
                            className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm hover:bg-accent transition-colors"
                          >
                            <Settings className="h-4 w-4" />
                            Settings
                          </Link>

                          <button
                            onClick={() => {
                              logout();
                              setIsProfileOpen(false);
                            }}
                            className="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm text-destructive hover:bg-destructive/10 transition-colors"
                          >
                            <LogOut className="h-4 w-4" />
                            Logout
                          </button>
                        </motion.div>
                      </>
                    )}
                  </AnimatePresence>
                </div>
              </>
            ) : (
              <div className="flex items-center gap-2">
                <Button variant="ghost" size="sm" asChild>
                  <Link href="/login">Login</Link>
                </Button>
                <Button size="sm" asChild>
                  <Link href="/register">Sign Up</Link>
                </Button>
              </div>
            )}

            {/* Mobile Menu Button */}
            <Button
              variant="ghost"
              size="icon"
              className="md:hidden"
              onClick={() => setIsMenuOpen(!isMenuOpen)}
            >
              {isMenuOpen ? (
                <X className="h-5 w-5" />
              ) : (
                <Menu className="h-5 w-5" />
              )}
            </Button>
          </div>
        </div>

        {/* Mobile Search */}
        <div className="pb-3 md:hidden">
          <form onSubmit={handleSearch}>
            <div className="relative">
              <Search className="absolute left-3 top-1/2 h-4 w-4 -translate-y-1/2 text-muted-foreground" />
              <input
                type="text"
                placeholder="Search products, shops..."
                value={searchQuery}
                onChange={(e) => setSearchQuery(e.target.value)}
                className="h-10 w-full rounded-full border border-input bg-muted/50 pl-10 pr-4 text-sm outline-none transition-all focus:bg-background focus:ring-2 focus:ring-ring"
              />
            </div>
          </form>
        </div>
      </div>

      {/* Mobile Menu */}
      <AnimatePresence>
        {isMenuOpen && (
          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: "auto" }}
            exit={{ opacity: 0, height: 0 }}
            className="border-t border-border md:hidden"
          >
            <nav className="container-premium py-4 space-y-2">
              <Link
                href="/categories"
                className="block rounded-lg px-4 py-2 hover:bg-accent"
                onClick={() => setIsMenuOpen(false)}
              >
                Categories
              </Link>
              <Link
                href="/shops"
                className="block rounded-lg px-4 py-2 hover:bg-accent"
                onClick={() => setIsMenuOpen(false)}
              >
                Shops
              </Link>
              <Link
                href="/compare"
                className="block rounded-lg px-4 py-2 hover:bg-accent"
                onClick={() => setIsMenuOpen(false)}
              >
                Compare Prices
              </Link>
            </nav>
          </motion.div>
        )}
      </AnimatePresence>
    </header>
  );
}export * from './header';
export * from './footer';
export * from './mobile-nav';
export * from './vendor-sidebar';"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import { Home, Search, Grid, Heart, User } from "lucide-react";
import { cn } from "@/lib/utils";
import { useAuth } from "@/hooks";

const navItems = [
  { href: "/", icon: Home, label: "Home" },
  { href: "/search", icon: Search, label: "Search" },
  { href: "/categories", icon: Grid, label: "Categories" },
  { href: "/profile/favorites", icon: Heart, label: "Favorites" },
  { href: "/profile", icon: User, label: "Profile" },
];

export function MobileNav() {
  const pathname = usePathname();
  const { isAuthenticated } = useAuth();

  return (
    <nav className="fixed bottom-0 left-0 right-0 z-40 border-t border-border bg-background md:hidden">
      <div className="flex items-center justify-around">
        {navItems.map((item) => {
          const isActive = pathname === item.href;
          const Icon = item.icon;

          return (
            <Link
              key={item.href}
              href={
                !isAuthenticated && (item.href === "/profile" || item.href === "/profile/favorites")
                  ? "/login"
                  : item.href
              }
              className={cn(
                "flex flex-1 flex-col items-center gap-1 py-3 text-xs transition-colors",
                isActive ? "text-foreground" : "text-muted-foreground"
              )}
            >
              <Icon className={cn("h-5 w-5", isActive && "text-primary")} />
              <span>{item.label}</span>
            </Link>
          );
        })}
      </div>
    </nav>
  );
}"use client";

import Link from "next/link";
import { usePathname } from "next/navigation";
import {
  LayoutDashboard,
  Package,
  Plus,
  Settings,
  BarChart3,
  Store,
  ArrowLeft,
} from "lucide-react";
import { cn } from "@/lib/utils";
import { Logo } from "@/components/common";

const menuItems = [
  { href: "/vendor/dashboard", icon: LayoutDashboard, label: "Dashboard" },
  { href: "/vendor/products", icon: Package, label: "Products" },
  { href: "/vendor/products/new", icon: Plus, label: "Add Product" },
  { href: "/vendor/settings", icon: Settings, label: "Shop Settings" },
];

export function VendorSidebar() {
  const pathname = usePathname();

  return (
    <aside className="fixed left-0 top-0 z-30 hidden h-screen w-64 border-r border-border bg-card lg:block">
      <div className="flex h-full flex-col">
        {/* Header */}
        <div className="flex h-16 items-center justify-between border-b border-border px-6">
          <Logo />
        </div>

        {/* Navigation */}
        <nav className="flex-1 space-y-1 p-4">
          {menuItems.map((item) => {
            const isActive = pathname === item.href;
            const Icon = item.icon;

            return (
              <Link
                key={item.href}
                href={item.href}
                className={cn(
                  "flex items-center gap-3 rounded-lg px-3 py-2.5 text-sm font-medium transition-colors",
                  isActive
                    ? "bg-primary text-primary-foreground"
                    : "text-muted-foreground hover:bg-accent hover:text-foreground"
                )}
              >
                <Icon className="h-5 w-5" />
                {item.label}
              </Link>
            );
          })}
        </nav>

        {/* Footer */}
        <div className="border-t border-border p-4">
          <Link
            href="/"
            className="flex items-center gap-2 rounded-lg px-3 py-2 text-sm text-muted-foreground hover:bg-accent hover:text-foreground transition-colors"
          >
            <ArrowLeft className="h-4 w-4" />
            Back to Shop
          </Link>
        </div>
      </div>
    </aside>
  );
}export * from './product-card';
export * from './product-grid';
export * from './price-comparison';"use client";

import Link from "next/link";
import Image from "next/image";
import { Phone, MessageCircle, MapPin, Clock, BadgeCheck, Copy, ExternalLink } from "lucide-react";
import { Card, Button, Badge, Avatar } from "@/components/ui";
import { PriceTag, Rating, VerifiedBadge, LocationBadge } from "@/components/common";
import { VendorListing } from "@/types";
import { cn, formatPrice, isOpen as checkIsOpen } from "@/lib/utils";
import toast from "react-hot-toast";

interface PriceComparisonProps {
  vendors: VendorListing[];
  className?: string;
}

export function PriceComparison({ vendors, className }: PriceComparisonProps) {
  const copyBankDetails = (vendor: VendorListing) => {
    if (!vendor.bankDetails) return;
    
    const details = `Bank: ${vendor.bankDetails.bankName}\nAccount Name: ${vendor.bankDetails.accountName}\nAccount Number: ${vendor.bankDetails.accountNumber}`;
    navigator.clipboard.writeText(details);
    toast.success("Bank details copied!");
  };

  const lowestPrice = Math.min(...vendors.map((v) => v.price));

  return (
    <div className={cn("space-y-4", className)}>
      <div className="flex items-center justify-between">
        <h2 className="text-lg font-semibold">
          Compare Prices ({vendors.length} shops)
        </h2>
        <Badge variant="outline">
          Lowest: {formatPrice(lowestPrice)}
        </Badge>
      </div>

      <div className="space-y-3">
        {vendors.map((vendor, index) => {
          const isLowest = vendor.price === lowestPrice;
          const vendorIsOpen = vendor.operatingHours
            ? checkIsOpen(vendor.operatingHours.openingTime, vendor.operatingHours.closingTime)
            : true;

          return (
            <Card
              key={vendor.vendorId}
              className={cn(
                "p-4",
                isLowest && "ring-2 ring-primary"
              )}
            >
              {isLowest && (
                <Badge className="absolute -top-2 left-4">Lowest Price</Badge>
              )}

              <div className="flex gap-4">
                {/* Shop Image */}
                <div className="relative h-20 w-20 flex-shrink-0 overflow-hidden rounded-lg bg-muted">
                  {vendor.logo || vendor.entrancePhoto ? (
                    <Image
                      src={vendor.logo || vendor.entrancePhoto!}
                      alt={vendor.businessName}
                      fill
                      className="object-cover"
                    />
                  ) : (
                    <div className="flex h-full items-center justify-center">
                      <span className="text-2xl">ðŸª</span>
                    </div>
                  )}
                </div>

                {/* Shop Info */}
                <div className="flex-1 min-w-0">
                  <div className="flex items-start justify-between gap-2">
                    <div>
                      <div className="flex items-center gap-2">
                        <Link
                          href={`/shops/${vendor.vendorId}`}
                          className="font-semibold hover:text-primary transition-colors"
                        >
                          {vendor.businessName}
                        </Link>
                        {vendor.isVerified && <VerifiedBadge size="sm" />}
                      </div>
                      <div className="flex items-center gap-2 mt-1">
                        <Rating value={vendor.rating} size="sm" />
                        <Badge
                          variant={vendorIsOpen ? "success" : "secondary"}
                          className="text-xs"
                        >
                          {vendorIsOpen ? "Open" : "Closed"}
                        </Badge>
                      </div>
                    </div>

                    <PriceTag
                      price={vendor.price}
                      originalPrice={vendor.originalPrice}
                      size="md"
                    />
                  </div>

                  {/* Location */}
                  <div className="mt-2 text-sm text-muted-foreground">
                    <div className="flex items-center gap-1">
                      <MapPin className="h-3 w-3" />
                      <span className="truncate">
                        {vendor.location.shopNumber && `${vendor.location.shopNumber}, `}
                        {vendor.location.market?.name || vendor.location.area.name}
                      </span>
                    </div>
                    {vendor.location.distance !== undefined && (
                      <span className="text-xs">
                        {vendor.location.distance.toFixed(1)} km away
                      </span>
                    )}
                  </div>

                  {/* Stock */}
                  <div className="mt-2">
                    {vendor.inStock ? (
                      <Badge variant="success" className="text-xs">
                        In Stock ({vendor.quantity} available)
                      </Badge>
                    ) : (
                      <Badge variant="destructive" className="text-xs">
                        Out of Stock
                      </Badge>
                    )}
                  </div>

                  {/* Actions */}
                  <div className="mt-3 flex flex-wrap gap-2">
                    <Button
                      size="sm"
                      variant="outline"
                      onClick={() => window.open(`tel:${vendor.contactDetails.phone}`)}
                    >
                      <Phone className="mr-1 h-3 w-3" />
                      Call
                    </Button>
                    
                    {vendor.contactDetails.whatsapp && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() =>
                          window.open(
                            `https://wa.me/${vendor.contactDetails.whatsapp?.replace(/\D/g, "")}`
                          )
                        }
                      >
                        <MessageCircle className="mr-1 h-3 w-3" />
                        WhatsApp
                      </Button>
                    )}

                    {vendor.bankDetails && (
                      <Button
                        size="sm"
                        variant="outline"
                        onClick={() => copyBankDetails(vendor)}
                      >
                        <Copy className="mr-1 h-3 w-3" />
                        Bank Details
                      </Button>
                    )}

                    <Button size="sm" variant="ghost" asChild>
                      <Link href={`/shops/${vendor.vendorId}`}>
                        View Shop
                        <ExternalLink className="ml-1 h-3 w-3" />
                      </Link>
                    </Button>
                  </div>
                </div>
              </div>
            </Card>
          );
        })}
      </div>
    </div>
  );
}"use client";

import Link from "next/link";
import Image from "next/image";
import { Heart, MapPin, Store } from "lucide-react";
import { Card } from "@/components/ui";
import { PriceTag, Rating, VerifiedBadge } from "@/components/common";
import { ProductSearchResult } from "@/types";
import { cn } from "@/lib/utils";

interface ProductCardProps {
  product: ProductSearchResult;
  className?: string;
}

export function ProductCard({ product, className }: ProductCardProps) {
  return (
    <Card className={cn("group overflow-hidden", className)}>
      <Link href={`/products/${product.id}`}>
        {/* Image */}
        <div className="relative aspect-square overflow-hidden bg-muted">
          {product.images?.[0] ? (
            <Image
              src={product.images[0]}
              alt={product.name}
              fill
              className="object-cover transition-transform duration-300 group-hover:scale-105"
            />
          ) : (
            <div className="flex h-full items-center justify-center">
              <span className="text-4xl text-muted-foreground">ðŸ“¦</span>
            </div>
          )}
          
          {/* Favorite button */}
          <button
            onClick={(e) => {
              e.preventDefault();
              // Handle favorite
            }}
            className="absolute right-2 top-2 rounded-full bg-background/80 p-2 opacity-0 transition-opacity group-hover:opacity-100 hover:bg-background"
          >
            <Heart className="h-4 w-4" />
          </button>

          {/* Stock badge */}
          {!product.inStock && (
            <div className="absolute bottom-2 left-2">
              <span className="rounded-full bg-destructive px-2 py-1 text-xs font-medium text-white">
                Out of Stock
              </span>
            </div>
          )}
        </div>

        {/* Content */}
        <div className="p-4">
          {/* Vendor */}
          <div className="flex items-center gap-1 text-xs text-muted-foreground mb-1">
            <Store className="h-3 w-3" />
            <span className="truncate">{product.vendor.businessName}</span>
            {product.vendor.isVerified && <VerifiedBadge size="sm" />}
          </div>

          {/* Name */}
          <h3 className="font-medium line-clamp-2 group-hover:text-primary transition-colors">
            {product.name}
          </h3>

          {/* Location */}
          <div className="flex items-center gap-1 text-xs text-muted-foreground mt-1">
            <MapPin className="h-3 w-3" />
            <span className="truncate">
              {product.location.market?.name || product.location.area.name}
            </span>
          </div>

          {/* Price & Rating */}
          <div className="mt-3 flex items-center justify-between">
            <PriceTag
              price={product.price}
              originalPrice={product.originalPrice}
              size="sm"
            />
            {product.vendor.rating > 0 && (
              <Rating value={product.vendor.rating} size="sm" showValue={false} />
            )}
          </div>
        </div>
      </Link>
    </Card>
  );
}import { ProductCard } from "./product-card";
import { ProductSearchResult } from "@/types";
import { Skeleton } from "@/components/ui";
import { EmptyState } from "@/components/common";
import { Package } from "lucide-react";

interface ProductGridProps {
  products: ProductSearchResult[];
  isLoading?: boolean;
  emptyMessage?: string;
}

export function ProductGrid({
  products,
  isLoading,
  emptyMessage = "No products found",
}: ProductGridProps) {
  if (isLoading) {
    return (
      <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
        {Array.from({ length: 8 }).map((_, i) => (
          <div key={i} className="space-y-3">
            <Skeleton className="aspect-square w-full" />
            <Skeleton className="h-4 w-3/4" />
            <Skeleton className="h-4 w-1/2" />
          </div>
        ))}
      </div>
    );
  }

  if (products.length === 0) {
    return (
      <EmptyState
        icon={<Package className="h-10 w-10" />}
        title={emptyMessage}
        description="Try adjusting your search or filters"
      />
    );
  }

  return (
    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
      {products.map((product) => (
        <ProductCard key={product.id} product={product} />
      ))}
    </div>
  );
}"use client";

import { cn } from "@/lib/utils";

interface CategoryFilterProps {
  selected?: string;
  categories: { name: string; count: number }[];
  onChange: (category: string | undefined) => void;
}

export function CategoryFilter({
  selected,
  categories,
  onChange,
}: CategoryFilterProps) {
  return (
    <div className="space-y-1 max-h-48 overflow-y-auto">
      <button
        onClick={() => onChange(undefined)}
        className={cn(
          "w-full text-left px-3 py-2 rounded-lg text-sm transition-colors",
          !selected ? "bg-primary text-primary-foreground" : "hover:bg-muted"
        )}
      >
        All Categories
      </button>
      {categories.map((category) => (
        <button
          key={category.name}
          onClick={() => onChange(category.name)}
          className={cn(
            "w-full text-left px-3 py-2 rounded-lg text-sm transition-colors flex items-center justify-between",
            selected === category.name
              ? "bg-primary text-primary-foreground"
              : "hover:bg-muted"
          )}
        >
          <span>{category.name}</span>
          <span className="text-xs opacity-70">({category.count})</span>
        </button>
      ))}
    </div>
  );
}export * from './search-bar';
export * from './search-filters';
export * from './search-results';
export * from './location-filter';
export * from './price-filter';
export * from './category-filter';"use client";

import { useState, useEffect } from "react";
import { MapPin, ChevronDown, X } from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { Button, Select } from "@/components/ui";
import { useLocation } from "@/hooks";
import { cn } from "@/lib/utils";

interface LocationFilterProps {
  stateId?: string;
  areaId?: string;
  marketId?: string;
  onStateChange: (id: string | undefined) => void;
  onAreaChange: (id: string | undefined) => void;
  onMarketChange: (id: string | undefined) => void;
  className?: string;
}

export function LocationFilter({
  stateId,
  areaId,
  marketId,
  onStateChange,
  onAreaChange,
  onMarketChange,
  className,
}: LocationFilterProps) {
  const [isOpen, setIsOpen] = useState(false);
  const {
    states,
    areas,
    markets,
    selectedState,
    selectedArea,
    selectedMarket,
    setSelectedState,
    setSelectedArea,
    setSelectedMarket,
    loading,
    getLocationString,
    clearLocationFilters,
  } = useLocation();

  // Sync with external props
  useEffect(() => {
    if (stateId && states.length > 0) {
      const state = states.find((s) => s.id === stateId);
      if (state && state.id !== selectedState?.id) {
        setSelectedState(state);
      }
    }
  }, [stateId, states]);

  const handleStateChange = (id: string) => {
    const state = states.find((s) => s.id === id);
    setSelectedState(state || null);
    onStateChange(id || undefined);
    onAreaChange(undefined);
    onMarketChange(undefined);
  };

  const handleAreaChange = (id: string) => {
    const area = areas.find((a) => a.id === id);
    setSelectedArea(area || null);
    onAreaChange(id || undefined);
    onMarketChange(undefined);
  };

  const handleMarketChange = (id: string) => {
    const market = markets.find((m) => m.id === id);
    setSelectedMarket(market || null);
    onMarketChange(id || undefined);
  };

  const handleClear = () => {
    clearLocationFilters();
    onStateChange(undefined);
    onAreaChange(undefined);
    onMarketChange(undefined);
    setIsOpen(false);
  };

  const locationText = getLocationString() || "All Locations";
  const hasSelection = selectedState || selectedArea || selectedMarket;

  return (
    <div className={cn("relative", className)}>
      <Button
        variant="outline"
        size="sm"
        onClick={() => setIsOpen(!isOpen)}
        className="gap-2"
      >
        <MapPin className="h-4 w-4" />
        <span className="max-w-[150px] truncate">{locationText}</span>
        {hasSelection ? (
          <X
            className="h-4 w-4 hover:text-destructive"
            onClick={(e) => {
              e.stopPropagation();
              handleClear();
            }}
          />
        ) : (
          <ChevronDown className="h-4 w-4" />
        )}
      </Button>

      <AnimatePresence>
        {isOpen && (
          <>
            <div
              className="fixed inset-0 z-40"
              onClick={() => setIsOpen(false)}
            />
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 10 }}
              className="absolute left-0 z-50 mt-2 w-72 rounded-xl border border-border bg-background p-4 shadow-xl"
            >
              <div className="space-y-4">
                <h4 className="font-medium">Filter by Location</h4>

                {/* State */}
                <div>
                  <label className="text-sm text-muted-foreground mb-1 block">
                    State
                  </label>
                  <Select
                    value={selectedState?.id || ""}
                    onChange={handleStateChange}
                    options={[
                      { value: "", label: "All States" },
                      ...states.map((s) => ({ value: s.id, label: s.name })),
                    ]}
                    placeholder="Select state"
                    disabled={loading}
                  />
                </div>

                {/* Area */}
                {selectedState && (
                  <div>
                    <label className="text-sm text-muted-foreground mb-1 block">
                      Area
                    </label>
                    <Select
                      value={selectedArea?.id || ""}
                      onChange={handleAreaChange}
                      options={[
                        { value: "", label: "All Areas" },
                        ...areas.map((a) => ({ value: a.id, label: a.name })),
                      ]}
                      placeholder="Select area"
                      disabled={loading || areas.length === 0}
                    />
                  </div>
                )}

                {/* Market */}
                {selectedArea && markets.length > 0 && (
                  <div>
                    <label className="text-sm text-muted-foreground mb-1 block">
                      Market / Mall
                    </label>
                    <Select
                      value={selectedMarket?.id || ""}
                      onChange={handleMarketChange}
                      options={[
                        { value: "", label: "All Markets" },
                        ...markets.map((m) => ({ value: m.id, label: m.name })),
                      ]}
                      placeholder="Select market"
                      disabled={loading}
                    />
                  </div>
                )}

                {/* Actions */}
                <div className="flex gap-2 pt-2">
                  <Button
                    variant="outline"
                    size="sm"
                    onClick={handleClear}
                    className="flex-1"
                  >
                    Clear
                  </Button>
                  <Button
                    size="sm"
                    onClick={() => setIsOpen(false)}
                    className="flex-1"
                  >
                    Apply
                  </Button>
                </div>
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}"use client";

import { useState, useEffect } from "react";
import { Input } from "@/components/ui";
import { formatPrice } from "@/lib/utils";

interface PriceFilterProps {
  minPrice?: number;
  maxPrice?: number;
  priceRange?: { min: number; max: number };
  onMinChange: (value: number | undefined) => void;
  onMaxChange: (value: number | undefined) => void;
}

export function PriceFilter({
  minPrice,
  maxPrice,
  priceRange,
  onMinChange,
  onMaxChange,
}: PriceFilterProps) {
  const [localMin, setLocalMin] = useState(minPrice?.toString() || "");
  const [localMax, setLocalMax] = useState(maxPrice?.toString() || "");

  useEffect(() => {
    setLocalMin(minPrice?.toString() || "");
  }, [minPrice]);

  useEffect(() => {
    setLocalMax(maxPrice?.toString() || "");
  }, [maxPrice]);

  const handleMinBlur = () => {
    const value = localMin ? parseInt(localMin, 10) : undefined;
    onMinChange(value);
  };

  const handleMaxBlur = () => {
    const value = localMax ? parseInt(localMax, 10) : undefined;
    onMaxChange(value);
  };

  return (
    <div className="space-y-2">
      <div className="flex items-center gap-2">
        <Input
          type="number"
          placeholder="Min"
          value={localMin}
          onChange={(e) => setLocalMin(e.target.value)}
          onBlur={handleMinBlur}
          className="h-9"
        />
        <span className="text-muted-foreground">-</span>
        <Input
          type="number"
          placeholder="Max"
          value={localMax}
          onChange={(e) => setLocalMax(e.target.value)}
          onBlur={handleMaxBlur}
          className="h-9"
        />
      </div>
      {priceRange && (
        <p className="text-xs text-muted-foreground">
          Range: {formatPrice(priceRange.min)} - {formatPrice(priceRange.max)}
        </p>
      )}
    </div>
  );
}"use client";

import { useState, useRef, useEffect } from "react";
import { useRouter } from "next/navigation";
import { Search, X, Clock, TrendingUp, ArrowRight } from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils";
import { useSearchStore } from "@/store";
import { useDebounce } from "@/hooks";

interface SearchBarProps {
  variant?: "default" | "hero";
  placeholder?: string;
  className?: string;
  autoFocus?: boolean;
}

const popularSearches = [
  "iPhone 15",
  "Samsung Galaxy",
  "Laptop",
  "PlayStation 5",
  "Air Jordan",
  "MacBook",
];

export function SearchBar({
  variant = "default",
  placeholder = "Search products, shops, brands...",
  className,
  autoFocus = false,
}: SearchBarProps) {
  const router = useRouter();
  const inputRef = useRef<HTMLInputElement>(null);
  const [isFocused, setIsFocused] = useState(false);
  const [localQuery, setLocalQuery] = useState("");
  const { recentSearches, addRecentSearch, clearRecentSearches } = useSearchStore();
  const debouncedQuery = useDebounce(localQuery, 300);

  useEffect(() => {
    if (autoFocus && inputRef.current) {
      inputRef.current.focus();
    }
  }, [autoFocus]);

  const handleSearch = (query: string) => {
    if (query.trim()) {
      addRecentSearch(query.trim());
      router.push(`/search?query=${encodeURIComponent(query.trim())}`);
      setIsFocused(false);
    }
  };

  const handleSubmit = (e: React.FormEvent) => {
    e.preventDefault();
    handleSearch(localQuery);
  };

  const handleClear = () => {
    setLocalQuery("");
    inputRef.current?.focus();
  };

  const isHero = variant === "hero";

  return (
    <div className={cn("relative", className)}>
      <form onSubmit={handleSubmit}>
        <div
          className={cn(
            "relative flex items-center transition-all duration-200",
            isHero
              ? "rounded-2xl bg-background shadow-2xl ring-1 ring-border"
              : "rounded-full bg-muted/50 ring-1 ring-transparent focus-within:ring-ring focus-within:bg-background"
          )}
        >
          <Search
            className={cn(
              "absolute left-4 text-muted-foreground",
              isHero ? "h-6 w-6" : "h-5 w-5"
            )}
          />
          <input
            ref={inputRef}
            type="text"
            value={localQuery}
            onChange={(e) => setLocalQuery(e.target.value)}
            onFocus={() => setIsFocused(true)}
            placeholder={placeholder}
            className={cn(
              "w-full bg-transparent outline-none placeholder:text-muted-foreground",
              isHero
                ? "h-16 pl-14 pr-14 text-lg"
                : "h-12 pl-12 pr-12 text-sm"
            )}
          />
          {localQuery && (
            <button
              type="button"
              onClick={handleClear}
              className={cn(
                "absolute right-4 rounded-full p-1 text-muted-foreground hover:text-foreground hover:bg-muted transition-colors",
                isHero ? "right-14" : "right-4"
              )}
            >
              <X className="h-4 w-4" />
            </button>
          )}
          {isHero && (
            <button
              type="submit"
              className="absolute right-3 rounded-xl bg-primary p-3 text-primary-foreground hover:bg-primary/90 transition-colors"
            >
              <ArrowRight className="h-5 w-5" />
            </button>
          )}
        </div>
      </form>

      {/* Dropdown */}
      <AnimatePresence>
        {isFocused && (
          <>
            <div
              className="fixed inset-0 z-40"
              onClick={() => setIsFocused(false)}
            />
            <motion.div
              initial={{ opacity: 0, y: 10 }}
              animate={{ opacity: 1, y: 0 }}
              exit={{ opacity: 0, y: 10 }}
              className={cn(
                "absolute left-0 right-0 z-50 mt-2 rounded-xl border border-border bg-background p-4 shadow-xl",
                isHero ? "mt-4" : "mt-2"
              )}
            >
              {/* Recent Searches */}
              {recentSearches.length > 0 && (
                <div className="mb-4">
                  <div className="flex items-center justify-between mb-2">
                    <span className="text-sm font-medium text-muted-foreground">
                      Recent Searches
                    </span>
                    <button
                      onClick={clearRecentSearches}
                      className="text-xs text-muted-foreground hover:text-foreground"
                    >
                      Clear all
                    </button>
                  </div>
                  <div className="space-y-1">
                    {recentSearches.slice(0, 5).map((search, index) => (
                      <button
                        key={index}
                        onClick={() => handleSearch(search)}
                        className="flex w-full items-center gap-2 rounded-lg px-3 py-2 text-sm hover:bg-muted transition-colors"
                      >
                        <Clock className="h-4 w-4 text-muted-foreground" />
                        <span>{search}</span>
                      </button>
                    ))}
                  </div>
                </div>
              )}

              {/* Popular Searches */}
              <div>
                <span className="text-sm font-medium text-muted-foreground mb-2 block">
                  Popular Searches
                </span>
                <div className="flex flex-wrap gap-2">
                  {popularSearches.map((search) => (
                    <button
                      key={search}
                      onClick={() => handleSearch(search)}
                      className="flex items-center gap-1 rounded-full bg-muted px-3 py-1.5 text-sm hover:bg-muted/80 transition-colors"
                    >
                      <TrendingUp className="h-3 w-3 text-muted-foreground" />
                      {search}
                    </button>
                  ))}
                </div>
              </div>
            </motion.div>
          </>
        )}
      </AnimatePresence>
    </div>
  );
}"use client";

import { useState } from "react";
import { ChevronDown, X, SlidersHorizontal } from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { Button, Badge, Select } from "@/components/ui";
import { LocationFilter } from "./location-filter";
import { PriceFilter } from "./price-filter";
import { CategoryFilter } from "./category-filter";
import { SearchFilters as SearchFiltersType, AvailableFilters, SortBy } from "@/types";
import { SORT_OPTIONS } from "@/lib/constants";
import { cn } from "@/lib/utils";

interface SearchFiltersProps {
  filters: Partial<SearchFiltersType>;
  availableFilters?: AvailableFilters;
  onFilterChange: (key: keyof SearchFiltersType, value: any) => void;
  onClearFilters: () => void;
  className?: string;
}

export function SearchFilters({
  filters,
  availableFilters,
  onFilterChange,
  onClearFilters,
  className,
}: SearchFiltersProps) {
  const [isExpanded, setIsExpanded] = useState(false);

  const activeFilterCount = Object.values(filters).filter(
    (v) => v !== undefined && v !== null && v !== ""
  ).length;

  return (
    <div className={cn("space-y-4", className)}>
      {/* Filter Bar */}
      <div className="flex flex-wrap items-center gap-2">
        {/* Sort */}
        <Select
          value={filters.sortBy || "relevance"}
          onChange={(value) => onFilterChange("sortBy", value as SortBy)}
          options={SORT_OPTIONS}
          placeholder="Sort by"
          className="w-40"
        />

        {/* Location Filter */}
        <LocationFilter
          stateId={filters.stateId}
          areaId={filters.areaId}
          marketId={filters.marketId}
          onStateChange={(id:any) => onFilterChange("stateId", id)}
          onAreaChange={(id :any) => onFilterChange("areaId", id)}
          onMarketChange={(id :any) => onFilterChange("marketId", id)}
        />

        {/* More Filters Button */}
        <Button
          variant="outline"
          size="sm"
          onClick={() => setIsExpanded(!isExpanded)}
          className="gap-2"
        >
          <SlidersHorizontal className="h-4 w-4" />
          Filters
          {activeFilterCount > 0 && (
            <Badge variant="secondary" className="ml-1">
              {activeFilterCount}
            </Badge>
          )}
          <ChevronDown
            className={cn(
              "h-4 w-4 transition-transform",
              isExpanded && "rotate-180"
            )}
          />
        </Button>

        {/* Clear Filters */}
        {activeFilterCount > 0 && (
          <Button variant="ghost" size="sm" onClick={onClearFilters}>
            <X className="mr-1 h-4 w-4" />
            Clear all
          </Button>
        )}
      </div>

      {/* Expanded Filters */}
      <AnimatePresence>
        {isExpanded && (
          <motion.div
            initial={{ opacity: 0, height: 0 }}
            animate={{ opacity: 1, height: "auto" }}
            exit={{ opacity: 0, height: 0 }}
            className="overflow-hidden"
          >
            <div className="grid grid-cols-1 md:grid-cols-3 gap-4 p-4 rounded-xl border border-border bg-muted/30">
              {/* Price Filter */}
              <div>
                <h4 className="text-sm font-medium mb-2">Price Range</h4>
                <PriceFilter
                  minPrice={filters.minPrice}
                  maxPrice={filters.maxPrice}
                  priceRange={availableFilters?.priceRange}
                  onMinChange={(value :any) => onFilterChange("minPrice", value)}
                  onMaxChange={(value :any) => onFilterChange("maxPrice", value)}
                />
              </div>

              {/* Category Filter */}
              <div>
                <h4 className="text-sm font-medium mb-2">Category</h4>
                <CategoryFilter
                  selected={filters.category}
                  categories={availableFilters?.categories || []}
                  onChange={(value:any) => onFilterChange("category", value)}
                />
              </div>

              {/* Brand Filter */}
              <div>
                <h4 className="text-sm font-medium mb-2">Brand</h4>
                <Select
                  value={filters.brand || ""}
                  onChange={(value) => onFilterChange("brand", value)}
                  options={[
                    { value: "", label: "All Brands" },
                    ...(availableFilters?.brands || []).map((b) => ({
                      value: b.name,
                      label: `${b.name} (${b.count})`,
                    })),
                  ]}
                  placeholder="Select brand"
                />
              </div>

              {/* Additional Filters */}
              <div className="md:col-span-3 flex flex-wrap gap-4">
                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={filters.inStock === true}
                    onChange={(e) =>
                      onFilterChange("inStock", e.target.checked || undefined)
                    }
                    className="rounded border-input"
                  />
                  <span className="text-sm">In Stock Only</span>
                </label>

                <label className="flex items-center gap-2 cursor-pointer">
                  <input
                    type="checkbox"
                    checked={filters.verifiedOnly === true}
                    onChange={(e) =>
                      onFilterChange("verifiedOnly", e.target.checked || undefined)
                    }
                    className="rounded border-input"
                  />
                  <span className="text-sm">Verified Shops Only</span>
                </label>
              </div>
            </div>
          </motion.div>
        )}
      </AnimatePresence>
    </div>
  );
}// search-results.tsx
"use client";

import { useState } from "react";
import { Grid, List, Package, Store } from "lucide-react";
import { Button, Badge } from "@/components/ui";
import { ProductGrid, PriceComparison } from "@/components/products";
import { ShopGrid } from "@/components/shops";
import { EmptyState, LoadingState, Pagination } from "@/components/common";
import { SearchResults as SearchResultsType, SearchType } from "@/types";
import { searchResultToDisplayData } from "@/types/shop-display";  // âœ… Import converter
import { cn } from "@/lib/utils";

interface SearchResultsProps {
  results: SearchResultsType | undefined;
  isLoading: boolean;
  searchType: SearchType;
  onSearchTypeChange: (type: SearchType) => void;
  onPageChange: (page: number) => void;
  currentPage: number;
}

export function SearchResults({
  results,
  isLoading,
  searchType,
  onSearchTypeChange,
  onPageChange,
  currentPage,
}: SearchResultsProps) {
  const [viewMode, setViewMode] = useState<"grid" | "compare">("grid");

  if (isLoading) {
    return <LoadingState text="Searching..." />;
  }

  if (!results) {
    return (
      <EmptyState
        icon={<Package className="h-10 w-10" />}
        title="Start searching"
        description="Enter a product name, shop, or category to find what you're looking for"
      />
    );
  }

  const hasProducts = results.products && results.products.items.length > 0;
  const hasShops = results.shops && results.shops.items.length > 0;
  const hasComparison =
    results.productComparison && results.productComparison.items.length > 0;

  return (
    <div className="space-y-6">
      {/* Tabs & View Toggle */}
      <div className="flex flex-col sm:flex-row sm:items-center sm:justify-between gap-4">
        <div className="flex items-center gap-2">
          <Button
            variant={
              searchType === "all" || searchType === "products"
                ? "default"
                : "outline"
            }
            size="sm"
            onClick={() => onSearchTypeChange("products")}
          >
            <Package className="mr-2 h-4 w-4" />
            Products
            {results.products && (
              <Badge variant="secondary" className="ml-2">
                {results.products.total}
              </Badge>
            )}
          </Button>
          <Button
            variant={searchType === "shops" ? "default" : "outline"}
            size="sm"
            onClick={() => onSearchTypeChange("shops")}
          >
            <Store className="mr-2 h-4 w-4" />
            Shops
            {results.shops && (
              <Badge variant="secondary" className="ml-2">
                {results.shops.total}
              </Badge>
            )}
          </Button>
        </div>

        {(searchType === "all" || searchType === "products") && hasProducts && (
          <div className="flex items-center gap-2">
            <span className="text-sm text-muted-foreground">View:</span>
            <div className="flex rounded-lg border border-border">
              <button
                onClick={() => setViewMode("grid")}
                className={cn(
                  "p-2 transition-colors",
                  viewMode === "grid" ? "bg-muted" : "hover:bg-muted/50"
                )}
              >
                <Grid className="h-4 w-4" />
              </button>
              <button
                onClick={() => setViewMode("compare")}
                className={cn(
                  "p-2 transition-colors",
                  viewMode === "compare" ? "bg-muted" : "hover:bg-muted/50"
                )}
              >
                <List className="h-4 w-4" />
              </button>
            </div>
          </div>
        )}
      </div>

      {/* Results */}
      {searchType === "shops" ? (
        hasShops ? (
          <>
            {/* âœ… Convert ShopSearchResult[] â†’ ShopDisplayData[] */}
            <ShopGrid
              shops={results.shops!.items.map(searchResultToDisplayData)}
            />
            {results.shops!.totalPages > 1 && (
              <Pagination
                currentPage={currentPage}
                totalPages={results.shops!.totalPages}
                onPageChange={onPageChange}
              />
            )}
          </>
        ) : (
          <EmptyState
            icon={<Store className="h-10 w-10" />}
            title="No shops found"
            description="Try adjusting your search or filters"
          />
        )
      ) : (
        <>
          {viewMode === "grid" ? (
            hasProducts ? (
              <>
                <ProductGrid products={results.products!.items} />
                {results.products!.totalPages > 1 && (
                  <Pagination
                    currentPage={currentPage}
                    totalPages={results.products!.totalPages}
                    onPageChange={onPageChange}
                  />
                )}
              </>
            ) : (
              <EmptyState
                icon={<Package className="h-10 w-10" />}
                title="No products found"
                description="Try adjusting your search or filters"
              />
            )
          ) : hasComparison ? (
            <div className="space-y-8">
              {results.productComparison!.items.map((product) => (
                <div key={product.id} className="space-y-4">
                  <div className="flex items-center justify-between">
                    <h3 className="text-lg font-semibold">{product.name}</h3>
                    <Badge variant="outline">
                      {product.totalVendors} vendors
                    </Badge>
                  </div>
                  <PriceComparison vendors={product.vendors} />
                </div>
              ))}
            </div>
          ) : (
            <EmptyState
              icon={<Package className="h-10 w-10" />}
              title="No products to compare"
              description="Try searching for a specific product"
            />
          )}
        </>
      )}

      {results.meta && (
        <p className="text-center text-sm text-muted-foreground">
          Found in {results.meta.took}ms
        </p>
      )}
    </div>
  );
}export * from './shop-card';
export * from './shop-grid';
export * from './shop-contact';
export * from './shop-location';// shop-card.tsx
"use client";

import Link from "next/link";
import Image from "next/image";
import { MapPin, Star, Package } from "lucide-react";
import { Card, Badge, Avatar } from "@/components/ui";
import { VerifiedBadge } from "@/components/common";
import { ShopDisplayData } from "@/types/shop-display";
import { cn, formatPrice, isOpen as checkIsOpen } from "@/lib/utils";

interface ShopCardProps {
  shop: ShopDisplayData;  // âœ… Single type, all optional fields handled
  className?: string;
}

export function ShopCard({ shop, className }: ShopCardProps) {
  const shopIsOpen = shop.operatingHours
    ? checkIsOpen(shop.operatingHours.openingTime, shop.operatingHours.closingTime)
    : true;

  return (
    <Card className={cn("group overflow-hidden", className)}>
      <Link href={`/shops/${shop.id}`}>
        {/* Cover Image */}
        <div className="relative h-32 bg-muted">
          {shop.entrancePhoto ? (                        
            <Image
              src={shop.entrancePhoto}
              alt={shop.businessName}
              fill
              className="object-cover transition-transform duration-300 group-hover:scale-105"
            />
          ) : (
            <div className="flex h-full items-center justify-center bg-gradient-to-br from-muted to-muted/50">
              <span className="text-4xl">ðŸª</span>
            </div>
          )}

          {/* Status Badge */}
          <div className="absolute top-2 right-2">
            <Badge variant={shopIsOpen ? "success" : "secondary"}>
              {shopIsOpen ? "Open" : "Closed"}
            </Badge>
          </div>

          {/* Featured Badge */}
          {shop.isFeatured && (
            <div className="absolute top-2 left-2">
              <Badge variant="default">Featured</Badge>
            </div>
          )}
        </div>

        {/* Content */}
        <div className="p-4">
          {/* Logo & Name */}
          <div className="flex items-start gap-3">
            <Avatar
              src={shop.logo}                             
              name={shop.businessName}
              size="lg"
              className="flex-shrink-0"
            />
            <div className="min-w-0 flex-1">
              <div className="flex items-center gap-1">
                <h3 className="font-semibold truncate group-hover:text-primary transition-colors">
                  {shop.businessName}
                </h3>
                {shop.isVerified && <VerifiedBadge size="sm" />}
              </div>

              {/* Rating */}
              <div className="flex items-center gap-1 mt-1">
                <Star className="h-4 w-4 fill-amber-400 text-amber-400" />
                <span className="text-sm font-medium">{shop.rating.toFixed(1)}</span>
                <span className="text-xs text-muted-foreground">
                  ({shop.reviewCount} reviews)
                </span>
              </div>
            </div>
          </div>

          {/* Description */}
          {shop.businessDescription && (
            <p className="mt-2 text-sm text-muted-foreground line-clamp-2">
              {shop.businessDescription}
            </p>
          )}

          {/* Location â€” âœ… all optional-chained */}
          {shop.location && (
            <div className="flex items-center gap-1 text-sm text-muted-foreground mt-2">
              <MapPin className="h-4 w-4" />
              <span className="truncate">
                {shop.location.shopNumber && `${shop.location.shopNumber}, `}
                {shop.location.market?.name || shop.location.area?.name}
              </span>
            </div>
          )}

          {/* Stats */}
          <div className="flex items-center gap-4 mt-3 text-sm">
            <div className="flex items-center gap-1 text-muted-foreground">
              <Package className="h-4 w-4" />
              <span>{shop.totalProducts} products</span>
            </div>
            {/* âœ… safe â€” priceRange is optional */}
            {shop.priceRange && shop.priceRange.min > 0 && (
              <span className="text-muted-foreground">
                {formatPrice(shop.priceRange.min)} - {formatPrice(shop.priceRange.max)}
              </span>
            )}
          </div>

          {/* Categories */}
          {shop.categories && shop.categories.length > 0 && (
            <div className="flex flex-wrap gap-1 mt-3">
              {shop.categories.slice(0, 3).map((category) => (
                <Badge key={category} variant="secondary" className="text-xs">
                  {category}
                </Badge>
              ))}
              {shop.categories.length > 3 && (
                <Badge variant="outline" className="text-xs">
                  +{shop.categories.length - 3}
                </Badge>
              )}
            </div>
          )}

          {/* Featured Products Preview â€” âœ… optional */}
          {shop.featuredProducts && shop.featuredProducts.length > 0 && (
            <div className="mt-4 pt-4 border-t border-border">
              <p className="text-xs text-muted-foreground mb-2">Top Products</p>
              <div className="flex gap-2 overflow-x-auto no-scrollbar">
                {shop.featuredProducts.map((product) => (
                  <div key={product.id} className="flex-shrink-0 w-16 text-center">
                    <div className="relative h-16 w-16 rounded-lg bg-muted overflow-hidden">
                      {product.image ? (
                        <Image
                          src={product.image}
                          alt={product.name}
                          fill
                          className="object-cover"
                        />
                      ) : (
                        <div className="flex h-full items-center justify-center text-2xl">
                          ðŸ“¦
                        </div>
                      )}
                    </div>
                    <p className="text-xs font-medium mt-1 truncate">
                      {formatPrice(product.price)}
                    </p>
                  </div>
                ))}
              </div>
            </div>
          )}
        </div>
      </Link>
    </Card>
  );
}"use client";

import { Phone, MessageCircle, Mail, Globe, Instagram, Facebook, Twitter, Copy } from "lucide-react";
import { Card, Button } from "@/components/ui";
import { ContactDetails, BankDetails } from "@/types";
import toast from "react-hot-toast";

interface ShopContactProps {
  contactDetails: ContactDetails;
  bankDetails?: BankDetails;
}

export function ShopContact({ contactDetails, bankDetails }: ShopContactProps) {
  const copyToClipboard = (text: string, label: string) => {
    navigator.clipboard.writeText(text);
    toast.success(`${label} copied!`);
  };

  const copyBankDetails = () => {
    if (!bankDetails) return;
    const details = `Bank: ${bankDetails.bankName}\nAccount Name: ${bankDetails.accountName}\nAccount Number: ${bankDetails.accountNumber}`;
    navigator.clipboard.writeText(details);
    toast.success("Bank details copied!");
  };

  return (
    <Card className="p-6">
      <h3 className="font-semibold mb-4">Contact Information</h3>

      <div className="space-y-4">
        {/* Phone */}
        <div className="flex items-center justify-between">
          <div className="flex items-center gap-3">
            <div className="flex h-10 w-10 items-center justify-center rounded-full bg-muted">
              <Phone className="h-5 w-5" />
            </div>
            <div>
              <p className="text-sm text-muted-foreground">Phone</p>
              <p className="font-medium">{contactDetails.phone}</p>
            </div>
          </div>
          <div className="flex gap-2">
            <Button
              size="sm"
              variant="outline"
              onClick={() => window.open(`tel:${contactDetails.phone}`)}
            >
              Call
            </Button>
            <Button
              size="icon"
              variant="ghost"
              onClick={() => copyToClipboard(contactDetails.phone, "Phone")}
            >
              <Copy className="h-4 w-4" />
            </Button>
          </div>
        </div>

        {/* WhatsApp */}
        {contactDetails.whatsapp && (
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-green-500/10">
                <MessageCircle className="h-5 w-5 text-green-600" />
              </div>
              <div>
                <p className="text-sm text-muted-foreground">WhatsApp</p>
                <p className="font-medium">{contactDetails.whatsapp}</p>
              </div>
            </div>
            <Button
              size="sm"
              className="bg-green-600 hover:bg-green-700"
              onClick={() =>
                window.open(
                  `https://wa.me/${contactDetails.whatsapp?.replace(/\D/g, "")}`
                )
              }
            >
              Chat
            </Button>
          </div>
        )}

        {/* Email */}
        {contactDetails.email && (
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-muted">
                <Mail className="h-5 w-5" />
              </div>
              <div>
                <p className="text-sm text-muted-foreground">Email</p>
                <p className="font-medium">{contactDetails.email}</p>
              </div>
            </div>
            <Button
              size="sm"
              variant="outline"
              onClick={() => window.open(`mailto:${contactDetails.email}`)}
            >
              Email
            </Button>
          </div>
        )}

        {/* Website */}
        {contactDetails.website && (
          <div className="flex items-center justify-between">
            <div className="flex items-center gap-3">
              <div className="flex h-10 w-10 items-center justify-center rounded-full bg-muted">
                <Globe className="h-5 w-5" />
              </div>
              <div>
                <p className="text-sm text-muted-foreground">Website</p>
                <p className="font-medium truncate max-w-[200px]">
                  {contactDetails.website}
                </p>
              </div>
            </div>
            <Button
              size="sm"
              variant="outline"
              onClick={() => window.open(contactDetails.website, "_blank")}
            >
              Visit
            </Button>
          </div>
        )}

        {/* Social Links */}
        {(contactDetails.instagram || contactDetails.facebook || contactDetails.twitter) && (
          <div className="pt-4 border-t border-border">
            <p className="text-sm text-muted-foreground mb-3">Social Media</p>
            <div className="flex gap-2">
              {contactDetails.instagram && (
                <Button
                  size="icon"
                  variant="outline"
                  onClick={() =>
                    window.open(
                      `https://instagram.com/${contactDetails.instagram}`,
                      "_blank"
                    )
                  }
                >
                  <Instagram className="h-4 w-4" />
                </Button>
              )}
              {contactDetails.facebook && (
                <Button
                  size="icon"
                  variant="outline"
                  onClick={() =>
                    window.open(
                      `https://facebook.com/${contactDetails.facebook}`,
                      "_blank"
                    )
                  }
                >
                  <Facebook className="h-4 w-4" />
                </Button>
              )}
              {contactDetails.twitter && (
                <Button
                  size="icon"
                  variant="outline"
                  onClick={() =>
                    window.open(
                      `https://twitter.com/${contactDetails.twitter}`,
                      "_blank"
                    )
                  }
                >
                  <Twitter className="h-4 w-4" />
                </Button>
              )}
            </div>
          </div>
        )}

        {/* Bank Details */}
        {bankDetails && (
          <div className="pt-4 border-t border-border">
            <div className="flex items-center justify-between mb-3">
              <p className="text-sm font-medium">Bank Details for Transfer</p>
              <Button size="sm" variant="outline" onClick={copyBankDetails}>
                <Copy className="mr-2 h-4 w-4" />
                Copy All
              </Button>
            </div>
            <div className="space-y-2 text-sm bg-muted/50 rounded-lg p-4">
              <div className="flex justify-between">
                <span className="text-muted-foreground">Bank</span>
                <span className="font-medium">{bankDetails.bankName}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-muted-foreground">Account Name</span>
                <span className="font-medium">{bankDetails.accountName}</span>
              </div>
              <div className="flex justify-between">
                <span className="text-muted-foreground">Account Number</span>
                <span className="font-mono font-medium">{bankDetails.accountNumber}</span>
              </div>
            </div>
          </div>
        )}
      </div>
    </Card>
  );
}// shop-grid.tsx
import { ShopCard } from "./shop-card";
import { ShopDisplayData } from "@/types/shop-display";
import { Skeleton } from "@/components/ui";
import { EmptyState } from "@/components/common";
import { Store } from "lucide-react";

interface ShopGridProps {
  shops: ShopDisplayData[];  // âœ… Single unified type
  isLoading?: boolean;
  emptyMessage?: string;
}

export function ShopGrid({
  shops,
  isLoading,
  emptyMessage = "No shops found",
}: ShopGridProps) {
  if (isLoading) {
    return (
      <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
        {Array.from({ length: 6 }).map((_, i) => (
          <div key={i} className="space-y-3">
            <Skeleton className="h-32 w-full" />
            <Skeleton className="h-4 w-3/4" />
            <Skeleton className="h-4 w-1/2" />
          </div>
        ))}
      </div>
    );
  }

  if (shops.length === 0) {
    return (
      <EmptyState
        icon={<Store className="h-10 w-10" />}
        title={emptyMessage}
        description="Try adjusting your search or filters"
      />
    );
  }

  return (
    <div className="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
      {shops.map((shop) => (
        <ShopCard key={shop.id} shop={shop} />
      ))}
    </div>
  );
}"use client";

import { MapPin, Navigation, Clock, Calendar } from "lucide-react";
import { Card, Badge, Button } from "@/components/ui";
import { LocationInfo, OperatingHours } from "@/types";
import { isOpen as checkIsOpen } from "@/lib/utils";
import { DAYS_OF_WEEK } from "@/lib/constants";

interface ShopLocationProps {
  location: LocationInfo;
  operatingHours?: OperatingHours & { isOpen?: boolean };
}

export function ShopLocation({ location, operatingHours }: ShopLocationProps) {
  const shopIsOpen = operatingHours
    ? checkIsOpen(operatingHours.openingTime, operatingHours.closingTime)
    : undefined;

  const openMaps = () => {
    if (location.coordinates) {
      const [lng, lat] = location.coordinates;
      window.open(
        `https://www.google.com/maps/search/?api=1&query=${lat},${lng}`,
        "_blank"
      );
    } else {
      const query = [
        location.shopAddress,
        location.market?.name,
        location.area.name,
        location.state.name,
      ]
        .filter(Boolean)
        .join(", ");
      window.open(
        `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}`,
        "_blank"
      );
    }
  };

  return (
    <Card className="p-6">
      <div className="flex items-center justify-between mb-4">
        <h3 className="font-semibold">Location & Hours</h3>
        {shopIsOpen !== undefined && (
          <Badge variant={shopIsOpen ? "success" : "secondary"}>
            {shopIsOpen ? "Open Now" : "Closed"}
          </Badge>
        )}
      </div>

      <div className="space-y-4">
        {/* Address */}
        <div className="flex gap-3">
          <MapPin className="h-5 w-5 text-muted-foreground flex-shrink-0 mt-0.5" />
          <div>
            {location.shopNumber && (
              <p className="font-medium">{location.shopNumber}</p>
            )}
            {location.shopFloor && (
              <p className="text-sm text-muted-foreground">
                Floor: {location.shopFloor}
                {location.shopBlock && `, Block: ${location.shopBlock}`}
              </p>
            )}
            {location.market && (
              <p className="text-sm">{location.market.name}</p>
            )}
            <p className="text-sm text-muted-foreground">
              {location.area.name}, {location.state.name}
            </p>
            {location.landmark && (
              <p className="text-xs text-muted-foreground mt-1">
                Landmark: {location.landmark}
              </p>
            )}
            {location.shopAddress && (
              <p className="text-sm text-muted-foreground mt-1">
                {location.shopAddress}
              </p>
            )}
          </div>
        </div>

        {/* Get Directions */}
        <Button variant="outline" className="w-full" onClick={openMaps}>
          <Navigation className="mr-2 h-4 w-4" />
          Get Directions
        </Button>

        {/* Operating Hours */}
        {operatingHours && (
          <div className="pt-4 border-t border-border">
            <div className="flex items-center gap-2 mb-3">
              <Clock className="h-4 w-4 text-muted-foreground" />
              <span className="text-sm font-medium">Operating Hours</span>
            </div>

            {operatingHours.is24Hours ? (
              <p className="text-sm">Open 24 hours</p>
            ) : (
              <div className="flex items-center gap-2 text-sm">
                <span>{operatingHours.openingTime}</span>
                <span className="text-muted-foreground">-</span>
                <span>{operatingHours.closingTime}</span>
              </div>
            )}

            {/* Operating Days */}
            {operatingHours.operatingDays && operatingHours.operatingDays.length > 0 && (
              <div className="mt-3">
                <div className="flex items-center gap-2 mb-2">
                  <Calendar className="h-4 w-4 text-muted-foreground" />
                  <span className="text-sm font-medium">Open Days</span>
                </div>
                <div className="flex flex-wrap gap-1">
                  {DAYS_OF_WEEK.map((day) => {
                    const isOpen = operatingHours.operatingDays?.includes(day);
                    return (
                      <Badge
                        key={day}
                        variant={isOpen ? "default" : "outline"}
                        className="text-xs"
                      >
                        {day.slice(0, 3)}
                      </Badge>
                    );
                  })}
                </div>
              </div>
            )}
          </div>
        )}
      </div>
    </Card>
  );
}import * as React from "react";
import Image from "next/image";
import { cn, getInitials } from "@/lib/utils";

interface AvatarProps {
  src?: string | null;
  alt?: string;
  name?: string;
  size?: "sm" | "md" | "lg" | "xl";
  className?: string;
}

const sizeClasses = {
  sm: "h-8 w-8 text-xs",
  md: "h-10 w-10 text-sm",
  lg: "h-12 w-12 text-base",
  xl: "h-16 w-16 text-lg",
};

export function Avatar({ src, alt, name, size = "md", className }: AvatarProps) {
  const [error, setError] = React.useState(false);

  if (src && !error) {
    return (
      <div
        className={cn(
          "relative overflow-hidden rounded-full bg-muted",
          sizeClasses[size],
          className
        )}
      >
        <Image
          src={src}
          alt={alt || name || "Avatar"}
          fill
          className="object-cover"
          onError={() => setError(true)}
        />
      </div>
    );
  }

  return (
    <div
      className={cn(
        "flex items-center justify-center rounded-full bg-primary text-primary-foreground font-medium",
        sizeClasses[size],
        className
      )}
    >
      {name ? getInitials(name) : "?"}
    </div>
  );
}import * as React from "react";
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@/lib/utils";

const badgeVariants = cva(
  "inline-flex items-center rounded-full border px-2.5 py-0.5 text-xs font-medium transition-colors focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
  {
    variants: {
      variant: {
        default: "border-transparent bg-primary text-primary-foreground shadow",
        secondary: "border-transparent bg-secondary text-secondary-foreground",
        destructive: "border-transparent bg-destructive text-destructive-foreground shadow",
        outline: "text-foreground",
        success: "border-transparent bg-emerald-500/10 text-emerald-600 dark:text-emerald-400",
        warning: "border-transparent bg-amber-500/10 text-amber-600 dark:text-amber-400",
      },
    },
    defaultVariants: {
      variant: "default",
    },
  }
);

export interface BadgeProps
  extends React.HTMLAttributes<HTMLDivElement>,
    VariantProps<typeof badgeVariants> {}

function Badge({ className, variant, ...props }: BadgeProps) {
  return <div className={cn(badgeVariants({ variant }), className)} {...props} />;
}

export { Badge, badgeVariants };import * as React from "react";
import { Slot } from "@radix-ui/react-slot"; // Import Slot
import { cva, type VariantProps } from "class-variance-authority";
import { cn } from "@/lib/utils";
import { Spinner } from "./spinner";

const buttonVariants = cva(
  "inline-flex items-center justify-center whitespace-nowrap rounded-lg text-sm font-medium transition-all duration-200 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:pointer-events-none disabled:opacity-50 active:scale-[0.98]",
  {
    variants: {
      variant: {
        default: "bg-primary text-primary-foreground shadow hover:bg-primary/90",
        destructive: "bg-destructive text-destructive-foreground shadow-sm hover:bg-destructive/90",
        outline: "border border-input bg-background shadow-sm hover:bg-accent hover:text-accent-foreground",
        secondary: "bg-secondary text-secondary-foreground shadow-sm hover:bg-secondary/80",
        ghost: "hover:bg-accent hover:text-accent-foreground",
        link: "text-primary underline-offset-4 hover:underline",
      },
      size: {
        default: "h-10 px-4 py-2",
        sm: "h-9 rounded-md px-3 text-xs",
        lg: "h-12 rounded-lg px-8 text-base",
        xl: "h-14 rounded-xl px-10 text-lg",
        icon: "h-10 w-10",
      },
    },
    defaultVariants: {
      variant: "default",
      size: "default",
    },
  }
);

export interface ButtonProps
  extends React.ButtonHTMLAttributes<HTMLButtonElement>,
    VariantProps<typeof buttonVariants> {
  isLoading?: boolean;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
  asChild?: boolean; // Added this property
}

const Button = React.forwardRef<HTMLButtonElement, ButtonProps>(
  ({ className, variant, size, isLoading, leftIcon, rightIcon, children, disabled, asChild = false, ...props }, ref) => {
    // If asChild is true, use Slot, otherwise use button
    const Comp = asChild ? Slot : "button";

    return (
      <Comp
        className={cn(buttonVariants({ variant, size, className }))}
        ref={ref}
        disabled={disabled || isLoading}
        {...props}
      >
        {/* Note: When using asChild, Slot expects a SINGLE child. 
          If you use asChild with Link, you should handle icons inside the Link.
          The logic below handles both standard and asChild scenarios.
        */}
        {asChild ? (
          children
        ) : (
          <>
            {isLoading ? (
              <Spinner className="mr-2 h-4 w-4" />
            ) : leftIcon ? (
              <span className="mr-2">{leftIcon}</span>
            ) : null}
            {children}
            {rightIcon && !isLoading && <span className="ml-2">{rightIcon}</span>}
          </>
        )}
      </Comp>
    );
  }
);
Button.displayName = "Button";

export { Button, buttonVariants };import * as React from "react";
import { cn } from "@/lib/utils";

const Card = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div
      ref={ref}
      className={cn(
        "rounded-xl border border-border bg-card text-card-foreground shadow-sm transition-all duration-300 hover:shadow-md",
        className
      )}
      {...props}
    />
  )
);
Card.displayName = "Card";

const CardHeader = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex flex-col space-y-1.5 p-6", className)} {...props} />
  )
);
CardHeader.displayName = "CardHeader";

const CardTitle = React.forwardRef<HTMLParagraphElement, React.HTMLAttributes<HTMLHeadingElement>>(
  ({ className, ...props }, ref) => (
    <h3
      ref={ref}
      className={cn("text-xl font-semibold leading-none tracking-tight", className)}
      {...props}
    />
  )
);
CardTitle.displayName = "CardTitle";

const CardDescription = React.forwardRef<
  HTMLParagraphElement,
  React.HTMLAttributes<HTMLParagraphElement>
>(({ className, ...props }, ref) => (
  <p ref={ref} className={cn("text-sm text-muted-foreground", className)} {...props} />
));
CardDescription.displayName = "CardDescription";

const CardContent = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("p-6 pt-0", className)} {...props} />
  )
);
CardContent.displayName = "CardContent";

const CardFooter = React.forwardRef<HTMLDivElement, React.HTMLAttributes<HTMLDivElement>>(
  ({ className, ...props }, ref) => (
    <div ref={ref} className={cn("flex items-center p-6 pt-0", className)} {...props} />
  )
);
CardFooter.displayName = "CardFooter";

export { Card, CardHeader, CardFooter, CardTitle, CardDescription, CardContent };export * from './button';
export * from './input';
export * from './card';
export * from './badge';
export * from './avatar';
export * from './modal';
export * from './skeleton';
export * from './spinner';
export * from './select';import * as React from "react";
import { cn } from "@/lib/utils";

export interface InputProps extends React.InputHTMLAttributes<HTMLInputElement> {
  error?: string;
  leftIcon?: React.ReactNode;
  rightIcon?: React.ReactNode;
}

const Input = React.forwardRef<HTMLInputElement, InputProps>(
  ({ className, type, error, leftIcon, rightIcon, ...props }, ref) => {
    return (
      <div className="relative">
        {leftIcon && (
          <div className="absolute left-3 top-1/2 -translate-y-1/2 text-muted-foreground">
            {leftIcon}
          </div>
        )}
        <input
          type={type}
          className={cn(
            "flex h-11 w-full rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background file:border-0 file:bg-transparent file:text-sm file:font-medium placeholder:text-muted-foreground focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-ring focus-visible:ring-offset-2 disabled:cursor-not-allowed disabled:opacity-50 transition-all duration-200",
            leftIcon && "pl-10",
            rightIcon && "pr-10",
            error && "border-destructive focus-visible:ring-destructive",
            className
          )}
          ref={ref}
          {...props}
        />
        {rightIcon && (
          <div className="absolute right-3 top-1/2 -translate-y-1/2 text-muted-foreground">
            {rightIcon}
          </div>
        )}
        {error && <p className="mt-1 text-xs text-destructive">{error}</p>}
      </div>
    );
  }
);
Input.displayName = "Input";

export { Input };"use client";

import * as React from "react";
import { X } from "lucide-react";
import { motion, AnimatePresence } from "framer-motion";
import { cn } from "@/lib/utils";

interface ModalProps {
  isOpen: boolean;
  onClose: () => void;
  title?: string;
  description?: string;
  children: React.ReactNode;
  size?: "sm" | "md" | "lg" | "xl" | "full";
  className?: string;
}

const sizeClasses = {
  sm: "max-w-sm",
  md: "max-w-md",
  lg: "max-w-lg",
  xl: "max-w-xl",
  full: "max-w-4xl",
};

export function Modal({
  isOpen,
  onClose,
  title,
  description,
  children,
  size = "md",
  className,
}: ModalProps) {
  React.useEffect(() => {
    if (isOpen) {
      document.body.style.overflow = "hidden";
    } else {
      document.body.style.overflow = "unset";
    }
    return () => {
      document.body.style.overflow = "unset";
    };
  }, [isOpen]);

  return (
    <AnimatePresence>
      {isOpen && (
        <>
          <motion.div
            initial={{ opacity: 0 }}
            animate={{ opacity: 1 }}
            exit={{ opacity: 0 }}
            onClick={onClose}
            className="fixed inset-0 z-50 bg-black/60 backdrop-blur-sm"
          />
          <div className="fixed inset-0 z-50 flex items-center justify-center p-4">
            <motion.div
              initial={{ opacity: 0, scale: 0.95, y: 20 }}
              animate={{ opacity: 1, scale: 1, y: 0 }}
              exit={{ opacity: 0, scale: 0.95, y: 20 }}
              transition={{ duration: 0.2 }}
              className={cn(
                "relative w-full rounded-2xl bg-background p-6 shadow-2xl",
                sizeClasses[size],
                className
              )}
            >
              <button
                onClick={onClose}
                className="absolute right-4 top-4 rounded-full p-1 text-muted-foreground hover:bg-muted hover:text-foreground transition-colors"
              >
                <X className="h-5 w-5" />
              </button>
              
              {title && (
                <div className="mb-4">
                  <h2 className="text-xl font-semibold">{title}</h2>
                  {description && (
                    <p className="mt-1 text-sm text-muted-foreground">{description}</p>
                  )}
                </div>
              )}
              
              {children}
            </motion.div>
          </div>
        </>
      )}
    </AnimatePresence>
  );
}"use client";

import * as React from "react";
import { ChevronDown, Check } from "lucide-react";
import { cn } from "@/lib/utils";

interface SelectOption {
  value: string;
  label: string;
}

interface SelectProps {
  value?: string;
  onChange: (value: string) => void;
  options: SelectOption[];
  placeholder?: string;
  error?: string;
  className?: string;
  disabled?: boolean;
}

export function Select({
  value,
  onChange,
  options,
  placeholder = "Select...",
  error,
  className,
  disabled = false,
}: SelectProps) {
  const [isOpen, setIsOpen] = React.useState(false);
  const ref = React.useRef<HTMLDivElement>(null);

  const selectedOption = options.find((opt) => opt.value === value);

  // Close dropdown on outside click
  React.useEffect(() => {
    function handleClickOutside(event: MouseEvent) {
      if (ref.current && !ref.current.contains(event.target as Node)) {
        setIsOpen(false);
      }
    }
    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  // Close dropdown when disabled changes to true
  React.useEffect(() => {
    if (disabled) {
      setIsOpen(false);
    }
  }, [disabled]);

  const handleToggle = () => {
    if (disabled) return;
    setIsOpen((prev) => !prev);
  };

  const handleSelect = (optionValue: string) => {
    onChange(optionValue);
    setIsOpen(false);
  };

  return (
    <div ref={ref} className={cn("relative", className)}>
      <button
        type="button"
        onClick={handleToggle}
        disabled={disabled}
        className={cn(
          "flex h-11 w-full items-center justify-between rounded-lg border border-input bg-background px-4 py-2 text-sm ring-offset-background transition-all duration-200",
          "focus:outline-none focus:ring-2 focus:ring-ring focus:ring-offset-2",
          disabled && "cursor-not-allowed opacity-50 bg-muted",
          error && "border-destructive",
          !selectedOption && "text-muted-foreground"
        )}
      >
        <span className="truncate">
          {selectedOption?.label || placeholder}
        </span>
        <ChevronDown
          className={cn(
            "h-4 w-4 shrink-0 transition-transform duration-200",
            isOpen && "rotate-180"
          )}
        />
      </button>

      {isOpen && !disabled && (
        <div className="absolute z-50 mt-1 w-full rounded-lg border border-border bg-background py-1 shadow-lg animate-slide-down">
          <div className="max-h-60 overflow-auto">
            {options.length === 0 ? (
              <div className="px-4 py-3 text-sm text-muted-foreground text-center">
                No options available
              </div>
            ) : (
              options.map((option) => (
                <button
                  key={option.value}
                  type="button"
                  onClick={() => handleSelect(option.value)}
                  className={cn(
                    "flex w-full items-center justify-between px-4 py-2 text-sm transition-colors text-left",
                    "hover:bg-accent",
                    option.value === value && "bg-accent font-medium"
                  )}
                >
                  <span>{option.label}</span>
                  {option.value === value && (
                    <Check className="h-4 w-4 shrink-0" />
                  )}
                </button>
              ))
            )}
          </div>
        </div>
      )}

      {error && <p className="mt-1 text-xs text-destructive">{error}</p>}
    </div>
  );
}import { cn } from "@/lib/utils";

function Skeleton({ className, ...props }: React.HTMLAttributes<HTMLDivElement>) {
  return (
    <div
      className={cn("animate-pulse rounded-lg bg-muted", className)}
      {...props}
    />
  );
}

export { Skeleton };import { cn } from "@/lib/utils";

interface SpinnerProps {
  className?: string;
  size?: "sm" | "md" | "lg";
}

export function Spinner({ className, size = "md" }: SpinnerProps) {
  const sizeClasses = {
    sm: "h-4 w-4",
    md: "h-6 w-6",
    lg: "h-8 w-8",
  };

  return (
    <svg
      className={cn("animate-spin text-current", sizeClasses[size], className)}
      xmlns="http://www.w3.org/2000/svg"
      fill="none"
      viewBox="0 0 24 24"
    >
      <circle
        className="opacity-25"
        cx="12"
        cy="12"
        r="10"
        stroke="currentColor"
        strokeWidth="4"
      />
      <path
        className="opacity-75"
        fill="currentColor"
        d="M4 12a8 8 0 018-8V0C5.373 0 0 5.373 0 12h4zm2 5.291A7.962 7.962 0 014 12H0c0 3.042 1.135 5.824 3 7.938l3-2.647z"
      />
    </svg>
  );
}export const mainNav = [
  { title: "Home", href: "/" },
  { title: "Categories", href: "/categories" },
  { title: "Shops", href: "/shops" },
  { title: "Compare", href: "/compare" },
];

export const vendorNav = [
  { title: "Dashboard", href: "/vendor/dashboard" },
  { title: "Products", href: "/vendor/products" },
  { title: "Settings", href: "/vendor/settings" },
];export const siteConfig = {
  name: "SureShops",
  description: "Find products, compare prices from local shops across Nigeria",
  url: process.env.NEXT_PUBLIC_APP_URL || "http://localhost:3000",
  ogImage: "/og-image.jpg",
  links: {
    twitter: "https://twitter.com/sureshops",
    instagram: "https://instagram.com/sureshops",
  },
};export * from './use-auth';
export * from './use-debounce';
export * from './use-location';
export * from './use-search';
export * from './use-products';
export * from './use-shops';
export * from './use-media-query';
export * from './use-favorites';
export * from './use-upload';"use client";

import { useEffect } from "react";
import { useRouter } from "next/navigation";
import { useAuthStore } from "@/store";
import { authService } from "@/services";
import { auth } from "@/lib/auth";

export function useAuth(requireAuth: boolean = false) {
  const router = useRouter();
  const { user, isAuthenticated, isLoading, setUser, setLoading, logout } = useAuthStore();

  useEffect(() => {
    const initAuth = async () => {
      const token = auth.getToken();
      if (token) {
        try {
          const userData = await authService.getMe();
          setUser(userData);
        } catch (error) {
          auth.removeToken();
          auth.removeUser();
          setUser(null);
        }
      } else {
        setUser(null);
      }
    };

    initAuth();
  }, [setUser]);

  useEffect(() => {
    if (!isLoading && requireAuth && !isAuthenticated) {
      router.push("/login");
    }
  }, [isLoading, requireAuth, isAuthenticated, router]);

  return {
    user,
    isAuthenticated,
    isLoading,
    logout,
    isVendor: user?.role === "vendor" || user?.role === "admin" || user?.role === "super_admin",
    isAdmin: user?.role === "admin" || user?.role === "super_admin",
    isSuperAdmin: user?.role === "super_admin",
  };
}"use client";

import { useState, useEffect } from "react";

export function useDebounce<T>(value: T, delay: number = 500): T {
  const [debouncedValue, setDebouncedValue] = useState<T>(value);

  useEffect(() => {
    const timer = setTimeout(() => {
      setDebouncedValue(value);
    }, delay);

    return () => {
      clearTimeout(timer);
    };
  }, [value, delay]);

  return debouncedValue;
}"use client";

import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { favoritesService } from "@/services";
import { FavoriteType } from "@/types/favorites";
import toast from "react-hot-toast";

export function useFavorites(type?: FavoriteType) {
  return useQuery({
    queryKey: ["favorites", type],
    queryFn: () => favoritesService.getAll(type),
  });
}

export function useFavoriteProducts() {
  return useQuery({
    queryKey: ["favorites", "products"],
    queryFn: () => favoritesService.getProducts(),
  });
}

export function useFavoriteVendors() {
  return useQuery({
    queryKey: ["favorites", "vendors"],
    queryFn: () => favoritesService.getVendors(),
  });
}

export function useFavoriteCount() {
  return useQuery({
    queryKey: ["favorites", "count"],
    queryFn: () => favoritesService.getCount(),
  });
}

export function useToggleFavorite() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ type, itemId }: { type: FavoriteType; itemId: string }) =>
      favoritesService.toggle(type, itemId),
    onSuccess: (data, { type }) => {
      queryClient.invalidateQueries({ queryKey: ["favorites"] });
      toast.success(data.isFavorite ? "Added to favorites" : "Removed from favorites");
    },
    onError: () => {
      toast.error("Failed to update favorites");
    },
  });
}

export function useIsFavorite(type: FavoriteType, itemId: string) {
  return useQuery({
    queryKey: ["favorite", type, itemId],
    queryFn: () => favoritesService.isFavorite(type, itemId),
    enabled: !!itemId,
  });
}"use client";

import { useState, useEffect, useCallback, useRef } from "react";
import { locationService } from "@/services";
import { State, Area, Market } from "@/types";

interface UseLocationSelectOptions {
  initialStateId?: string;
  initialAreaId?: string;
  initialMarketId?: string;
  includeMarkets?: boolean;
}

interface UseLocationSelectReturn {
  states: State[];
  areas: Area[];
  markets: Market[];
  selectedStateId: string;
  selectedAreaId: string;
  selectedMarketId: string;
  loadingStates: boolean;
  loadingAreas: boolean;
  loadingMarkets: boolean;
  handleStateChange: (stateId: string) => void;
  handleAreaChange: (areaId: string) => void;
  handleMarketChange: (marketId: string) => void;
  reset: () => void;
}

export function useLocationSelect(
  options: UseLocationSelectOptions = {}
): UseLocationSelectReturn {
  const {
    initialStateId = "",
    initialAreaId = "",
    initialMarketId = "",
    includeMarkets = true,
  } = options;

  const [states, setStates] = useState<State[]>([]);
  const [areas, setAreas] = useState<Area[]>([]);
  const [markets, setMarkets] = useState<Market[]>([]);

  const [selectedStateId, setSelectedStateId] = useState(initialStateId);
  const [selectedAreaId, setSelectedAreaId] = useState(initialAreaId);
  const [selectedMarketId, setSelectedMarketId] = useState(initialMarketId);

  const [loadingStates, setLoadingStates] = useState(false);
  const [loadingAreas, setLoadingAreas] = useState(false);
  const [loadingMarkets, setLoadingMarkets] = useState(false);

  // Track whether user triggered the change vs initial load
  const userChangedState = useRef(false);
  const userChangedArea = useRef(false);

  // 1. Fetch states on mount
  useEffect(() => {
    let cancelled = false;

    const fetchStates = async () => {
      setLoadingStates(true);
      try {
        const data = await locationService.getStates();
        if (!cancelled) {
          setStates(data);
          // If we have an initial state, make sure it's set
          if (initialStateId) {
            setSelectedStateId(initialStateId);
          }
        }
      } catch (error) {
        console.error("Failed to fetch states:", error);
      } finally {
        if (!cancelled) setLoadingStates(false);
      }
    };

    fetchStates();

    return () => {
      cancelled = true;
    };
  }, []); // Only run once on mount

  // 2. Fetch areas when selectedStateId changes
  useEffect(() => {
    let cancelled = false;

    if (!selectedStateId) {
      setAreas([]);
      setMarkets([]);
      setSelectedAreaId("");
      setSelectedMarketId("");
      return;
    }

    const fetchAreas = async () => {
      setLoadingAreas(true);

      // Only clear selections if USER changed the state (not initial load)
      if (userChangedState.current) {
        setSelectedAreaId("");
        setSelectedMarketId("");
        setMarkets([]);
        userChangedState.current = false;
      }

      try {
        const data = await locationService.getAreasByState(selectedStateId);
        if (!cancelled) {
          setAreas(data);

          // If we have an initial area and it exists in the fetched data, select it
          if (initialAreaId && !userChangedState.current) {
            const areaExists = data.find((a) => a.id === initialAreaId);
            if (areaExists) {
              setSelectedAreaId(initialAreaId);
            }
          }
        }
      } catch (error) {
        console.error("Failed to fetch areas:", error);
        if (!cancelled) {
          setAreas([]);
        }
      } finally {
        if (!cancelled) setLoadingAreas(false);
      }
    };

    fetchAreas();

    return () => {
      cancelled = true;
    };
  }, [selectedStateId]); // Only depend on selectedStateId

  // 3. Fetch markets when selectedAreaId changes
  useEffect(() => {
    let cancelled = false;

    if (!selectedAreaId || !includeMarkets) {
      setMarkets([]);
      if (userChangedArea.current) {
        setSelectedMarketId("");
        userChangedArea.current = false;
      }
      return;
    }

    const fetchMarkets = async () => {
      setLoadingMarkets(true);

      if (userChangedArea.current) {
        setSelectedMarketId("");
        userChangedArea.current = false;
      }

      try {
        const data = await locationService.getMarketsByArea(selectedAreaId);
        if (!cancelled) {
          setMarkets(data);

          // If we have an initial market and it exists, select it
          if (initialMarketId && !userChangedArea.current) {
            const marketExists = data.find((m) => m.id === initialMarketId);
            if (marketExists) {
              setSelectedMarketId(initialMarketId);
            }
          }
        }
      } catch (error) {
        console.error("Failed to fetch markets:", error);
        if (!cancelled) setMarkets([]);
      } finally {
        if (!cancelled) setLoadingMarkets(false);
      }
    };

    fetchMarkets();

    return () => {
      cancelled = true;
    };
  }, [selectedAreaId, includeMarkets]); // Only depend on selectedAreaId

  const handleStateChange = useCallback((stateId: string) => {
    userChangedState.current = true;
    setSelectedStateId(stateId);
  }, []);

  const handleAreaChange = useCallback((areaId: string) => {
    userChangedArea.current = true;
    setSelectedAreaId(areaId);
  }, []);

  const handleMarketChange = useCallback((marketId: string) => {
    setSelectedMarketId(marketId);
  }, []);

  const reset = useCallback(() => {
    userChangedState.current = true;
    setSelectedStateId("");
    setSelectedAreaId("");
    setSelectedMarketId("");
    setAreas([]);
    setMarkets([]);
  }, []);

  return {
    states,
    areas,
    markets,
    selectedStateId,
    selectedAreaId,
    selectedMarketId,
    loadingStates,
    loadingAreas,
    loadingMarkets,
    handleStateChange,
    handleAreaChange,
    handleMarketChange,
    reset,
  };
}"use client";

import { useState, useEffect, useCallback } from "react";
import { useFilterStore } from "@/store";
import { locationService } from "@/services";

export function useLocation() {
  const {
    selectedState,
    selectedArea,
    selectedMarket,
    states,
    areas,
    markets,
    setSelectedState,
    setSelectedArea,
    setSelectedMarket,
    setStates,
    setAreas,
    setMarkets,
    clearLocationFilters,
  } = useFilterStore();

  const [loading, setLoading] = useState(false);

  // Fetch states on mount
  useEffect(() => {
    const fetchStates = async () => {
      try {
        setLoading(true);
        const data = await locationService.getStates();
        setStates(data);
      } catch (error) {
        console.error("Failed to fetch states:", error);
      } finally {
        setLoading(false);
      }
    };

    if (states.length === 0) {
      fetchStates();
    }
  }, [states.length, setStates]);

  // Fetch areas when state changes
  useEffect(() => {
    const fetchAreas = async () => {
      if (!selectedState) {
        setAreas([]);
        return;
      }

      try {
        setLoading(true);
        const data = await locationService.getAreasByState(selectedState.id);
        setAreas(data);
      } catch (error) {
        console.error("Failed to fetch areas:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchAreas();
  }, [selectedState, setAreas]);

  // Fetch markets when area changes
  useEffect(() => {
    const fetchMarkets = async () => {
      if (!selectedArea) {
        setMarkets([]);
        return;
      }

      try {
        setLoading(true);
        const data = await locationService.getMarketsByArea(selectedArea.id);
        setMarkets(data);
      } catch (error) {
        console.error("Failed to fetch markets:", error);
      } finally {
        setLoading(false);
      }
    };

    fetchMarkets();
  }, [selectedArea, setMarkets]);

  const getLocationString = useCallback(() => {
    const parts = [];
    if (selectedMarket) parts.push(selectedMarket.name);
    if (selectedArea) parts.push(selectedArea.name);
    if (selectedState) parts.push(selectedState.name);
    return parts.join(", ");
  }, [selectedState, selectedArea, selectedMarket]);

  return {
    states,
    areas,
    markets,
    selectedState,
    selectedArea,
    selectedMarket,
    loading,
    setSelectedState,
    setSelectedArea,
    setSelectedMarket,
    clearLocationFilters,
    getLocationString,
    locationFilters: {
      stateId: selectedState?.id,
      areaId: selectedArea?.id,
      marketId: selectedMarket?.id,
    },
  };
}"use client";

import { useState, useEffect } from "react";

export function useMediaQuery(query: string): boolean {
  const [matches, setMatches] = useState(false);

  useEffect(() => {
    const media = window.matchMedia(query);
    if (media.matches !== matches) {
      setMatches(media.matches);
    }

    const listener = () => setMatches(media.matches);
    media.addEventListener("change", listener);

    return () => media.removeEventListener("change", listener);
  }, [matches, query]);

  return matches;
}

export function useIsMobile() {
  return useMediaQuery("(max-width: 768px)");
}

export function useIsTablet() {
  return useMediaQuery("(min-width: 769px) and (max-width: 1024px)");
}

export function useIsDesktop() {
  return useMediaQuery("(min-width: 1025px)");
}"use client";

import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { productService } from "@/services";
import { ProductFilters, Product } from "@/types";
import toast from "react-hot-toast";

export function useProducts(filters?: ProductFilters) {
  return useQuery({
    queryKey: ["products", filters],
    queryFn: () => productService.getAll(filters),
    staleTime: 60000,
  });
}

export function useProduct(id: string) {
  return useQuery({
    queryKey: ["product", id],
    queryFn: () => productService.getById(id),
    enabled: !!id,
  });
}

export function useMyProducts() {
  return useQuery({
    queryKey: ["my-products"],
    queryFn: () => productService.getMyProducts(),
  });
}

export function useCreateProduct() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: Partial<Product>) => productService.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["my-products"] });
      toast.success("Product created successfully");
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || "Failed to create product");
    },
  });
}

export function useUpdateProduct() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: Partial<Product> }) =>
      productService.update(id, data),
    onSuccess: (_, { id }) => {
      queryClient.invalidateQueries({ queryKey: ["product", id] });
      queryClient.invalidateQueries({ queryKey: ["my-products"] });
      toast.success("Product updated successfully");
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || "Failed to update product");
    },
  });
}

export function useDeleteProduct() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (id: string) => productService.delete(id),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["my-products"] });
      toast.success("Product deleted successfully");
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || "Failed to delete product");
    },
  });
}"use client";

import { useState, useCallback } from "react";
import { useQuery } from "@tanstack/react-query";
import { useSearchStore } from "@/store";
import { searchService } from "@/services";
import { SearchFilters, SearchResults } from "@/types";
import { useDebounce } from "./use-debounce";

export function useSearch() {
  const { query, filters, setQuery, setFilters, updateFilter, clearFilters, addRecentSearch } = useSearchStore();
  const debouncedQuery = useDebounce(query, 300);

  const searchFilters: SearchFilters = {
    query: debouncedQuery,
    ...filters,
  };

  const { data, isLoading, error, refetch } = useQuery({
    queryKey: ["search", searchFilters],
    queryFn: () => searchService.search(searchFilters),
    enabled: debouncedQuery.length > 0 || Object.keys(filters).length > 0,
    staleTime: 30000,
  });

  const handleSearch = useCallback(
    (newQuery: string) => {
      setQuery(newQuery);
      if (newQuery.trim()) {
        addRecentSearch(newQuery.trim());
      }
    },
    [setQuery, addRecentSearch]
  );

  return {
    query,
    filters,
    results: data,
    isLoading,
    error,
    setQuery: handleSearch,
    setFilters,
    updateFilter,
    clearFilters,
    refetch,
  };
}"use client";

import { useQuery, useMutation, useQueryClient } from "@tanstack/react-query";
import { vendorService, searchService } from "@/services";
import { Vendor } from "@/types";
import toast from "react-hot-toast";

export function useShops(filters?: any) {
  return useQuery({
    queryKey: ["shops", filters],
    queryFn: () => vendorService.getAll(filters),
    staleTime: 60000,
  });
}

export function useShop(id: string) {
  return useQuery({
    queryKey: ["shop", id],
    queryFn: () => vendorService.getById(id),
    enabled: !!id,
  });
}

export function useShopProducts(vendorId: string, filters?: any) {
  return useQuery({
    queryKey: ["shop-products", vendorId, filters],
    queryFn: () => searchService.getShopProducts(vendorId, filters),
    enabled: !!vendorId,
  });
}

export function useMyShop() {
  return useQuery({
    queryKey: ["my-shop"],
    queryFn: () => vendorService.getMyProfile(),
  });
}

export function useCreateVendor() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: (data: Partial<Vendor>) => vendorService.create(data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["my-shop"] });
      toast.success("Shop created successfully");
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || "Failed to create shop");
    },
  });
}

export function useUpdateVendor() {
  const queryClient = useQueryClient();

  return useMutation({
    mutationFn: ({ id, data }: { id: string; data: Partial<Vendor> }) =>
      vendorService.update(id, data),
    onSuccess: () => {
      queryClient.invalidateQueries({ queryKey: ["my-shop"] });
      toast.success("Shop updated successfully");
    },
    onError: (error: any) => {
      toast.error(error.response?.data?.message || "Failed to update shop");
    },
  });
}"use client";

import { useState, useCallback } from "react";
import { uploadService, UploadResponse } from "../services/upload.service";
import toast from "react-hot-toast";

interface UseUploadOptions {
  maxFiles?: number;
  maxSizeMB?: number;
  onSuccess?: (response: UploadResponse) => void;
  onError?: (error: Error) => void;
}

export function useUpload(options: UseUploadOptions = {}) {
  const { maxFiles = 10, maxSizeMB = 10, onSuccess, onError } = options;
  const [uploading, setUploading] = useState(false);
  const [progress, setProgress] = useState(0);

  const validateFile = useCallback(
    (file: File): string | null => {
      const allowedTypes = [
        "image/jpeg",
        "image/jpg",
        "image/png",
        "image/gif",
        "image/webp",
      ];

      if (!allowedTypes.includes(file.type)) {
        return "Only JPG, PNG, GIF, and WebP images are allowed";
      }

      if (file.size > maxSizeMB * 1024 * 1024) {
        return `File size must be less than ${maxSizeMB}MB`;
      }

      return null;
    },
    [maxSizeMB]
  );

  const uploadProductImage = useCallback(
    async (file: File): Promise<UploadResponse | null> => {
      const error = validateFile(file);
      if (error) {
        toast.error(error);
        onError?.(new Error(error));
        return null;
      }

      setUploading(true);
      setProgress(0);

      try {
        // Simulate progress since fetch doesn't support it natively
        const progressInterval = setInterval(() => {
          setProgress((prev) => Math.min(prev + 10, 90));
        }, 200);

        const response = await uploadService.uploadProductImage(file);

        clearInterval(progressInterval);
        setProgress(100);

        onSuccess?.(response);
        return response;
      } catch (err: any) {
        const errorMsg = err.message || "Failed to upload image";
        toast.error(errorMsg);
        onError?.(err);
        return null;
      } finally {
        setUploading(false);
        setTimeout(() => setProgress(0), 500);
      }
    },
    [validateFile, onSuccess, onError]
  );

  const uploadMultipleProductImages = useCallback(
    async (files: File[]): Promise<UploadResponse[]> => {
      if (files.length > maxFiles) {
        toast.error(`Maximum ${maxFiles} files allowed`);
        return [];
      }

      // Validate all files first
      for (const file of files) {
        const error = validateFile(file);
        if (error) {
          toast.error(`${file.name}: ${error}`);
          return [];
        }
      }

      setUploading(true);
      setProgress(0);

      try {
        const results: UploadResponse[] = [];
        for (let i = 0; i < files.length; i++) {
          const response = await uploadService.uploadProductImage(files[i]);
          results.push(response);
          setProgress(Math.round(((i + 1) / files.length) * 100));
        }

        return results;
      } catch (err: any) {
        toast.error(err.message || "Failed to upload images");
        onError?.(err);
        return [];
      } finally {
        setUploading(false);
        setTimeout(() => setProgress(0), 500);
      }
    },
    [maxFiles, validateFile, onError]
  );

  const deleteImage = useCallback(async (publicId: string): Promise<boolean> => {
    try {
      await uploadService.deleteImage(publicId);
      return true;
    } catch (err: any) {
      toast.error("Failed to delete image");
      return false;
    }
  }, []);

  return {
    uploading,
    progress,
    uploadProductImage,
    uploadMultipleProductImages,
    deleteImage,
    validateFile,
  };
}import axios, { AxiosError, AxiosInstance, AxiosRequestConfig } from "axios";
import Cookies from "js-cookie";
import { ApiError } from "@/types";

const API_URL = process.env.NEXT_PUBLIC_API_URL || "http://localhost:4000";

/**
 * Recursively transform MongoDB _id fields to id throughout the response.
 * Handles nested objects, arrays, and ObjectId string values.
 */
function transformIds(data: any): any {
  if (data === null || data === undefined) return data;

  if (Array.isArray(data)) {
    return data.map(transformIds);
  }

  if (typeof data === "object" && !(data instanceof Date)) {
    const transformed: Record<string, any> = {};
    for (const [key, value] of Object.entries(data)) {
      if (key === "_id") {
        // Map _id to id, keep the value as string
        transformed["id"] = typeof value === "object" && value !== null
          ? String(value)
          : value;
      } else if (key === "__v") {
        // Skip mongoose version key
        continue;
      } else {
        transformed[key] = transformIds(value);
      }
    }
    return transformed;
  }

  return data;
}

class ApiClient {
  private client: AxiosInstance;

  constructor() {
    this.client = axios.create({
      baseURL: `${API_URL}/api/v1`,
      headers: {
        "Content-Type": "application/json",
      },
      timeout: 30000,
    });

    // Request interceptor â€” attach JWT token
    this.client.interceptors.request.use(
      (config) => {
        const token = Cookies.get("access_token");
        if (token) {
          config.headers.Authorization = `Bearer ${token}`;
        }
        return config;
      },
      (error) => Promise.reject(error)
    );

    // Response interceptor â€” transform _id â†’ id, handle 401
    this.client.interceptors.response.use(
      (response) => {
        if (response.data) {
          response.data = transformIds(response.data);
        }
        return response;
      },
      (error: AxiosError<ApiError>) => {
        if (error.response?.status === 401) {
          Cookies.remove("access_token");
          if (typeof window !== "undefined") {
            window.location.href = "/login";
          }
        }
        return Promise.reject(error);
      }
    );
  }

  /**
   * Extract data from response.
   * Handles both wrapped { data: T } and direct T responses.
   */
  private extractData<T>(responseData: any): T {
    if (
      responseData &&
      typeof responseData === "object" &&
      "data" in responseData &&
      !Array.isArray(responseData)
    ) {
      return responseData.data as T;
    }
    return responseData as T;
  }

  async get<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.get(url, config);
    return this.extractData<T>(response.data);
  }

  async post<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.post(url, data, config);
    return this.extractData<T>(response.data);
  }

  async put<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.put(url, data, config);
    return this.extractData<T>(response.data);
  }

  async patch<T>(url: string, data?: any, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.patch(url, data, config);
    return this.extractData<T>(response.data);
  }

  async delete<T>(url: string, config?: AxiosRequestConfig): Promise<T> {
    const response = await this.client.delete(url, config);
    return this.extractData<T>(response.data);
  }

  async uploadFile(url: string, file: File, fieldName: string = "file"): Promise<any> {
    const formData = new FormData();
    formData.append(fieldName, file);

    const response = await this.client.post(url, formData, {
      headers: {
        "Content-Type": "multipart/form-data",
      },
    });
    return this.extractData(response.data);
  }
}

export const api = new ApiClient();import Cookies from "js-cookie";
import { User } from "@/types";

const TOKEN_KEY = "access_token";
const USER_KEY = "user";

export const auth = {
  setToken(token: string): void {
    Cookies.set(TOKEN_KEY, token, { expires: 7 });
  },

  getToken(): string | undefined {
    return Cookies.get(TOKEN_KEY);
  },

  removeToken(): void {
    Cookies.remove(TOKEN_KEY);
  },

  setUser(user: User): void {
    if (typeof window !== "undefined") {
      localStorage.setItem(USER_KEY, JSON.stringify(user));
    }
  },

  getUser(): User | null {
    if (typeof window !== "undefined") {
      const user = localStorage.getItem(USER_KEY);
      return user ? JSON.parse(user) : null;
    }
    return null;
  },

  removeUser(): void {
    if (typeof window !== "undefined") {
      localStorage.removeItem(USER_KEY);
    }
  },

  isAuthenticated(): boolean {
    return !!this.getToken();
  },

  logout(): void {
    this.removeToken();
    this.removeUser();
    if (typeof window !== "undefined") {
      window.location.href = "/login";
    }
  },
};export const CATEGORIES = [
  { name: "Electronics", slug: "electronics", icon: "ðŸ“±" },
  { name: "Fashion", slug: "fashion", icon: "ðŸ‘—" },
  { name: "Home & Garden", slug: "home-garden", icon: "ðŸ " },
  { name: "Health & Beauty", slug: "health-beauty", icon: "ðŸ’„" },
  { name: "Sports & Outdoors", slug: "sports-outdoors", icon: "âš½" },
  { name: "Automotive", slug: "automotive", icon: "ðŸš—" },
  { name: "Books & Media", slug: "books-media", icon: "ðŸ“š" },
  { name: "Food & Groceries", slug: "food-groceries", icon: "ðŸŽ" },
  { name: "Baby & Kids", slug: "baby-kids", icon: "ðŸ‘¶" },
  { name: "Office & Stationery", slug: "office-stationery", icon: "ðŸ“Ž" },
];

export const VENDOR_TYPES = [
  { value: "market_shop", label: "Market Shop" },
  { value: "mall_shop", label: "Mall Shop" },
  { value: "home_based", label: "Home Based" },
  { value: "street_shop", label: "Street Shop" },
  { value: "online_only", label: "Online Only" },
];

export const SORT_OPTIONS = [
  { value: "relevance", label: "Most Relevant" },
  { value: "price_low", label: "Price: Low to High" },
  { value: "price_high", label: "Price: High to Low" },
  { value: "newest", label: "Newest First" },
  { value: "rating", label: "Highest Rated" },
  { value: "popularity", label: "Most Popular" },
];

export const DAYS_OF_WEEK = [
  "Monday",
  "Tuesday",
  "Wednesday",
  "Thursday",
  "Friday",
  "Saturday",
  "Sunday",
];

export const NIGERIAN_BANKS = [
  "Access Bank",
  "Citibank",
  "Ecobank",
  "Fidelity Bank",
  "First Bank of Nigeria",
  "First City Monument Bank (FCMB)",
  "Guaranty Trust Bank (GTBank)",
  "Heritage Bank",
  "Keystone Bank",
  "Polaris Bank",
  "Providus Bank",
  "Stanbic IBTC Bank",
  "Standard Chartered Bank",
  "Sterling Bank",
  "Union Bank",
  "United Bank for Africa (UBA)",
  "Unity Bank",
  "Wema Bank",
  "Zenith Bank",
];export interface OperatingHours {
  openingTime?: string;
  closingTime?: string;
  operatingDays?: string[];
  is24Hours?: boolean;
}

export interface ContactDetails {
  phone: string;
  whatsapp?: string;
  email?: string;
  website?: string;
  instagram?: string;
  facebook?: string;
  twitter?: string;
  alternatePhone?: string;
}

export interface BankDetails {
  bankName?: string;
  accountName?: string;
  accountNumber?: string;
  bankCode?: string;
}

export interface VendorFormData {
  businessName: string;
  vendorType: string;
  businessDescription?: string;
  stateId: string;
  areaId: string;
  marketId?: string;
  shopNumber?: string;
  shopFloor?: string;
  shopBlock?: string;
  shopAddress?: string;
  landmark?: string;
  contactDetails: ContactDetails;
  bankDetails?: BankDetails;
  operatingHours?: OperatingHours;
  categories?: string[];
  tags?: string[];
}import { type ClassValue, clsx } from "clsx";
import { twMerge } from "tailwind-merge";

export function cn(...inputs: ClassValue[]) {
  return twMerge(clsx(inputs));
}

export function formatPrice(price: number, currency: string = "NGN"): string {
  return new Intl.NumberFormat("en-NG", {
    style: "currency",
    currency: currency,
    minimumFractionDigits: 0,
    maximumFractionDigits: 0,
  }).format(price);
}

export function formatNumber(num: number): string {
  if (num >= 1000000) {
    return (num / 1000000).toFixed(1) + "M";
  }
  if (num >= 1000) {
    return (num / 1000).toFixed(1) + "K";
  }
  return num.toString();
}

export function getInitials(name: string): string {
  return name
    .split(" ")
    .map((n) => n[0])
    .join("")
    .toUpperCase()
    .slice(0, 2);
}

export function truncate(str: string, length: number): string {
  if (str.length <= length) return str;
  return str.slice(0, length) + "...";
}

export function getDiscountPercentage(original: number, current: number): number {
  if (!original || original <= current) return 0;
  return Math.round(((original - current) / original) * 100);
}

export function slugify(text: string): string {
  return text
    .toLowerCase()
    .replace(/[^\w ]+/g, "")
    .replace(/ +/g, "-");
}

export function formatDistance(km: number): string {
  if (km < 1) {
    return `${Math.round(km * 1000)}m`;
  }
  return `${km.toFixed(1)}km`;
}

export function isOpen(openingTime?: string, closingTime?: string): boolean {
  if (!openingTime || !closingTime) return true;
  
  const now = new Date();
  const currentTime = now.getHours() * 60 + now.getMinutes();
  
  const [openHour, openMin] = openingTime.split(":").map(Number);
  const [closeHour, closeMin] = closingTime.split(":").map(Number);
  
  const openMinutes = openHour * 60 + openMin;
  const closeMinutes = closeHour * 60 + closeMin;
  
  return currentTime >= openMinutes && currentTime <= closeMinutes;
}

export function getTimeAgo(date: string): string {
  const now = new Date();
  const past = new Date(date);
  const diffInSeconds = Math.floor((now.getTime() - past.getTime()) / 1000);
  
  if (diffInSeconds < 60) return "Just now";
  if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
  if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
  if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
  
  return past.toLocaleDateString();
}import { z } from "zod";

export const loginSchema = z.object({
  email: z.string().email("Invalid email address"),
  password: z.string().min(6, "Password must be at least 6 characters"),
});

export const registerSchema = z.object({
  firstName: z.string().min(2, "First name must be at least 2 characters"),
  lastName: z.string().min(2, "Last name must be at least 2 characters"),
  email: z.string().email("Invalid email address"),
  password: z.string().min(6, "Password must be at least 6 characters"),
  phone: z.string().min(10, "Invalid phone number"),
});

// âœ… No transforms â€” use valueAsNumber in register() instead
// This keeps z.infer input === output, so zodResolver works with useForm
export const productSchema = z.object({
  name: z.string().min(2, "Product name is required"),
  description: z.string().optional(),
  type: z.enum(["sale", "lease", "rent", "service"]),
  price: z.number().min(0, "Price must be positive"),
  originalPrice: z.number().optional(),
  category: z.string().min(1, "Category is required"),
  subcategory: z.string().optional(),
  brand: z.string().optional(),
  sku: z.string().optional(),
  barcode: z.string().optional(),
  quantity: z.number().min(0, "Quantity must be 0 or more"),
  unit: z.string().optional(),
  inStock: z.boolean(),
  images: z.array(z.string()),
  tags: z.array(z.string()),
  specifications: z.record(z.string(), z.any()).optional(),
});

export const vendorSchema = z.object({
  businessName: z.string().min(2, "Business name is required"),
  businessDescription: z.string().optional(),
  vendorType: z.enum([
    "market_shop",
    "mall_shop",
    "home_based",
    "street_shop",
    "online_only",
  ]),
  stateId: z.string().min(1, "State is required"),
  areaId: z.string().min(1, "Area is required"),
  marketId: z.string().optional(),
  shopNumber: z.string().optional(),
  shopFloor: z.string().optional(),
  shopBlock: z.string().optional(),
  shopAddress: z.string().optional(),
  landmark: z.string().optional(),
  contactDetails: z.object({
    phone: z.string().min(10, "Phone is required"),
    alternatePhone: z.string().optional(),
    whatsapp: z.string().optional(),
    email: z.string().email("Invalid email").optional().or(z.literal("")),
    instagram: z.string().optional(),
    facebook: z.string().optional(),
    twitter: z.string().optional(),
    website: z.string().optional(),
  }),
  bankDetails: z
    .object({
      bankName: z.string().optional(),
      accountName: z.string().optional(),
      accountNumber: z.string().optional(),
      bankCode: z.string().optional(),
    })
    .optional(),
  operatingHours: z
    .object({
      openingTime: z.string().optional(),
      closingTime: z.string().optional(),
      operatingDays: z.array(z.string()).optional(),
    })
    .optional(),
  categories: z.array(z.string()).optional(),
  tags: z.array(z.string()).optional(),
});

export type LoginInput = z.infer<typeof loginSchema>;
export type RegisterInput = z.infer<typeof registerSchema>;
export type ProductInput = z.infer<typeof productSchema>;
export type VendorInput = z.infer<typeof vendorSchema>;import { api } from '@/lib/api';
import { User, Vendor, Product, PaginatedResponse } from '@/types';
import { DashboardStats, RecentActivity, AdminFilters } from '@/types/admin';

export const adminService = {
  // Dashboard
  async getDashboardStats(): Promise<DashboardStats> {
    return api.get<DashboardStats>('/admin/dashboard/stats');
  },

  async getRecentActivity(limit?: number): Promise<RecentActivity[]> {
    return api.get<RecentActivity[]>(`/admin/dashboard/activity?limit=${limit || 20}`);
  },

  // Users
  async getUsers(filters?: AdminFilters): Promise<PaginatedResponse<User>> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined) params.append(key, String(value));
      });
    }
    const response = await api.get<any>(`/admin/users?${params.toString()}`);
    return {
      items: response.users || [],
      total: response.total || 0,
      page: response.page || 1,
      totalPages: response.totalPages || 1,
    };
  },

  async getUser(id: string): Promise<User> {
    return api.get<User>(`/admin/users/${id}`);
  },

  async updateUser(id: string, data: Partial<User>): Promise<User> {
    return api.put<User>(`/admin/users/${id}`, data);
  },

  async deleteUser(id: string): Promise<void> {
    return api.delete(`/admin/users/${id}`);
  },

  async changeUserRole(id: string, role: string): Promise<User> {
    return api.put<User>(`/admin/users/${id}/role`, { role });
  },

  // Vendors
  async getVendors(filters?: AdminFilters): Promise<PaginatedResponse<Vendor>> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined) params.append(key, String(value));
      });
    }
    const response = await api.get<any>(`/admin/vendors?${params.toString()}`);
    return {
      items: response.vendors || [],
      total: response.total || 0,
      page: response.page || 1,
      totalPages: response.totalPages || 1,
    };
  },

  async getPendingVendors(): Promise<Vendor[]> {
    return api.get<Vendor[]>('/admin/vendors/pending');
  },

  async getVendor(id: string): Promise<Vendor> {
    return api.get<Vendor>(`/admin/vendors/${id}`);
  },

  async updateVendor(id: string, data: Partial<Vendor>): Promise<Vendor> {
    return api.put<Vendor>(`/admin/vendors/${id}`, data);
  },

  async vendorAction(id: string, action: string, reason?: string): Promise<Vendor> {
    return api.post<Vendor>(`/admin/vendors/${id}/action`, { action, reason });
  },

  // Products
  async getProducts(filters?: AdminFilters): Promise<PaginatedResponse<Product>> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined) params.append(key, String(value));
      });
    }
    const response = await api.get<any>(`/admin/products?${params.toString()}`);
    return {
      items: response.products || [],
      total: response.total || 0,
      page: response.page || 1,
      totalPages: response.totalPages || 1,
    };
  },

  async getPendingProducts(): Promise<Product[]> {
    return api.get<Product[]>('/admin/products/pending');
  },

  async getProduct(id: string): Promise<Product> {
    return api.get<Product>(`/admin/products/${id}`);
  },

  async updateProduct(id: string, data: Partial<Product>): Promise<Product> {
    return api.put<Product>(`/admin/products/${id}`, data);
  },

  async productAction(id: string, action: string, reason?: string): Promise<Product> {
    return api.post<Product>(`/admin/products/${id}/action`, { action, reason });
  },

  async bulkApproveProducts(ids: string[]): Promise<number> {
    return api.post<number>('/admin/products/bulk-approve', { ids });
  },

  async bulkRejectProducts(ids: string[], reason?: string): Promise<number> {
    return api.post<number>('/admin/products/bulk-reject', { ids, reason });
  },

  // Seed
  async seedAdmins(): Promise<void> {
    return api.post('/admin/seed/admins');
  },
};import { api } from "@/lib/api";
import { auth } from "@/lib/auth";
import { AuthResponse, LoginCredentials, RegisterCredentials, User } from "@/types";

export const authService = {
  async login(credentials: LoginCredentials): Promise<AuthResponse> {
    const response = await api.post<AuthResponse>("/auth/login", credentials);
    auth.setToken(response.access_token);
    auth.setUser(response.user);
    return response;
  },

  async register(credentials: RegisterCredentials): Promise<AuthResponse> {
    const response = await api.post<AuthResponse>("/auth/register", credentials);
    auth.setToken(response.access_token);
    auth.setUser(response.user);
    return response;
  },

  async getMe(): Promise<User> {
    return api.get<User>("/auth/me");
  },

  async logout(): Promise<void> {
    auth.logout();
  },

  async updateProfile(data: Partial<User>): Promise<User> {
    return api.put<User>("/users/profile", data);
  },
};import { api } from '@/lib/api';
import { Favorite, FavoriteType, FavoriteCount } from '@/types/favorites';

export const favoritesService = {
  async getAll(type?: FavoriteType): Promise<Favorite[]> {
    const url = type ? `/favorites?type=${type}` : '/favorites';
    return api.get<Favorite[]>(url);
  },

  async getProducts(): Promise<Favorite[]> {
    return api.get<Favorite[]>('/favorites/products');
  },

  async getVendors(): Promise<Favorite[]> {
    return api.get<Favorite[]>('/favorites/vendors');
  },

  async getCount(): Promise<FavoriteCount> {
    return api.get<FavoriteCount>('/favorites/count');
  },

  async toggle(type: FavoriteType, itemId: string): Promise<{ isFavorite: boolean }> {
    return api.post<{ isFavorite: boolean }>('/favorites/toggle', { type, itemId });
  },

  async add(type: FavoriteType, itemId: string): Promise<Favorite> {
    return api.post<Favorite>('/favorites', { type, itemId });
  },

  async remove(type: FavoriteType, itemId: string): Promise<void> {
    return api.delete(`/favorites/${type}/${itemId}`);
  },

  async isFavorite(type: FavoriteType, itemId: string): Promise<boolean> {
    return api.get<boolean>(`/favorites/check/${type}/${itemId}`);
  },
};export * from './auth.service';
export * from './search.service';
export * from './product.service';
export * from './vendor.service';
export * from './location.service';
export * from './upload.service';
export * from './admin.service';
export * from './favorites.service';
export * from './reviews.service';import { api } from "@/lib/api";
import { State, Area, Market } from "@/types";

export const locationService = {
  async getStates(): Promise<State[]> {
    return api.get<State[]>("/states");
  },

  async getAreasByState(stateId: string): Promise<Area[]> {
    return api.get<Area[]>(`/areas/state/${stateId}`);
  },

  async getMarketsByArea(areaId: string): Promise<Market[]> {
    return api.get<Market[]>(`/markets/area/${areaId}`);
  },

  async getMarketById(id: string): Promise<Market> {
    return api.get<Market>(`/markets/${id}`);
  },

  async getNearbyMarkets(longitude: number, latitude: number, distance?: number): Promise<Market[]> {
    const params = new URLSearchParams({
      longitude: String(longitude),
      latitude: String(latitude),
    });
    if (distance) params.append("distance", String(distance));
    return api.get<Market[]>(`/markets/nearby?${params.toString()}`);
  },
};import { api } from "@/lib/api";
import { Product, ProductFilters, PaginatedResponse } from "@/types";

export const productService = {
  async getAll(filters?: ProductFilters): Promise<PaginatedResponse<Product>> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== "") {
          params.append(key, String(value));
        }
      });
    }
    return api.get<any>(`/products?${params.toString()}`).then((res) => ({
      items: res.products || [],
      total: res.total || 0,
      page: res.page || 1,
      totalPages: res.totalPages || 1,
    }));
  },

  async getById(id: string): Promise<Product> {
    return api.get<Product>(`/products/${id}`);
  },

  async getByVendor(vendorId: string): Promise<Product[]> {
    return api.get<Product[]>(`/products/vendor/${vendorId}`);
  },

  async getMyProducts(): Promise<Product[]> {
    return api.get<Product[]>("/products/my-products");
  },

  async getNearby(longitude: number, latitude: number, distance?: number, category?: string): Promise<Product[]> {
    const params = new URLSearchParams({
      longitude: String(longitude),
      latitude: String(latitude),
    });
    if (distance) params.append("distance", String(distance));
    if (category) params.append("category", category);
    return api.get<Product[]>(`/products/nearby?${params.toString()}`);
  },

  async create(data: Partial<Product>): Promise<Product> {
    return api.post<Product>("/products", data);
  },

  async update(id: string, data: Partial<Product>): Promise<Product> {
    return api.put<Product>(`/products/${id}`, data);
  },

  async delete(id: string): Promise<void> {
    return api.delete(`/products/${id}`);
  },
};import { api } from '@/lib/api';
import { Review, ReviewStats, CreateReviewInput } from '@/types/reviews';

export const reviewsService = {
  async getProductReviews(productId: string, page?: number, limit?: number): Promise<ReviewStats> {
    const params = new URLSearchParams();
    if (page) params.append('page', String(page));
    if (limit) params.append('limit', String(limit));
    return api.get<ReviewStats>(`/reviews/product/${productId}?${params.toString()}`);
  },

  async getVendorReviews(vendorId: string, page?: number, limit?: number): Promise<ReviewStats> {
    const params = new URLSearchParams();
    if (page) params.append('page', String(page));
    if (limit) params.append('limit', String(limit));
    return api.get<ReviewStats>(`/reviews/vendor/${vendorId}?${params.toString()}`);
  },

  async getMyReviews(): Promise<Review[]> {
    return api.get<Review[]>('/reviews/my-reviews');
  },

  async create(data: CreateReviewInput): Promise<Review> {
    return api.post<Review>('/reviews', data);
  },

  async update(id: string, data: Partial<CreateReviewInput>): Promise<Review> {
    return api.put<Review>(`/reviews/${id}`, data);
  },

  async delete(id: string): Promise<void> {
    return api.delete(`/reviews/${id}`);
  },

  async markHelpful(id: string): Promise<Review> {
    return api.post<Review>(`/reviews/${id}/helpful`);
  },
};import { api } from "@/lib/api";
import { SearchFilters, SearchResults, ProductWithVendors } from "@/types";

export const searchService = {
  async search(filters: SearchFilters): Promise<SearchResults> {
    const params = new URLSearchParams();
    Object.entries(filters).forEach(([key, value]) => {
      if (value !== undefined && value !== null && value !== "") {
        params.append(key, String(value));
      }
    });
    return api.get<SearchResults>(`/search?${params.toString()}`);
  },

  async searchProducts(filters: SearchFilters): Promise<SearchResults["products"]> {
    const params = new URLSearchParams();
    Object.entries(filters).forEach(([key, value]) => {
      if (value !== undefined && value !== null && value !== "") {
        params.append(key, String(value));
      }
    });
    return api.get<SearchResults["products"]>(`/search/products?${params.toString()}`);
  },

  async searchShops(filters: SearchFilters): Promise<SearchResults["shops"]> {
    const params = new URLSearchParams();
    Object.entries(filters).forEach(([key, value]) => {
      if (value !== undefined && value !== null && value !== "") {
        params.append(key, String(value));
      }
    });
    return api.get<SearchResults["shops"]>(`/search/shops?${params.toString()}`);
  },

  async getProductVendors(productName: string, filters?: Partial<SearchFilters>): Promise<ProductWithVendors> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== "") {
          params.append(key, String(value));
        }
      });
    }
    return api.get<ProductWithVendors>(`/search/product/${encodeURIComponent(productName)}/vendors?${params.toString()}`);
  },

  async getShopProducts(vendorId: string, filters?: { category?: string; minPrice?: number; maxPrice?: number; page?: number }): Promise<any> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== "") {
          params.append(key, String(value));
        }
      });
    }
    return api.get(`/search/shop/${vendorId}/products?${params.toString()}`);
  },

  async getSimilarProducts(productId: string, limit: number = 10): Promise<any[]> {
    return api.get(`/search/product/${productId}/similar?limit=${limit}`);
  },
};import { api } from "@/lib/api";

export interface UploadResponse {
  url: string;
  publicId: string;
  width?: number;
  height?: number;
  format?: string;
}

export const uploadService = {
  async uploadProductImage(file: File): Promise<UploadResponse> {
    const formData = new FormData();
    formData.append("file", file);

    // Use axios directly since we need multipart/form-data
    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL || "http://localhost:4000"}/api/v1/upload/product`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${document.cookie
            .split("; ")
            .find((row) => row.startsWith("access_token="))
            ?.split("=")[1]}`,
        },
        body: formData,
      }
    );

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || "Failed to upload image");
    }

    const data = await response.json();
    return data.data || data;
  },

  async uploadMultipleProductImages(files: File[]): Promise<UploadResponse[]> {
    const formData = new FormData();
    files.forEach((file) => formData.append("files", file));

    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL || "http://localhost:4000"}/api/v1/upload/images`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${document.cookie
            .split("; ")
            .find((row) => row.startsWith("access_token="))
            ?.split("=")[1]}`,
        },
        body: formData,
      }
    );

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || "Failed to upload images");
    }

    const data = await response.json();
    return data.data || data;
  },

  async uploadShopEntrance(file: File): Promise<UploadResponse> {
    return this.uploadSingle(file, "shop-entrance");
  },

  async uploadShopLogo(file: File): Promise<UploadResponse> {
    return this.uploadSingle(file, "shop-logo");
  },

  async deleteImage(publicId: string): Promise<void> {
    await api.delete(`/upload/${encodeURIComponent(publicId)}`);
  },

  async uploadSingle(file: File, endpoint: string): Promise<UploadResponse> {
    const formData = new FormData();
    formData.append("file", file);

    const response = await fetch(
      `${process.env.NEXT_PUBLIC_API_URL || "http://localhost:4000"}/api/v1/upload/${endpoint}`,
      {
        method: "POST",
        headers: {
          Authorization: `Bearer ${document.cookie
            .split("; ")
            .find((row) => row.startsWith("access_token="))
            ?.split("=")[1]}`,
        },
        body: formData,
      }
    );

    if (!response.ok) {
      const error = await response.json();
      throw new Error(error.message || "Failed to upload image");
    }

    const data = await response.json();
    return data.data || data;
  },
};import { api } from "@/lib/api";
import { Vendor, ShopSearchResult } from "@/types";

export const vendorService = {
  async getAll(filters?: any): Promise<{ vendors: Vendor[]; total: number; page: number; totalPages: number }> {
    const params = new URLSearchParams();
    if (filters) {
      Object.entries(filters).forEach(([key, value]) => {
        if (value !== undefined && value !== null && value !== "") {
          params.append(key, String(value));
        }
      });
    }
    return api.get(`/vendors?${params.toString()}`);
  },

  async getById(id: string): Promise<Vendor> {
    return api.get<Vendor>(`/vendors/${id}`);
  },

  async getMyProfile(): Promise<Vendor> {
    return api.get<Vendor>("/vendors/my-profile");
  },

  async getByMarket(marketId: string): Promise<Vendor[]> {
    return api.get<Vendor[]>(`/vendors/market/${marketId}`);
  },

  async getNearby(longitude: number, latitude: number, distance?: number): Promise<Vendor[]> {
    const params = new URLSearchParams({
      longitude: String(longitude),
      latitude: String(latitude),
    });
    if (distance) params.append("distance", String(distance));
    return api.get<Vendor[]>(`/vendors/nearby?${params.toString()}`);
  },

  async create(data: Partial<Vendor>): Promise<Vendor> {
    return api.post<Vendor>("/vendors", data);
  },

  async update(id: string, data: Partial<Vendor>): Promise<Vendor> {
    return api.put<Vendor>(`/vendors/${id}`, data);
  },

  async delete(id: string): Promise<void> {
    return api.delete(`/vendors/${id}`);
  },
};import { create } from "zustand";
import { persist } from "zustand/middleware";
import { User } from "@/types";
import { auth } from "@/lib/auth";

interface AuthState {
  user: User | null;
  isAuthenticated: boolean;
  isLoading: boolean;
  setUser: (user: User | null) => void;
  setLoading: (loading: boolean) => void;
  logout: () => void;
}

export const useAuthStore = create<AuthState>()(
  persist(
    (set) => ({
      user: null,
      isAuthenticated: false,
      isLoading: true,
      setUser: (user) => set({ user, isAuthenticated: !!user, isLoading: false }),
      setLoading: (isLoading) => set({ isLoading }),
      logout: () => {
        auth.logout();
        set({ user: null, isAuthenticated: false });
      },
    }),
    {
      name: "auth-storage",
      partialize: (state) => ({ user: state.user, isAuthenticated: state.isAuthenticated }),
    }
  )
);import { create } from "zustand";
import { State, Area, Market } from "@/types";

interface FilterState {
  selectedState: State | null;
  selectedArea: Area | null;
  selectedMarket: Market | null;
  states: State[];
  areas: Area[];
  markets: Market[];
  setSelectedState: (state: State | null) => void;
  setSelectedArea: (area: Area | null) => void;
  setSelectedMarket: (market: Market | null) => void;
  setStates: (states: State[]) => void;
  setAreas: (areas: Area[]) => void;
  setMarkets: (markets: Market[]) => void;
  clearLocationFilters: () => void;
}

export const useFilterStore = create<FilterState>((set) => ({
  selectedState: null,
  selectedArea: null,
  selectedMarket: null,
  states: [],
  areas: [],
  markets: [],
  
  setSelectedState: (selectedState) =>
    set({ selectedState, selectedArea: null, selectedMarket: null, areas: [], markets: [] }),
  
  setSelectedArea: (selectedArea) =>
    set({ selectedArea, selectedMarket: null, markets: [] }),
  
  setSelectedMarket: (selectedMarket) => set({ selectedMarket }),
  
  setStates: (states) => set({ states }),
  
  setAreas: (areas) => set({ areas }),
  
  setMarkets: (markets) => set({ markets }),
  
  clearLocationFilters: () =>
    set({
      selectedState: null,
      selectedArea: null,
      selectedMarket: null,
      areas: [],
      markets: [],
    }),
}));export * from './auth-store';
export * from './search-store';
export * from './filter-store';import { create } from "zustand";
import { SearchFilters, AvailableFilters } from "@/types";

interface SearchState {
  query: string;
  filters: Partial<SearchFilters>;
  availableFilters: AvailableFilters | null;
  recentSearches: string[];
  setQuery: (query: string) => void;
  setFilters: (filters: Partial<SearchFilters>) => void;
  updateFilter: (key: keyof SearchFilters, value: any) => void;
  clearFilters: () => void;
  setAvailableFilters: (filters: AvailableFilters) => void;
  addRecentSearch: (search: string) => void;
  clearRecentSearches: () => void;
}

export const useSearchStore = create<SearchState>((set, get) => ({
  query: "",
  filters: {},
  availableFilters: null,
  recentSearches: [],
  
  setQuery: (query) => set({ query }),
  
  setFilters: (filters) => set({ filters }),
  
  updateFilter: (key, value) =>
    set((state) => ({
      filters: { ...state.filters, [key]: value },
    })),
  
  clearFilters: () => set({ filters: {}, query: "" }),
  
  setAvailableFilters: (availableFilters) => set({ availableFilters }),
  
  addRecentSearch: (search) =>
    set((state) => ({
      recentSearches: [search, ...state.recentSearches.filter((s) => s !== search)].slice(0, 10),
    })),
  
  clearRecentSearches: () => set({ recentSearches: [] }),
}));import { User, Vendor, Product } from './index';

export interface DashboardStats {
  users: {
    total: number;
    active: number;
    newThisMonth: number;
    byRole: { role: string; count: number }[];
  };
  vendors: {
    total: number;
    verified: number;
    pending: number;
    featured: number;
    newThisMonth: number;
  };
  products: {
    total: number;
    approved: number;
    pending: number;
    rejected: number;
    newThisMonth: number;
  };
  locations: {
    states: number;
    areas: number;
    markets: number;
  };
  activity: {
    totalViews: number;
    totalSearches: number;
  };
}

export interface RecentActivity {
  type: string;
  message: string;
  timestamp: string;
  data?: any;
}

export interface AdminFilters {
  page?: number;
  limit?: number;
  search?: string;
  role?: string;
  status?: string;
  isActive?: boolean;
  isVerified?: boolean;
  isFeatured?: boolean;
}export interface ApiResponse<T> {
  success: boolean;
  data: T;
  message: string;
  timestamp: string;
}

export interface PaginatedResponse<T> {
  items: T[];
  total: number;
  page: number;
  totalPages: number;
}

export interface ApiError {
  success: false;
  statusCode: number;
  message: string;
  errors?: any;
  timestamp: string;
  path: string;
}export interface User {
  id: string;
  firstName: string;
  lastName: string;
  email: string;
  phone: string;
  role: 'user' | 'vendor' | 'admin' | 'super_admin';
  avatar?: string;
  isEmailVerified: boolean;
  vendorProfile?: string;
  createdAt: string;
  updatedAt: string;
  isActive :boolean;
}

export interface AuthResponse {
  access_token: string;
  user: User;
}

export interface LoginCredentials {
  email: string;
  password: string;
}

export interface RegisterCredentials {
  firstName: string;
  lastName: string;
  email: string;
  password: string;
  phone: string;
}import { Product, Vendor } from './index';

export enum FavoriteType {
  PRODUCT = 'product',
  VENDOR = 'vendor',
}

export interface Favorite {
  id: string;
  userId: string;
  type: FavoriteType;
  itemId: string;
  productId?: Product;
  vendorId?: Vendor;
  createdAt: string;
}

export interface FavoriteCount {
  products: number;
  vendors: number;
}export * from './auth';
export * from './product';
export * from './vendor';
export * from './search';
export * from './location';
export * from './api';
export * from './favorites';
export * from './reviews';
export * from './admin';export interface State {
  id: string;
  name: string;
  code: string;
  capital?: string;
  isActive: boolean;
}

export interface Area {
  id: string;
  name: string;
  stateId: string;
  localGovernment?: string;
  postalCode?: string;
  isActive: boolean;
}

export interface Market {
  id: string;
  name: string;
  type: 'traditional_market' | 'shopping_mall' | 'plaza' | 'shopping_complex' | 'street_market';
  stateId: string;
  areaId: string;
  address?: string;
  landmark?: string;
  entrancePhoto?: string;
  layoutMap?: string;
  totalShops: number;
  isActive: boolean;
  isVerified: boolean;
}

export interface LocationInfo {
  state: { id: string; name: string };
  area: { id: string; name: string };
  market?: { id: string; name: string; type: string };
  shopNumber?: string;
  shopFloor?: string;
  shopBlock?: string;
  shopAddress?: string;
  landmark?: string;
  coordinates?: [number, number];
  distance?: number;
}import { Vendor, VendorListing } from './vendor';
import { LocationInfo } from './location';

export interface Product {
  id: string;
  vendorId: string | Vendor;
  catalogItemId?: string;
  name: string;
  description?: string;
  sku?: string;
  barcode?: string;
  brand?: string;
  type: 'sale' | 'lease' | 'rent' | 'service';
  price: number;
  originalPrice?: number;
  currency: string;
  images: string[];
  category: string;
  subcategory?: string;
  tags: string[];
  quantity: number;
  unit?: string;
  specifications?: Record<string, any>;
  status: 'draft' | 'pending' | 'approved' | 'rejected' | 'out_of_stock' | 'discontinued';
  views: number;
  inStock: boolean;
  stateId?: string;
  areaId?: string;
  marketId?: string;
  location?: {
    type: 'Point';
    coordinates: [number, number];
  };
  createdAt: string;
  updatedAt: string;
}

export interface ProductSearchResult {
  id: string;
  name: string;
  description?: string;
  brand?: string;
  category: string;
  subcategory?: string;
  images: string[];
  price: number;
  originalPrice?: number;
  currency: string;
  inStock: boolean;
  vendor: {
    id: string;
    businessName: string;
    logo?: string;
    rating: number;
    isVerified: boolean;
    contactDetails: {
      phone: string;
      whatsapp?: string;
    };
  };
  location: LocationInfo;
}

export interface ProductWithVendors {
  id: string;
  catalogItemId?: string;
  name: string;
  description?: string;
  brand?: string;
  category: string;
  subcategory?: string;
  images: string[];
  priceRange: {
    lowest: number;
    highest: number;
    average: number;
    currency: string;
  };
  totalVendors: number;
  vendors: VendorListing[];
}

export interface ProductFilters {
  search?: string;
  category?: string;
  subcategory?: string;
  brand?: string;
  minPrice?: number;
  maxPrice?: number;
  stateId?: string;
  areaId?: string;
  marketId?: string;
  inStock?: boolean;
  sortBy?: 'relevance' | 'price_low' | 'price_high' | 'newest' | 'rating';
  page?: number;
  limit?: number;
}export enum ReviewType {
  PRODUCT = 'product',
  VENDOR = 'vendor',
}

export interface Review {
  id: string;
  userId: {
    id: string;
    firstName: string;
    lastName: string;
    avatar?: string;
  };
  type: ReviewType;
  productId?: string;
  vendorId?: string;
  rating: number;
  title?: string;
  comment?: string;
  images?: string[];
  helpfulCount: number;
  isVerified: boolean;
  createdAt: string;
}

export interface ReviewStats {
  reviews: Review[];
  total: number;
  averageRating: number;
  ratingDistribution: { [key: number]: number };
}

export interface CreateReviewInput {
  type: ReviewType;
  productId?: string;
  vendorId?: string;
  rating: number;
  title?: string;
  comment?: string;
  images?: string[];
}import { ProductSearchResult, ProductWithVendors } from './product';
import { ShopSearchResult } from './vendor';

export type SearchType = 'products' | 'shops' | 'all';
export type SortBy = 'relevance' | 'price_low' | 'price_high' | 'rating' | 'newest' | 'distance' | 'popularity';

export interface SearchFilters {
  query: string;
  searchType?: SearchType;
  stateId?: string;
  areaId?: string;
  marketId?: string;
  longitude?: number;
  latitude?: number;
  maxDistance?: number;
  category?: string;
  subcategory?: string;
  brand?: string;
  minPrice?: number;
  maxPrice?: number;
  inStock?: boolean;
  verifiedOnly?: boolean;
  tags?: string[];
  sortBy?: SortBy;
  page?: number;
  limit?: number;
}

export interface FilterOption {
  id: string;
  name: string;
  count: number;
}

export interface AvailableFilters {
  states: FilterOption[];
  areas: FilterOption[];
  markets: FilterOption[];
  categories: { name: string; count: number }[];
  brands: { name: string; count: number }[];
  priceRange: { min: number; max: number };
}

export interface SearchResults {
  query: string;
  searchType: string;
  products?: {
    items: ProductSearchResult[];
    total: number;
    page: number;
    totalPages: number;
  };
  shops?: {
    items: ShopSearchResult[];
    total: number;
    page: number;
    totalPages: number;
  };
  productComparison?: {
    items: ProductWithVendors[];
    total: number;
  };
  availableFilters: AvailableFilters;
  meta: {
    timestamp: string;
    took: number;
  };
}// src/types/shop-display.ts
import { Vendor, ShopSearchResult } from "@/types";

/**
 * Unified type for displaying shop cards.
 * All fields that differ between Vendor and ShopSearchResult are optional.
 */
export interface ShopDisplayData {
  id: string;
  businessName: string;
  businessDescription?: string;
  operatingHours?: {
    openingTime: string;
    closingTime: string;
  };
  isFeatured?: boolean;
  isVerified?: boolean;
  rating: number;
  reviewCount: number;
  totalProducts: number;
  categories?: string[];

  // Fields that only ShopSearchResult has
  entrancePhoto?: string;
  logo?: string;
  priceRange?: { min: number; max: number };
  featuredProducts?: { id: string; name: string; price: number; image?: string }[];

  // Location â€” normalized to one shape
  location?: {
    shopNumber?: string;
    market?: { name: string };
    area?: { name: string };
    address?: string;
  };
}

/**
 * Convert a Vendor to ShopDisplayData
 */
export function vendorToDisplayData(vendor: Vendor): ShopDisplayData {
  return {
    id: vendor.id,
    businessName: vendor.businessName,
    businessDescription: vendor.businessDescription,
    isFeatured: vendor.isFeatured,
    isVerified: vendor.isVerified,
    rating: vendor.rating,
    reviewCount: vendor.reviewCount,
    totalProducts: vendor.totalProducts,
    categories: vendor.categories,
    // Vendor doesn't have these â€” they stay undefined
    entrancePhoto: undefined,
    logo: undefined,
    priceRange: undefined,
    featuredProducts: undefined,
    location: undefined, // or map from vendor.location if it has address info
  };
}

/**
 * Convert a ShopSearchResult to ShopDisplayData
 */
export function searchResultToDisplayData(result: ShopSearchResult): ShopDisplayData {
  return {
    id: result.id,
    businessName: result.businessName,
    businessDescription: result.businessDescription,
    isFeatured: result.isFeatured,
    isVerified: result.isVerified,
    rating: result.rating,
    reviewCount: result.reviewCount,
    totalProducts: result.totalProducts,
    categories: result.categories,
    entrancePhoto: result.entrancePhoto,
    logo: result.logo,
    priceRange: result.priceRange,
    featuredProducts: result.featuredProducts,
    location: result.location
      ? {
          shopNumber: result.location.shopNumber,
          market: result.location.market,
          area: result.location.area,
        }
      : undefined,
  };
}import { LocationInfo } from './location';

export interface BankDetails {
  bankName: string;
  accountName: string;
  accountNumber: string;
  bankCode?: string;
}

export interface ContactDetails {
  phone: string;
  alternatePhone?: string;
  email?: string;
  whatsapp?: string;
  instagram?: string;
  facebook?: string;
  twitter?: string;
  website?: string;
}

export interface ShopImages {
  entrancePhoto?: string;
  logo?: string;
  layoutMap?: string;
  additionalImages?: string[];
}

export interface OperatingHours {
  openingTime?: string;
  closingTime?: string;
  operatingDays?: string[];
  is24Hours?: boolean;
}

export interface Vendor {
  id: string;
  userId: string;
  businessName: string;
  businessDescription?: string;
  vendorType: 'market_shop' | 'mall_shop' | 'home_based' | 'street_shop' | 'online_only';
  stateId: string;
  areaId: string;
  marketId?: string;
  shopNumber?: string;
  shopFloor?: string;
  shopBlock?: string;
  shopAddress?: string;
  landmark?: string;
  location?: {
    type: 'Point';
    coordinates: [number, number];
  };
  shopImages?: ShopImages;
  contactDetails: ContactDetails;
  bankDetails?: BankDetails;
  operatingHours?: OperatingHours;
  categories: string[];
  tags: string[];
  totalProducts: number;
  totalViews: number;
  rating: number;
  reviewCount: number;
  minProductPrice: number;
  maxProductPrice: number;
  isActive: boolean;
  isVerified: boolean;
  isFeatured: boolean;
  isOpen: boolean;
  createdAt: string;
  updatedAt: string;
}

export interface VendorListing {
  vendorId: string;
  productId: string;
  businessName: string;
  logo?: string;
  entrancePhoto?: string;
  rating: number;
  isVerified: boolean;
  price: number;
  originalPrice?: number;
  inStock: boolean;
  quantity: number;
  contactDetails: ContactDetails;
  bankDetails?: BankDetails;
  location: LocationInfo;
  operatingHours?: {
    openingTime?: string;
    closingTime?: string;
    operatingDays?: string[];
    isOpen: boolean;
  };
}

export interface ShopSearchResult {
  id: string;
  businessName: string;
  businessDescription?: string;
  vendorType: string;
  logo?: string;
  entrancePhoto?: string;
  layoutMap?: string;
  rating: number;
  reviewCount: number;
  totalProducts: number;
  isVerified: boolean;
  isFeatured: boolean;
  categories: string[];
  priceRange: {
    min: number;
    max: number;
  };
  contactDetails: Partial<ContactDetails>;
  bankDetails?: BankDetails;
  location: LocationInfo;
  operatingHours?: OperatingHours & { isOpen: boolean };
  featuredProducts?: {
    id: string;
    name: string;
    price: number;
    image?: string;
  }[];
}